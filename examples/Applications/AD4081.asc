Version 4
SHEET 1 12976 5444
WIRE 2592 608 2576 608
WIRE 3312 608 3296 608
WIRE 3584 608 3568 608
WIRE 2576 656 2576 608
WIRE 3296 656 3296 608
WIRE 3568 656 3568 608
WIRE 1680 688 1664 688
WIRE 1904 688 1888 688
WIRE 2112 688 2096 688
WIRE 1664 736 1664 688
WIRE 1888 736 1888 688
WIRE 2096 736 2096 688
WIRE 2576 768 2576 736
WIRE 3296 768 3296 736
WIRE 3568 768 3568 736
WIRE 1664 848 1664 816
WIRE 1888 848 1888 816
WIRE 2096 848 2096 816
WIRE 4432 944 4256 944
WIRE 4464 944 4432 944
WIRE 4256 976 4256 944
WIRE 4256 1120 4256 1056
WIRE 2832 1152 2544 1152
WIRE 3120 1152 2912 1152
WIRE 2960 1264 2752 1264
WIRE 3120 1264 3120 1152
WIRE 3120 1264 3024 1264
WIRE 4816 1344 4800 1344
WIRE 1744 1376 1696 1376
WIRE 2208 1376 1744 1376
WIRE 2368 1376 2288 1376
WIRE 2544 1376 2544 1152
WIRE 2544 1376 2368 1376
WIRE 2608 1376 2544 1376
WIRE 2752 1376 2752 1264
WIRE 2752 1376 2688 1376
WIRE 3264 1376 3184 1376
WIRE 4464 1376 4464 944
WIRE 3952 1392 3536 1392
WIRE 4064 1392 4032 1392
WIRE 4192 1392 4064 1392
WIRE 4240 1392 4192 1392
WIRE 1696 1408 1696 1376
WIRE 3264 1408 3216 1408
WIRE 5056 1408 4960 1408
WIRE 5152 1408 5056 1408
WIRE 2368 1424 2368 1376
WIRE 4800 1424 4800 1344
WIRE 4800 1424 4768 1424
WIRE 3264 1440 3248 1440
WIRE 5056 1440 5056 1408
WIRE 3184 1456 3184 1376
WIRE 3216 1456 3216 1408
WIRE 3248 1456 3248 1440
WIRE 4240 1472 4240 1392
WIRE 4816 1472 4768 1472
WIRE 2752 1488 2752 1376
WIRE 2880 1488 2752 1488
WIRE 3136 1488 2880 1488
WIRE 3392 1488 3312 1488
WIRE 3456 1488 3392 1488
WIRE 3536 1488 3536 1392
WIRE 3536 1488 3504 1488
WIRE 3584 1488 3536 1488
WIRE 3712 1488 3664 1488
WIRE 3904 1488 3712 1488
WIRE 4192 1488 3904 1488
WIRE 4192 1504 4192 1488
WIRE 4208 1504 4192 1504
WIRE 3120 1520 3120 1264
WIRE 3136 1520 3120 1520
WIRE 3312 1520 3312 1488
WIRE 3712 1520 3712 1488
WIRE 1696 1536 1696 1488
WIRE 1696 1536 1488 1536
WIRE 2368 1536 2368 1488
WIRE 2368 1536 2320 1536
WIRE 4064 1536 4064 1392
WIRE 4208 1536 4192 1536
WIRE 5056 1536 5056 1504
WIRE 2320 1552 2320 1536
WIRE 2880 1552 2752 1552
WIRE 3136 1552 2880 1552
WIRE 1488 1568 1488 1536
WIRE 1696 1568 1696 1536
WIRE 4800 1568 4768 1568
WIRE 4960 1568 4960 1408
WIRE 4960 1568 4800 1568
WIRE 2368 1584 2368 1536
WIRE 3136 1584 3120 1584
WIRE 3136 1616 3088 1616
WIRE 3312 1616 3312 1584
WIRE 3392 1616 3312 1616
WIRE 3456 1616 3504 1488
WIRE 3456 1616 3392 1616
WIRE 3504 1616 3456 1488
WIRE 3536 1616 3504 1616
WIRE 3584 1616 3536 1616
WIRE 3712 1616 3712 1584
WIRE 3712 1616 3664 1616
WIRE 3904 1616 3712 1616
WIRE 4192 1616 4192 1536
WIRE 4192 1616 3904 1616
WIRE 4800 1616 4800 1568
WIRE 4800 1616 4768 1616
WIRE 5056 1648 4768 1648
WIRE 5136 1648 5056 1648
WIRE 3088 1664 3088 1616
WIRE 3248 1664 3248 1648
WIRE 5056 1680 5056 1648
WIRE 1488 1696 1488 1648
WIRE 1696 1696 1696 1648
WIRE 1744 1696 1696 1696
WIRE 2208 1696 1744 1696
WIRE 2368 1696 2368 1648
WIRE 2368 1696 2288 1696
WIRE 2544 1696 2368 1696
WIRE 2608 1696 2544 1696
WIRE 2752 1696 2752 1552
WIRE 2752 1696 2688 1696
WIRE 4368 1696 4368 1664
WIRE 3216 1712 3216 1648
WIRE 3232 1712 3216 1712
WIRE 3536 1712 3536 1616
WIRE 3952 1712 3536 1712
WIRE 4064 1712 4064 1600
WIRE 4064 1712 4032 1712
WIRE 4192 1712 4064 1712
WIRE 4240 1712 4240 1568
WIRE 4240 1712 4192 1712
WIRE 3184 1744 3184 1648
WIRE 3232 1744 3184 1744
WIRE 5056 1776 5056 1744
WIRE 2752 1808 2752 1696
WIRE 2960 1808 2752 1808
WIRE 3120 1808 3120 1584
WIRE 3120 1808 3024 1808
WIRE 2544 1904 2544 1696
WIRE 2848 1904 2544 1904
WIRE 3120 1904 3120 1808
WIRE 3120 1904 2928 1904
WIRE 4464 1936 4464 1664
WIRE 4464 1936 4368 1936
WIRE 4592 1936 4592 1664
WIRE 4688 1936 4592 1936
WIRE 4368 1984 4368 1936
WIRE 4528 1984 4528 1664
WIRE 4688 1984 4688 1936
WIRE 4368 2080 4368 2064
WIRE 4528 2080 4528 2064
WIRE 4688 2080 4688 2064
FLAG 4368 1696 0
FLAG 5056 1536 0
FLAG 5056 1776 0
FLAG 5152 1408 ADC_out
FLAG 5136 1648 ADC_out_dsp
FLAG 3264 1408 VOCM
FLAG 3264 1376 VS+
FLAG 3232 1744 VS-
FLAG 3088 1664 0
FLAG 3296 768 0
FLAG 3312 608 VOCM
FLAG 3568 768 0
FLAG 3584 608 _DIS
FLAG 3232 1712 _DIS
FLAG 2880 1488 FDA_IN+
FLAG 2880 1552 FDA_IN-
FLAG 3248 1664 0
FLAG 4192 1392 AUXIN+
FLAG 3904 1488 ADC_IN+
FLAG 3904 1616 ADC_IN-
FLAG 4192 1712 AUXIN-
FLAG 3392 1488 FDA_OUT_N
FLAG 3392 1616 FDA_OUT_P
FLAG 4368 2080 0
FLAG 4528 2080 0
FLAG 4688 2080 0
FLAG 1664 848 0
FLAG 1888 848 0
FLAG 1680 688 VS+
FLAG 1904 688 VS-
FLAG 2096 848 0
FLAG 2112 688 VDD33
FLAG 2576 768 0
FLAG 2592 608 CNV
FLAG 1488 1696 0
FLAG 1744 1376 Vin_p
FLAG 1744 1696 Vin_n
FLAG 4816 1344 VDD33
FLAG 4816 1472 CNV
FLAG 4256 1120 0
FLAG 4432 944 Refin
FLAG 2320 1552 0
FLAG 3264 1440 Refin
SYMBOL cap 5040 1504 M180
WINDOW 0 24 56 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName C1
SYMATTR Value 0.1p
SYMBOL cap 5040 1744 M180
WINDOW 0 24 56 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName C2
SYMATTR Value 0.1p
SYMBOL OpAmps\\ADA4945-HP 3184 1552 R0
WINDOW 3 73 92 Left 2
SYMATTR InstName U2
SYMBOL voltage 3296 640 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V11
SYMATTR Value 1.5
SYMBOL voltage 3568 640 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V12
SYMATTR Value 3.3
SYMBOL res 2816 1168 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R1
SYMATTR Value {RF}
SYMBOL res 2832 1920 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R3
SYMATTR Value {RF}
SYMBOL cap 2960 1280 R270
WINDOW 3 0 32 VBottom 2
WINDOW 0 32 32 VTop 2
SYMATTR Value {CFilt_2}
SYMATTR InstName C3
SYMBOL cap 2960 1824 R270
WINDOW 3 0 32 VBottom 2
WINDOW 0 32 32 VTop 2
SYMATTR Value {CFilt_2}
SYMATTR InstName C4
SYMBOL res 3680 1472 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 25
SYMBOL res 3680 1600 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 25
SYMBOL res 4048 1376 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 100
SYMBOL res 4048 1696 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 100
SYMBOL cap 3696 1520 R0
SYMATTR InstName C7
SYMATTR Value 78p
SYMBOL cap 4048 1536 R0
SYMATTR InstName C8
SYMATTR Value 10p
SYMBOL res 2304 1360 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value {RG}
SYMBOL res 2304 1680 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value {RG}
SYMBOL voltage 4368 1968 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 0 -86 14 Left 2
WINDOW 3 -80 45 Left 2
SYMATTR InstName V_FS
SYMATTR Value {fs}
SYMBOL voltage 4528 1968 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 0 -102 15 Left 2
WINDOW 3 -96 50 Left 2
SYMATTR InstName V_SEL
SYMATTR Value {sel}
SYMBOL voltage 4688 1968 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 0 -102 20 Left 2
WINDOW 3 -198 51 Left 2
SYMATTR InstName V_DEC
SYMATTR Value {decimation}
SYMBOL cap 2352 1424 R0
WINDOW 3 18 56 Left 2
WINDOW 0 32 13 Left 2
SYMATTR Value {CFilt_1}
SYMATTR InstName C9
SYMBOL cap 2352 1584 R0
WINDOW 3 17 49 Left 2
WINDOW 0 32 11 Left 2
SYMATTR Value {CFilt_1}
SYMATTR InstName C10
SYMBOL res 2592 1392 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R5
SYMATTR Value {RMFB}
SYMBOL res 2592 1712 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R6
SYMATTR Value {RMFB}
SYMBOL voltage 1664 720 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value {FDA_Vsp}
SYMBOL voltage 1888 720 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value {FDA_Vsn}
SYMBOL voltage 2096 720 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value {ADC_VDD33}
SYMBOL voltage 2576 640 R0
WINDOW 123 0 0 Left 0
WINDOW 39 36 120 Left 2
WINDOW 3 13 96 Left 2
SYMATTR Value PULSE(0 1.1 {ACQ_delay} 0.2n 0.2n {0.9*(1/fs)} {1/fs})
SYMATTR InstName V14
SYMBOL voltage 1696 1552 R0
WINDOW 123 47 66 Left 2
WINDOW 39 0 0 Left 0
WINDOW 3 15 95 Left 2
WINDOW 0 48 37 Left 2
SYMATTR Value2 AC 0.5 0
SYMATTR Value SINE(0 {input_Vpp/4} {input_freq})
SYMATTR InstName Vin_n
SYMBOL voltage 1488 1552 R0
WINDOW 123 41 74 Left 2
WINDOW 39 0 0 Left 0
WINDOW 0 42 49 Left 2
WINDOW 3 30 98 Left 2
SYMATTR Value2 AC 0
SYMATTR InstName Vin_cm
SYMATTR Value {input_cm}
SYMBOL voltage 1696 1392 R0
WINDOW 123 42 70 Left 2
WINDOW 39 0 0 Left 0
WINDOW 3 15 95 Left 2
WINDOW 0 43 45 Left 2
SYMATTR Value2 AC 0.5 0
SYMATTR Value SINE(0 {input_Vpp/4} {input_freq})
SYMATTR InstName Vin_p
SYMBOL AD4081 4464 1520 R0
SYMATTR InstName U1
SYMBOL voltage 4256 960 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 3
TEXT 1696 -472 Left 2 !.tran 5u
TEXT 1696 -352 Left 2 ;.noise V(ADC_out_dsp) Vin_p dec 100 10 1G
TEXT 1704 232 Left 2 !.meas NOISE output_noise_rms INTEG V(onoise) FROM 10 TO {Fmax_noise_integration}
TEXT 1704 272 Left 2 !.meas NOISE full_scale_sine_rms PARAM 2*VREF/(2*sqrt(2))
TEXT 3128 -280 Left 2 !.param VREF=3
TEXT 1704 312 Left 2 !.meas NOISE dynamic_range PARAM 20*log10(full_scale_sine_rms/output_noise_rms)
TEXT 1704 192 Left 2 !.param Fmax_noise_integration = 1G
TEXT 1704 352 Left 2 !.meas NOISE ENOB PARAM (dynamic_range - 1.76)/6.02
TEXT 2160 1032 Left 4 ;ADC driver
TEXT 3480 1064 Left 4 ;ADC Kickback Filter
TEXT 3512 1128 Left 2 ;Set to ~80 MHz BW to allow\ndriver to settle ADC kickback.
TEXT 1696 -432 Left 2 ;.ac dec 1000 1k 1G
TEXT 1696 -392 Left 2 ;.noise V(ADC_out) Vin_p dec 100 10 1G
TEXT 3496 1872 Left 4 ;AD4081 Digital Filtering Configuration
TEXT 5072 1352 Left 4 ;ADC output pre-digital filtering
TEXT 5040 1600 Left 4 ;ADC output post digital filtering (AC and NOISE simulations only)
TEXT 3552 2048 Left 2 ;SEL input:\n  The voltage applied at this input selects the\n  digital filter type.\n    0V = No Filter \n    1V = Sinc1 \n    2V = Sinc5\n    3V = Sinc5 + Comp
TEXT 3552 2280 Left 2 ;DEC input:\n  The voltage applied at this pin sets\n  the N value for decimation.\n  For Sinc1 and Sinc5 Filters Decimation = N\n  For Sinc5 +Comp Decimation = (N * 2)\n  2 = N = 2 \n  4 = N = 4 \n  8 = N = 8\n  16 =........\n  ...............\n  256 =   N = 256 (Max Setting for Sinc5 and Sinc5 + Comp)\n  512 =   N = 512 (Sinc1 Only)\n  1024 = N = 1024 (Sinc1 Only)
TEXT 2432 1080 Left 3 ;Multi-feedback topology, low-pass, second-order
TEXT 2264 -472 Left 2 ;--> AD4081 digital filter output (ADC_out_dsp)\n     does not support transient simulations
TEXT 2496 512 Left 2 ;Other signals
TEXT 1664 -528 Left 2 ;Simulation commands
TEXT 3096 -528 Left 2 ;Parameters
TEXT 1664 -64 Left 2 ;Measurements
TEXT 1600 512 Left 2 ;Supplies
TEXT 3120 -424 Left 2 !.param FDA_VSp = 5V\n.param FDA_VSn = -5V
TEXT 1696 -712 Left 2 ;Release Date: 2024/07/04\n \nDescription: This simulation demonstrates driving the AD4081 high-speed, precision ADC.\n \nFor support, you can post your questions in https://ez.analog.com/design-tools-and-calculators/ltspice/ after you have created an account.
TEXT 1664 -768 Left 2 ;Simulation file notes
TEXT 3104 16 Left 2 ;Analog front-end
TEXT 3104 -96 Left 2 ;ADC sampling
TEXT 3128 -64 Left 2 !.param fs = 40MEG\n.param ACQ_delay = 10n
TEXT 3464 -72 Left 2 ;--> ADC Sampling rate. For AD4081 the minimum is 1.25 Msps, maximum 40 Msps
TEXT 3464 -40 Left 2 ;--> Delay from simulation start to first sampling pulse
TEXT 3104 -456 Left 2 ;Power supplies
TEXT 3472 -416 Left 2 ;--> Supply span range for ADA4945-1 is 3V to 10V
TEXT 3488 -192 Left 2 ;--> Input signal amplitude (peak-to-peak). 2.966 Vpp corresponds to ~-0.1 dBFS\n--> Frequency for the sinusoidal differential input signal\n--> Input signal DC common mode voltage
TEXT 3128 -192 Left 2 !.param input_Vpp=2.966\n.param input_freq = 500k\n.param input_cm = 0
TEXT 3104 -224 Left 2 ;Input signal
TEXT 2544 808 Left 2 ;The CNV or convert signal is a periodic train of pulses\nwhose rising edges trigger ADC conversion. The frequency\nof these pulses (fs) sets the sampling rate.
TEXT 3480 -352 Left 2 ;--> VDD33 supply rail for AD4081
TEXT 3120 -352 Left 2 !.param ADC_VDD33 = 3.3V
TEXT 3920 1224 Left 3 ;AUX input filter
TEXT 3552 1936 Left 2 ;FS input:\n  A voltage equal to the sampling frequency in Hertz\n  must be supplied at this input.
TEXT 1688 -16 Left 2 ;Results can be found in the "SPICE Output Log" (View->"Spice Output Log" or Ctrl+L").
TEXT 1688 40 Left 2 ;3dB bandwidth (AC analysis)
TEXT 1680 160 Left 2 ;Noise parameters: dynamic range and ENOB (NOISE analysis)
TEXT 2264 -392 Left 2 ;--> Noise simulation with output BEFORE digital filtering (ADC_out)
TEXT 2264 -352 Left 2 ;--> Noise simulation with output AFTER digital filtering (ADC_out_DSP)
TEXT 4312 2296 Left 2 ;.step param decimation list 4 128 256
TEXT 3104 -312 Left 2 ;Reference
TEXT 3336 -280 Left 2 ;--> AD4081 can only be used with a 3V reference. This parameter is only used in the Dynamic Range calculations.
TEXT 3104 288 Left 2 ;ADC digital filtering
TEXT 3128 328 Left 2 ;See the "AD4081 Digital Filtering Configuration" section under the ADC in the schematic below.
TEXT 4312 2264 Left 2 !.param decimation 4
TEXT 1424 1032 Left 4 ;Input signal
TEXT 3128 48 Left 2 !.param AFE_gain = 1 ;--> AFE gain = Rf/Rg\n.param RF = 499\n.param RMFB = 499\n.param RG = {RF/AFE_gain}\n.param CFilt_1=150p\n.param CFilt_2=56p
TEXT 1704 72 Left 2 !.meas AC ADC_out_max MAX MAG(V(ADC_out))
TEXT 1704 104 Left 2 !.meas AC bw_3db FIND frequency WHEN mag(V(ADC_out))=(ADC_out_max/sqrt(2))
TEXT 4312 2408 Left 2 ;; Run a stepped simulation comparing 4 different\n; configurations of the digital filter:\n; Config 1: No digital filtering\n; Config 2: Sinc1 filter, decimation by 64\n; Config 3: Sinc5 filter, decimation by 64\n; Config 4: Sinc5 filter, decimation by 32\n;\n.step param dsp_config list 1 2 3 4\n.param sel = table(dsp_config, 1,0, 2,1, 3,2, 4,2)\n.param decimation = table(dsp_config, 1,2, 2,64, 3,64, 4,32)
TEXT 4312 2232 Left 2 !.param sel 3
TEXT 4312 2168 Left 2 ;The default configuration (sel=3, decimation=4, fs=40MHz) results in a \nCompensation filter with a bandwidth of ~2MHz.
TEXT 2736 312 Left 2 ;--> SNR
TEXT 3952 800 Left 4 ;3V external reference
LINE Normal 5216 1696 5216 1696 2
LINE Normal 4272 2736 4272 1904 2
RECTANGLE Normal 5200 2736 3504 1904 2
RECTANGLE Normal 3440 1952 2160 1056 2
RECTANGLE Normal 3888 1776 3488 1088 2
RECTANGLE Normal 3728 912 2496 528 2
RECTANGLE Normal 5168 384 3072 -512 2
RECTANGLE Normal 3056 -288 1664 -512 2
RECTANGLE Normal 3056 384 1664 -48 2
RECTANGLE Normal 2400 912 1600 528 2
RECTANGLE Normal 5168 -560 1664 -752 2
RECTANGLE Normal 2112 1952 1424 1056 2
RECTANGLE Normal 4128 1776 3920 1248 2
RECTANGLE Normal 4704 1168 3952 832 2
