Version 4
SHEET 1 2156 1876
WIRE -272 -1072 -272 -1104
WIRE -368 -1056 -368 -1088
WIRE -368 -1040 -368 -1056
WIRE -1024 -1024 -1024 -1072
WIRE -864 -1024 -864 -1072
WIRE -704 -1024 -704 -1072
WIRE -592 -1024 -592 -1072
WIRE 128 -1024 -16 -1024
WIRE 288 -1024 288 -1072
WIRE 288 -1024 128 -1024
WIRE -16 -992 -16 -1024
WIRE 288 -992 288 -1024
WIRE -272 -976 -272 -992
WIRE -368 -960 -368 -976
WIRE -1024 -944 -1104 -944
WIRE -864 -944 -1024 -944
WIRE -704 -944 -864 -944
WIRE -592 -944 -704 -944
WIRE 176 -880 144 -880
WIRE 288 -880 288 -912
WIRE 288 -880 240 -880
WIRE -320 -864 -384 -864
WIRE -272 -864 -272 -896
WIRE -272 -864 -320 -864
WIRE -240 -864 -272 -864
WIRE -16 -864 -16 -912
WIRE -16 -864 -48 -864
WIRE 32 -864 -16 -864
WIRE 128 -864 128 -944
WIRE 128 -864 96 -864
WIRE -320 -832 -320 -864
WIRE -1200 -800 -1200 -848
WIRE -1024 -800 -1024 -848
WIRE -864 -800 -864 -848
WIRE -704 -800 -704 -848
WIRE -592 -800 -592 -848
WIRE -240 -768 -272 -768
WIRE -16 -768 -48 -768
WIRE -320 -736 -320 -768
WIRE -272 -736 -272 -768
WIRE -272 -736 -320 -736
WIRE -16 -704 -16 -768
WIRE 144 -704 144 -880
WIRE 144 -704 -16 -704
WIRE -16 -688 -16 -704
WIRE -1200 -672 -1200 -720
WIRE -1104 -672 -1104 -944
WIRE -1104 -672 -1200 -672
WIRE -1024 -672 -1024 -720
WIRE -1024 -672 -1104 -672
WIRE -864 -672 -864 -720
WIRE -864 -672 -1024 -672
WIRE -704 -672 -704 -720
WIRE -704 -672 -864 -672
WIRE -592 -672 -592 -720
WIRE -592 -672 -704 -672
WIRE 288 -656 288 -880
WIRE 288 -656 16 -656
WIRE 288 -640 288 -656
WIRE -272 -560 -272 -736
WIRE -16 -560 -16 -624
WIRE -16 -560 -272 -560
WIRE 288 -560 -16 -560
WIRE -272 -528 -272 -560
WIRE -1104 -416 -1136 -416
WIRE -976 -416 -1104 -416
WIRE -720 -416 -800 -416
WIRE -336 -416 -576 -416
WIRE -208 -416 -256 -416
WIRE -80 -416 -144 -416
WIRE 48 -416 -80 -416
WIRE 192 -416 48 -416
WIRE -80 -384 -80 -416
WIRE -976 -352 -976 -416
WIRE -928 -352 -976 -352
WIRE -800 -352 -800 -416
WIRE -800 -352 -832 -352
WIRE -1104 -320 -1104 -416
WIRE -704 -320 -704 -368
WIRE -704 -320 -768 -320
WIRE -640 -320 -640 -368
WIRE -544 -320 -640 -320
WIRE 48 -320 48 -416
WIRE -928 -272 -976 -272
WIRE -800 -272 -832 -272
WIRE -80 -272 -80 -320
WIRE -1104 -176 -1104 -240
WIRE -976 -176 -976 -272
WIRE -976 -176 -1104 -176
WIRE -800 -176 -800 -272
WIRE -800 -176 -976 -176
WIRE -544 -176 -544 -320
WIRE -544 -176 -800 -176
WIRE -80 -176 -80 -208
WIRE -80 -176 -544 -176
WIRE 48 -176 48 -240
WIRE 48 -176 -80 -176
WIRE -1104 -144 -1104 -176
WIRE -768 80 -768 -320
WIRE -448 80 -768 80
WIRE -448 160 -448 80
WIRE -448 160 -464 160
FLAG -1104 -144 0
FLAG 192 -416 OUT
IOPIN 192 -416 Out
FLAG -1136 -416 IN
IOPIN -1136 -416 In
FLAG -464 160 Verr
IOPIN -464 160 Out
FLAG -272 -1104 0
FLAG -272 -528 0
FLAG -384 -864 verr
FLAG -368 -960 0
FLAG -368 -1088 ac
FLAG -864 -944 0
FLAG -1024 -848 Rpz
FLAG -864 -848 Rled
FLAG -704 -848 G
FLAG -704 -1072 K
FLAG -864 -1072 Cpole
FLAG -1024 -1072 Czero
FLAG -592 -848 fpole
FLAG -1200 -848 fzero
FLAG -592 -1072 RU
FLAG 288 -1072 OUT
IOPIN 288 -1072 In
SYMBOL ind2 -352 -400 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 4 56 VBottom 0
SYMATTR InstName L1
SYMATTR Value 100µH
SYMBOL voltage -1104 -336 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 300
SYMBOL res2 -144 -432 R90
WINDOW 0 0 32 VBottom 0
WINDOW 3 32 32 VTop 0
SYMATTR InstName R5
SYMATTR Value 20m
SYMBOL res2 -96 -384 R0
SYMATTR InstName Resr
SYMATTR Value 100m
SYMBOL cap -96 -272 R0
SYMATTR InstName Cout
SYMATTR Value 2200µF
SYMBOL XFMR1 -880 -320 R0
SYMATTR InstName U1
SYMATTR SpiceLine RATIO=.290
SYMBOL res -288 -880 M180
WINDOW 0 36 76 Left 0
WINDOW 3 36 40 Left 0
SYMATTR InstName Rpullup1
SYMATTR Value 470
SYMBOL res 304 -1008 M0
WINDOW 0 -94 23 Left 0
WINDOW 3 -106 59 Left 0
SYMATTR InstName Rupper1
SYMATTR Value {Rupper}
SYMBOL res 304 -656 M0
SYMATTR InstName Rlower1
SYMATTR Value 10K
SYMBOL res 0 -1008 M0
WINDOW 0 -65 33 Left 0
WINDOW 3 -72 60 Left 0
SYMATTR InstName Rled1
SYMATTR Value 4.7k
SYMBOL cap 240 -864 M270
WINDOW 0 32 32 VTop 0
WINDOW 3 0 32 VBottom 0
SYMATTR InstName Czero1
SYMATTR Value 1n
SYMBOL cap -304 -832 M0
SYMATTR InstName Cpole1
SYMATTR Value 22n
SYMBOL voltage -272 -976 R180
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 5
SYMBOL res 112 -1040 R0
SYMATTR InstName R4
SYMATTR Value 750
SYMBOL cap 96 -880 R90
WINDOW 0 0 32 VBottom 0
WINDOW 3 32 32 VTop 0
SYMATTR InstName C4
SYMATTR Value 10n
SYMBOL TL431 0 -688 M0
SYMATTR InstName U2
SYMBOL voltage -368 -1072 R0
WINDOW 123 11 -41 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 11 -13 Left 0
SYMATTR Value2 AC 1
SYMATTR Value ""
SYMATTR InstName V6
SYMBOL voltage -1024 -1040 R0
WINDOW 123 11 -41 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -77 119 Left 0
SYMATTR Value {Czero*100000000000}
SYMATTR InstName V7
SYMBOL voltage -864 -1040 R0
WINDOW 123 11 -41 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 24 119 Left 0
SYMATTR Value {Cpole*100000000000}
SYMATTR InstName V8
SYMBOL voltage -704 -1040 R0
WINDOW 123 11 -41 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 24 44 Left 0
SYMATTR Value {K}
SYMATTR InstName V9
SYMBOL voltage -1024 -816 R0
WINDOW 123 11 -41 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 24 44 Left 0
SYMATTR Value {Rpz}
SYMATTR InstName V10
SYMBOL voltage -864 -816 R0
WINDOW 123 11 -41 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 24 44 Left 0
SYMATTR Value {Rled}
SYMATTR InstName V11
SYMBOL voltage -704 -816 R0
WINDOW 123 11 -41 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 24 44 Left 0
SYMATTR Value {G}
SYMATTR InstName V12
SYMBOL voltage -1200 -816 R0
WINDOW 123 11 -41 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 24 44 Left 0
SYMATTR Value {Fzero}
SYMATTR InstName V13
SYMBOL voltage -592 -816 R0
WINDOW 123 11 -41 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 24 44 Left 0
SYMATTR Value {Fpole}
SYMATTR InstName V14
SYMBOL voltage -592 -1040 R0
WINDOW 123 11 -41 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 40 44 Left 0
SYMATTR Value {Rupper}
SYMATTR InstName V15
SYMBOL PWMVM -672 -384 R0
WINDOW 39 -58 -83 Left 0
SYMATTR SpiceLine L=100U Fs = 200K
SYMATTR InstName U3
SYMBOL load2 48 -320 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName I1
SYMATTR Value PULSE(6 3 1m 100u 100u 2m)
SYMBOL Optos\\PC817B -144 -816 M0
SYMATTR InstName U4
TEXT 480 -880 Left 0 !;ac oct 100 10 1meg
TEXT 480 -840 Left 0 !.include application.lib
TEXT 472 -800 Left 0 !.tran 0 5m 1u
TEXT 480 -688 Left 0 !.param Vout = 50\n \n.param Rupper = (Vout -2.5)/250u\n.param fc = 10.0k\n.param pm = 54\n.param Gfc = -9\n.param pfc = -93\n \n.param G = 10**(-Gfc/20)\n.param Boost = pm-(pfc)-90\n.param pi = 3.14159\n.param K = (tan((Boost/4+45)*pi/180))**2\n.param C2 = 1/(2*pi*fc*G*Rupper)\n.param C1 = C2*(K-1)\n.param R2 = sqrt(K)/(2*pi*fc*C1)\n.param R3 =Rupper/(K-1)\n.param C3 = 1/(2*pi*fc*sqrt(K)*R3)\n.param Fzero = fc/sqrt(K)\n.param Fpole =sqrt( K) * fc\n \n.param Rpullup = 20k\n \n.param a =(Fpole**2+fc**2)*(fc**2+Fzero**2)*(Fpole**2+fc**2)*(fc**2+Fzero**2)\n.param b =Fpole**2*Fpole**2+Fpole**2* fc**2+fc**2*Fpole**2+fc**4\n \n.param Rled = (sqrt(a)/b)*Rpullup*Fpole*Fpole/(Fzero*fc*G)\n.param Czero = 1/(2*pi*Fzero*Rupper)\n.param Cpole = 1/(2*pi*Fpole*Rpullup)\n.param Cpz = (Fpole-Fzero)/(2*Fzero*Fpole*Rled*pi)\n.param Rpz = 1/(2*pi*Fpole*Cpz)\n.param CTR = 1
TEXT 472 -728 Left 0 !.INCLUDE TL431.LIB
TEXT 480 -760 Left 0 !.INCLUDE PWMSWITCH.LIB
