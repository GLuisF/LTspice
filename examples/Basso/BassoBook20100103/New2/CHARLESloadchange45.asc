Version 4
SHEET 1 2156 1876
WIRE 240 -656 240 -688
WIRE 784 -656 736 -656
WIRE 144 -640 144 -672
WIRE 144 -624 144 -640
WIRE -512 -608 -512 -656
WIRE -352 -608 -352 -656
WIRE -192 -608 -192 -656
WIRE -80 -608 -80 -656
WIRE 576 -608 432 -608
WIRE 736 -608 736 -656
WIRE 736 -608 576 -608
WIRE 432 -576 432 -608
WIRE 736 -576 736 -608
WIRE 240 -560 240 -576
WIRE 144 -544 144 -560
WIRE -512 -528 -592 -528
WIRE -352 -528 -512 -528
WIRE -192 -528 -352 -528
WIRE -80 -528 -192 -528
WIRE 624 -464 592 -464
WIRE 736 -464 736 -496
WIRE 736 -464 688 -464
WIRE 192 -448 128 -448
WIRE 240 -448 240 -480
WIRE 240 -448 192 -448
WIRE 432 -448 432 -496
WIRE 480 -448 432 -448
WIRE 576 -448 576 -528
WIRE 576 -448 544 -448
WIRE 192 -416 192 -448
WIRE -688 -384 -688 -432
WIRE -512 -384 -512 -432
WIRE -352 -384 -352 -432
WIRE -192 -384 -192 -432
WIRE -80 -384 -80 -432
WIRE 240 -352 224 -352
WIRE 464 -352 432 -352
WIRE 192 -320 192 -352
WIRE 224 -320 224 -352
WIRE 224 -320 192 -320
WIRE 240 -320 224 -320
WIRE 464 -288 464 -352
WIRE 464 -288 432 -288
WIRE 592 -288 592 -464
WIRE 592 -288 464 -288
WIRE 432 -272 432 -288
WIRE -688 -256 -688 -304
WIRE -592 -256 -592 -528
WIRE -592 -256 -688 -256
WIRE -512 -256 -512 -304
WIRE -512 -256 -592 -256
WIRE -352 -256 -352 -304
WIRE -352 -256 -512 -256
WIRE -192 -256 -192 -304
WIRE -192 -256 -352 -256
WIRE -80 -256 -80 -304
WIRE -80 -256 -192 -256
WIRE 736 -240 736 -464
WIRE 736 -240 464 -240
WIRE 736 -224 736 -240
WIRE 240 -144 240 -320
WIRE 432 -144 432 -208
WIRE 432 -144 240 -144
WIRE 736 -144 432 -144
WIRE 240 -112 240 -144
WIRE -592 0 -624 0
WIRE -464 0 -592 0
WIRE -208 0 -288 0
WIRE 176 0 -64 0
WIRE 304 0 256 0
WIRE 432 0 368 0
WIRE 560 0 432 0
WIRE 640 0 560 0
WIRE 704 0 640 0
WIRE 432 32 432 0
WIRE -464 64 -464 0
WIRE -416 64 -464 64
WIRE -288 64 -288 0
WIRE -288 64 -320 64
WIRE -592 96 -592 0
WIRE -192 96 -192 48
WIRE -192 96 -256 96
WIRE -128 96 -128 48
WIRE -32 96 -128 96
WIRE 560 96 560 0
WIRE -416 144 -464 144
WIRE -288 144 -320 144
WIRE 432 144 432 96
WIRE 640 160 640 0
WIRE 720 160 640 160
WIRE 720 192 720 160
WIRE -592 240 -592 176
WIRE -464 240 -464 144
WIRE -464 240 -592 240
WIRE -288 240 -288 144
WIRE -288 240 -464 240
WIRE -32 240 -32 96
WIRE -32 240 -288 240
WIRE 432 240 432 208
WIRE 432 240 -32 240
WIRE 560 240 560 176
WIRE 560 240 432 240
WIRE 640 240 640 160
WIRE -592 272 -592 240
WIRE -256 288 -256 96
WIRE 336 304 240 304
WIRE 496 304 400 304
WIRE 720 304 720 272
WIRE 240 400 240 304
WIRE 272 400 240 400
WIRE 368 400 352 400
WIRE 496 400 496 304
WIRE 496 400 432 400
WIRE 640 400 640 304
WIRE 720 400 720 368
WIRE 720 400 640 400
WIRE 496 480 496 400
WIRE 496 480 400 480
WIRE 640 480 640 400
WIRE 640 480 496 480
WIRE -256 496 -256 416
WIRE -128 496 -256 496
WIRE 64 496 -48 496
WIRE 240 496 240 400
WIRE 240 496 64 496
WIRE 336 496 240 496
WIRE 432 512 400 512
WIRE -256 544 -256 496
WIRE 432 544 432 512
WIRE 640 544 640 480
WIRE 64 576 64 496
WIRE 64 576 48 576
WIRE 432 656 432 624
WIRE 640 656 640 608
WIRE -256 672 -256 608
FLAG -592 272 0
FLAG 704 0 OUT
IOPIN 704 0 Out
FLAG -624 0 IN
IOPIN -624 0 In
FLAG 48 576 Verr
IOPIN 48 576 Out
FLAG 432 656 0
FLAG 640 656 0
FLAG 240 -688 0
FLAG 240 -112 0
FLAG 128 -448 verr1
FLAG 144 -544 0
FLAG 144 -672 ac
FLAG -352 -528 0
FLAG -512 -432 Rpz
FLAG -352 -432 Rled
FLAG -192 -432 G
FLAG -192 -656 K
FLAG -352 -656 Cpole
FLAG -512 -656 Czero
FLAG -80 -432 fpole
FLAG -688 -432 fzero
FLAG -80 -656 RU
FLAG 784 -656 OUT
IOPIN 784 -656 Out
FLAG -256 672 ac
SYMBOL ind2 160 16 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 4 56 VBottom 0
SYMATTR InstName L1
SYMATTR Value 100µH
SYMBOL Opamps\\opamp 368 432 M0
WINDOW 0 278 -85 Right 0
WINDOW 39 278 -23 Right 0
WINDOW 40 278 -58 Right 0
SYMATTR InstName X1
SYMATTR SpiceLine Aol=1K
SYMBOL voltage -592 80 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 380
SYMBOL voltage 432 528 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 2.5V
SYMBOL res2 368 -16 R90
WINDOW 0 0 32 VBottom 0
WINDOW 3 32 32 VTop 0
SYMATTR InstName R5
SYMATTR Value 20m
SYMBOL res2 624 544 R0
SYMATTR InstName Rlower
SYMATTR Value 10k
SYMATTR SpiceLine tol=1 pwr=.25
SYMBOL res2 624 240 R0
WINDOW 0 -110 44 Left 0
WINDOW 3 -115 83 Left 0
SYMATTR InstName Rupper
SYMATTR Value {Rupper}
SYMBOL res2 416 32 R0
SYMATTR InstName Resr
SYMATTR Value 100m
SYMBOL cap 416 144 R0
SYMATTR InstName Cout
SYMATTR Value 2200µF
SYMBOL XFMR1 -368 96 R0
SYMATTR InstName U1
SYMATTR SpiceLine RATIO=.290
SYMBOL res 704 176 R0
SYMATTR InstName R1
SYMATTR Value {R3}
SYMBOL cap 704 304 R0
SYMATTR InstName C3
SYMATTR Value {C3}
SYMBOL cap 400 288 R90
WINDOW 0 0 32 VBottom 0
WINDOW 3 32 32 VTop 0
SYMATTR InstName C2
SYMATTR Value {C2}
SYMBOL cap 432 384 R90
WINDOW 0 0 32 VBottom 0
WINDOW 3 32 32 VTop 0
SYMATTR InstName C1
SYMATTR Value {C1}
SYMBOL res 368 384 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R2
SYMATTR Value {R2}
SYMBOL res 224 -464 M180
WINDOW 0 36 76 Left 0
WINDOW 3 36 40 Left 0
SYMATTR InstName Rpullup1
SYMATTR Value {Rpullup}
SYMBOL res 752 -592 M0
WINDOW 0 -94 23 Left 0
WINDOW 3 -106 59 Left 0
SYMATTR InstName Rupper1
SYMATTR Value {Rupper}
SYMBOL res 752 -240 M0
SYMATTR InstName Rlower1
SYMATTR Value 10K
SYMBOL res 448 -592 M0
WINDOW 0 -65 33 Left 0
WINDOW 3 -72 60 Left 0
SYMATTR InstName Rled1
SYMATTR Value {Rled}
SYMBOL cap 688 -448 M270
WINDOW 0 32 32 VTop 0
WINDOW 3 0 32 VBottom 0
SYMATTR InstName Czero1
SYMATTR Value {Czero}
SYMBOL cap 208 -416 M0
SYMATTR InstName Cpole1
SYMATTR Value {Cpole}
SYMBOL voltage 240 -560 R180
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 5
SYMBOL res 560 -624 R0
SYMATTR InstName R4
SYMATTR Value {Rpz}
SYMBOL cap 544 -464 R90
WINDOW 0 0 32 VBottom 0
WINDOW 3 32 32 VTop 0
SYMATTR InstName C4
SYMATTR Value {Cpz}
SYMBOL TL431 448 -272 M0
SYMATTR InstName U2
SYMBOL voltage 144 -656 R0
WINDOW 123 11 -41 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 11 -13 Left 0
SYMATTR Value2 AC 1
SYMATTR Value ""
SYMATTR InstName V6
SYMBOL voltage -512 -624 R0
WINDOW 123 11 -41 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -77 119 Left 0
SYMATTR Value {Czero*10000000000}
SYMATTR InstName V7
SYMBOL voltage -352 -624 R0
WINDOW 123 11 -41 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 24 119 Left 0
SYMATTR Value {Cpole*10000000000}
SYMATTR InstName V8
SYMBOL voltage -192 -624 R0
WINDOW 123 11 -41 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 24 44 Left 0
SYMATTR Value {K}
SYMATTR InstName V9
SYMBOL voltage -512 -400 R0
WINDOW 123 11 -41 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 24 44 Left 0
SYMATTR Value {Rpz}
SYMATTR InstName V10
SYMBOL voltage -352 -400 R0
WINDOW 123 11 -41 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 24 44 Left 0
SYMATTR Value {Rled}
SYMATTR InstName V11
SYMBOL voltage -192 -400 R0
WINDOW 123 11 -41 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 24 44 Left 0
SYMATTR Value {G}
SYMATTR InstName V12
SYMBOL voltage -688 -400 R0
WINDOW 123 11 -41 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 24 44 Left 0
SYMATTR Value {Fzero}
SYMATTR InstName V13
SYMBOL voltage -80 -400 R0
WINDOW 123 11 -41 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 24 44 Left 0
SYMATTR Value {Fpole}
SYMATTR InstName V14
SYMBOL voltage -80 -624 R0
WINDOW 123 11 -41 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 40 44 Left 0
SYMATTR Value {Rupper}
SYMATTR InstName V15
SYMBOL PWMVM -160 32 R0
WINDOW 39 -58 -83 Left 0
SYMATTR SpiceLine L=100U Fs = 200K
SYMATTR InstName U3
SYMBOL gain -256 352 R270
SYMATTR InstName U4
SYMATTR SpiceLine GAIN =.5
SYMBOL ind -144 512 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 5 56 VBottom 0
SYMATTR InstName L2
SYMATTR Value 1kH
SYMBOL cap -272 544 R0
SYMATTR InstName C5
SYMATTR Value 1kF
SYMBOL res 544 80 R0
SYMATTR InstName R3
SYMATTR Value 4
SYMBOL Optos\\PC817D 336 -400 M0
SYMATTR InstName U5
TEXT 224 552 Left 0 !.lib opamp.sub
TEXT 984 -408 Left 0 !.ac dec 100 10 1meg
TEXT 984 -376 Left 0 !.include application.lib
TEXT 984 -440 Left 0 !;tran 0 5m 1u
TEXT 848 -256 Left 0 !.param Vout = 50\n \n.param Rupper = (Vout -2.5)/250u\n.param fc = 10.0k\n.param pm = 100\n.param Gfc = 4\n.param pfc = -94\n \n.param G = 10**(-Gfc/20)\n.param Boost = pm-(pfc)-90\n.param pi = 3.14159\n.param K = (tan((Boost/4+45)*pi/180))**2\n.param C2 = 1/(2*pi*fc*G*Rupper)\n.param C1 = C2*(K-1)\n.param R2 = sqrt(K)/(2*pi*fc*C1)\n.param R3 =Rupper/(K-1)\n.param C3 = 1/(2*pi*fc*sqrt(K)*R3)\n.param Fzero = fc/sqrt(K)\n.param Fpole =sqrt( K) * fc\n \n.param Rpullup = 20k\n \n.param a =(Fpole**2+fc**2)*(fc**2+Fzero**2)*(Fpole**2+fc**2)*(fc**2+Fzero**2)\n.param b =Fpole**2*Fpole**2+Fpole**2* fc**2+fc**2*Fpole**2+fc**4\n \n.param Rled = (sqrt(a)/b)*Rpullup*Fpole*Fpole/(Fzero*fc*G)\n.param Czero = 1/(2*pi*Fzero*Rupper)\n.param Cpole = 1/(2*pi*Fpole*Rpullup)\n.param Cpz = (Fpole-Fzero)/(2*Fzero*Fpole*Rled*pi)\n.param Rpz = 1/(2*pi*Fpole*Cpz)\n.param CTR = 1
TEXT 984 -312 Left 0 !.INCLUDE TL431.LIB
TEXT 984 -344 Left 0 !.INCLUDE PWMSWITCH.LIB
