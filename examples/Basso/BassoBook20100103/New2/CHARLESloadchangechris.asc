Version 4
SHEET 1 2156 1876
WIRE 128 -672 128 -704
WIRE 752 -640 624 -640
WIRE 432 -592 320 -592
WIRE 464 -592 432 -592
WIRE 624 -592 624 -640
WIRE 624 -592 464 -592
WIRE 128 -560 128 -592
WIRE 320 -560 320 -592
WIRE 624 -560 624 -592
WIRE 624 -448 624 -480
WIRE 624 -448 608 -448
WIRE 80 -432 16 -432
WIRE 128 -432 128 -480
WIRE 128 -432 80 -432
WIRE 320 -432 320 -480
WIRE 336 -432 320 -432
WIRE 432 -432 432 -512
WIRE 432 -432 400 -432
WIRE 80 -400 80 -432
WIRE 464 -384 464 -592
WIRE 128 -336 112 -336
WIRE 352 -336 320 -336
WIRE 80 -304 80 -336
WIRE 112 -304 112 -336
WIRE 112 -304 80 -304
WIRE 128 -304 112 -304
WIRE 352 -272 352 -336
WIRE 352 -272 320 -272
WIRE 464 -272 464 -304
WIRE 464 -272 352 -272
WIRE 544 -272 544 -448
WIRE 544 -272 464 -272
WIRE 320 -256 320 -272
WIRE 624 -224 624 -448
WIRE 624 -224 352 -224
WIRE 624 -208 624 -224
WIRE 128 -128 128 -304
WIRE 320 -128 320 -192
WIRE 320 -128 128 -128
WIRE 624 -128 320 -128
WIRE 128 -96 128 -128
WIRE -592 0 -624 0
WIRE -464 0 -592 0
WIRE -208 0 -288 0
WIRE 96 0 -64 0
WIRE 256 0 176 0
WIRE 432 0 320 0
WIRE 560 0 432 0
WIRE 704 0 560 0
WIRE 432 32 432 0
WIRE -464 64 -464 0
WIRE -416 64 -464 64
WIRE -288 64 -288 0
WIRE -288 64 -320 64
WIRE -592 96 -592 0
WIRE -192 96 -192 48
WIRE -192 96 -256 96
WIRE -128 96 -128 48
WIRE -32 96 -128 96
WIRE 560 96 560 0
WIRE -416 144 -464 144
WIRE -288 144 -320 144
WIRE 432 144 432 96
WIRE -592 240 -592 176
WIRE -464 240 -464 144
WIRE -464 240 -592 240
WIRE -288 240 -288 144
WIRE -288 240 -464 240
WIRE -32 240 -32 96
WIRE -32 240 -288 240
WIRE 432 240 432 208
WIRE 432 240 -32 240
WIRE 560 240 560 176
WIRE 560 240 432 240
WIRE -592 272 -592 240
FLAG -592 272 0
FLAG 704 0 OUT
IOPIN 704 0 Out
FLAG -624 0 IN
IOPIN -624 0 In
FLAG 128 -704 0
FLAG 128 -96 0
FLAG 16 -432 verr
FLAG 752 -640 OUT
IOPIN 752 -640 In
FLAG -256 96 verr
SYMBOL ind2 80 16 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 4 56 VBottom 0
SYMATTR InstName L1
SYMATTR Value 100µH
SYMBOL voltage -592 80 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 380
SYMBOL res2 320 -16 R90
WINDOW 0 0 32 VBottom 0
WINDOW 3 32 32 VTop 0
SYMATTR InstName R5
SYMATTR Value 20m
SYMBOL res2 416 32 R0
SYMATTR InstName Resr
SYMATTR Value 100m
SYMBOL cap 416 144 R0
SYMATTR InstName Cout
SYMATTR Value 2200µF
SYMBOL XFMR1 -368 96 R0
SYMATTR InstName U1
SYMATTR SpiceLine RATIO=.342
SYMBOL PWMVM -160 32 R0
WINDOW 39 -58 -83 Left 0
SYMATTR SpiceLine L=100U Fs = 200K
SYMATTR InstName U3
SYMBOL res 112 -464 M180
WINDOW 0 36 76 Left 0
WINDOW 3 36 40 Left 0
SYMATTR InstName Rpullup1
SYMATTR Value 820
SYMBOL res 640 -576 M0
WINDOW 0 -94 23 Left 0
WINDOW 3 -106 59 Left 0
SYMATTR InstName Rupper1
SYMATTR Value 47k
SYMBOL res 640 -224 M0
SYMATTR InstName Rlower1
SYMATTR Value 2.50K
SYMBOL res 336 -576 M0
WINDOW 0 -65 33 Left 0
WINDOW 3 -72 60 Left 0
SYMATTR InstName Rled1
SYMATTR Value 5.6k
SYMBOL cap 608 -432 M270
WINDOW 0 32 32 VTop 0
WINDOW 3 0 32 VBottom 0
SYMATTR InstName Czero1
SYMATTR Value 1n
SYMBOL cap 96 -400 M0
SYMATTR InstName Cpole1
SYMATTR Value 12n
SYMBOL voltage 128 -576 R180
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 5
SYMBOL res 416 -608 R0
SYMATTR InstName R3
SYMATTR Value 270
SYMBOL cap 400 -448 R90
WINDOW 0 0 32 VBottom 0
WINDOW 3 32 32 VTop 0
SYMATTR InstName C4
SYMATTR Value 50n
SYMBOL TL431 336 -256 M0
SYMATTR InstName U2
SYMBOL Optos\\PC817C 224 -384 M0
SYMATTR InstName U5
SYMBOL res 544 80 R0
SYMATTR InstName R1
SYMATTR Value 8
SYMBOL res 448 -400 R0
SYMATTR InstName R2
SYMATTR Value 1k
TEXT 992 -408 Left 0 !;ac oct 100 10 1meg
TEXT 992 -376 Left 0 !.tran 0 5m 1u
TEXT 848 -256 Left 0 !.param Vout = 50\n \n.param Rupper = (Vout -2.5)/250u\n.param fc = 10.0k\n.param pm = 54\n.param Gfc = -9\n.param pfc = -93\n \n.param G = 10**(-Gfc/20)\n.param Boost = pm-(pfc)-90\n.param pi = 3.14159\n.param K = (tan((Boost/4+45)*pi/180))**2\n.param C2 = 1/(2*pi*fc*G*Rupper)\n.param C1 = C2*(K-1)\n.param R2 = sqrt(K)/(2*pi*fc*C1)\n.param R3 =Rupper/(K-1)\n.param C3 = 1/(2*pi*fc*sqrt(K)*R3)\n.param Fzero = fc/sqrt(K)\n.param Fpole =sqrt( K) * fc\n \n.param Rpullup = 20k\n \n.param a =(Fpole**2+fc**2)*(fc**2+Fzero**2)*(Fpole**2+fc**2)*(fc**2+Fzero**2)\n.param b =Fpole**2*Fpole**2+Fpole**2* fc**2+fc**2*Fpole**2+fc**4\n \n.param Rled = (sqrt(a)/b)*Rpullup*Fpole*Fpole/(Fzero*fc*G)\n.param Czero = 1/(2*pi*Fzero*Rupper)\n.param Cpole = 1/(2*pi*Fpole*Rpullup)\n.param Cpz = (Fpole-Fzero)/(2*Fzero*Fpole*Rled*pi)\n.param Rpz = 1/(2*pi*Fpole*Cpz)\n.param CTR = 1
TEXT 984 -344 Left 0 !.INCLUDE PWMSWITCH.LIB
TEXT 992 -312 Left 0 !.include application.lib
