Version 4
SHEET 1 1468 1160
WIRE -416 368 -416 256
WIRE -416 480 -416 448
WIRE -416 592 -448 592
WIRE -416 672 -416 592
WIRE -416 848 -416 752
WIRE -416 960 -416 928
WIRE -416 1008 -416 960
WIRE -384 592 -416 592
WIRE -304 256 -416 256
WIRE -288 336 -288 304
WIRE -288 592 -320 592
WIRE -288 672 -416 672
WIRE -288 752 -416 752
WIRE -240 336 -240 304
WIRE -176 592 -208 592
WIRE -176 672 -208 672
WIRE -176 672 -176 592
WIRE -176 752 -208 752
WIRE -176 752 -176 672
WIRE -176 960 -416 960
WIRE -176 960 -176 784
WIRE -160 256 -224 256
WIRE -160 368 -160 256
WIRE -160 480 -416 480
WIRE -160 480 -160 432
WIRE -144 592 -176 592
WIRE -144 752 -176 752
WIRE -144 784 -176 784
WIRE -112 480 -160 480
WIRE -112 480 -112 416
WIRE -80 256 -160 256
WIRE -80 416 -112 416
WIRE -80 480 -112 480
WIRE -48 592 -64 592
WIRE -48 672 -176 672
WIRE 48 592 16 592
WIRE 48 672 16 672
WIRE 48 672 48 592
WIRE 48 768 -80 768
WIRE 48 768 48 672
WIRE 48 816 0 816
WIRE 48 848 48 816
WIRE 48 960 -176 960
WIRE 48 960 48 928
WIRE 80 768 48 768
WIRE 80 816 48 816
WIRE 96 256 0 256
WIRE 96 288 96 256
WIRE 96 368 96 352
WIRE 96 480 0 480
WIRE 96 480 96 448
WIRE 128 688 128 624
WIRE 128 752 128 688
WIRE 128 960 48 960
WIRE 128 960 128 832
WIRE 160 256 96 256
WIRE 160 288 160 256
WIRE 160 368 160 352
WIRE 160 480 96 480
WIRE 160 480 160 448
WIRE 208 592 48 592
WIRE 208 624 128 624
WIRE 256 688 128 688
WIRE 256 832 256 688
WIRE 256 960 128 960
WIRE 256 960 256 912
WIRE 288 256 160 256
WIRE 288 368 288 256
WIRE 288 480 160 480
WIRE 288 480 288 448
WIRE 288 512 288 480
WIRE 304 960 256 960
WIRE 304 960 304 896
WIRE 336 256 288 256
WIRE 336 848 304 848
WIRE 336 848 336 768
WIRE 368 688 256 688
WIRE 368 768 336 768
WIRE 368 848 336 848
WIRE 480 848 448 848
WIRE 608 688 448 688
WIRE 608 768 448 768
WIRE 608 768 608 688
WIRE 608 848 608 768
WIRE 608 960 304 960
WIRE 608 960 608 928
WIRE 736 736 704 736
WIRE 736 848 736 736
WIRE 736 960 608 960
WIRE 736 960 736 928
WIRE 800 688 608 688
WIRE 800 736 736 736
WIRE 800 960 736 960
WIRE 800 960 800 784
WIRE 880 848 880 784
WIRE 912 848 880 848
WIRE 976 960 800 960
WIRE 976 960 976 864
WIRE 1008 688 960 688
WIRE 1008 848 976 848
FLAG -288 336 MDRV
IOPIN -288 336 In
FLAG -448 592 VOUT
IOPIN -448 592 In
FLAG -416 1008 0
FLAG 0 816 VTRI
IOPIN 0 816 Out
FLAG 208 624 PWM
IOPIN 208 624 Out
FLAG 208 592 VVEA
IOPIN 208 592 Out
FLAG 336 256 VOUT
IOPIN 336 256 Out
FLAG 288 512 0
FLAG -80 416 ISNS
IOPIN -80 416 Out
FLAG 480 848 ISNS
IOPIN 480 848 In
FLAG 880 640 0
FLAG 1008 848 PWM
IOPIN 1008 848 In
FLAG 1008 688 MDRV
IOPIN 1008 688 Out
FLAG 704 736 CLK
IOPIN 704 736 Out
FLAG -240 336 0
SYMBOL diode -144 432 R180
WINDOW 0 53 49 Left 0
WINDOW 3 43 25 Left 0
SYMATTR InstName D1
SYMATTR Value DID
SYMBOL sw -208 256 M270
WINDOW 0 77 87 VLeft 0
WINDOW 3 52 86 VLeft 0
SYMATTR InstName SW1
SYMATTR Value MSW
SYMBOL voltage -416 352 R0
WINDOW 0 39 43 Left 0
WINDOW 3 38 64 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName VIN
SYMATTR Value 100V
SYMBOL Opamps\\opamp -112 704 R0
SYMATTR InstName VEA
SYMATTR SpiceLine2 GBW=40Meg
SYMBOL res -48 576 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R3
SYMATTR Value 240K
SYMBOL cap 16 576 R90
WINDOW 0 0 32 VBottom 0
WINDOW 3 32 32 VTop 0
SYMATTR InstName C1
SYMATTR Value 220p
SYMBOL res -192 656 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R1
SYMATTR Value 100K
SYMBOL res -192 736 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R2
SYMATTR Value 10K
SYMBOL voltage -416 944 R180
WINDOW 0 -108 63 Left 0
WINDOW 3 -85 39 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName VDEM
SYMATTR Value 5V
SYMBOL sw 128 736 R0
WINDOW 0 38 42 Left 0
WINDOW 3 38 68 Left 0
SYMATTR InstName PWM
SYMATTR Value COMP
SYMBOL voltage 48 832 R0
WINDOW 0 -84 57 Left 0
WINDOW 3 -112 64 Invisible 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName VTRI
SYMATTR Value PULSE(0 5 0 9.9u 100n 0 10u)
SYMBOL res 464 672 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R5
SYMATTR Value 1K
SYMBOL voltage 608 832 R0
WINDOW 0 -78 50 Left 0
WINDOW 3 -80 74 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value 5V
SYMBOL diode -48 688 R270
WINDOW 0 32 32 VTop 0
WINDOW 3 0 32 VBottom 0
SYMATTR InstName Z1
SYMATTR Value ZID
SYMBOL ind2 -96 272 R270
WINDOW 0 60 62 VTop 0
WINDOW 3 63 58 VBottom 0
SYMATTR InstName LFILT
SYMATTR Value 100µ
SYMATTR Type ind
SYMATTR SpiceLine Rser=10m
SYMBOL cap 80 288 R0
WINDOW 0 -78 17 Left 0
WINDOW 3 -80 42 Left 0
SYMATTR InstName CFILT
SYMATTR Value 2200µ
SYMBOL res 80 352 R0
WINDOW 0 -74 43 Left 0
WINDOW 3 -75 67 Left 0
SYMATTR InstName RESR
SYMATTR Value 20mR
SYMBOL load2 288 368 R0
WINDOW 0 42 33 Left 0
WINDOW 3 42 61 Invisible 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName ILOAD
SYMATTR Value PULSE(5 15 20m 10n 10n 100u 200u)
SYMBOL cap 144 288 R0
WINDOW 0 38 19 Left 0
WINDOW 3 41 41 Left 0
SYMATTR InstName CDMP
SYMATTR Value 6800µ
SYMBOL res 144 352 R0
WINDOW 0 36 46 Left 0
WINDOW 3 36 67 Left 0
SYMATTR InstName RDMP
SYMATTR Value 220m
SYMBOL cap -320 576 R90
WINDOW 0 0 32 VBottom 0
WINDOW 3 32 32 VTop 0
SYMATTR InstName C2
SYMATTR Value 10n
SYMBOL res -192 576 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R4
SYMATTR Value 4K7
SYMBOL Digital\\dflop 880 640 R0
WINDOW 0 50 -19 Left 0
SYMATTR InstName A1
SYMATTR SpiceLine Vhigh=5 Vlow=0 Trise=10n Tfall=10n
SYMBOL voltage 736 832 R0
WINDOW 0 -81 58 Left 0
WINDOW 3 24 104 Invisible 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName CLK
SYMATTR Value PULSE(0 5 0 10n 10n 1u 10u)
SYMBOL res 16 464 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName RSNS
SYMATTR Value 50m
SYMBOL sw 256 816 M0
WINDOW 0 51 45 Left 0
WINDOW 3 37 70 Left 0
SYMATTR InstName ILIM
SYMATTR Value COMP
SYMBOL res 464 752 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R6
SYMATTR Value 5K
SYMBOL res 352 864 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 0 56 VBottom 0
SYMATTR InstName R7
SYMATTR Value 2K
SYMBOL Digital\\inv 976 784 M0
SYMATTR InstName A2
SYMATTR SpiceLine Vhigh=5 Vlow=0 Trise=10n Tfall=10n
TEXT 432 264 Left 0 !.MODEL DID D(RON=10m VFWD=0V)
TEXT 432 312 Left 0 !.MODEL MSW SW(RON=10m ROFF=1E6 VT=2.5V VH=1)
TEXT 432 384 Left 0 !.tran 0 30m 1u uic
TEXT 432 360 Left 0 !.lib opamp.sub
TEXT 432 336 Left 0 !.MODEL COMP SW(RON=10m ROFF=1E6 VT=0 VH=10m)
TEXT 432 288 Left 0 !.MODEL ZID D(RON=10m VFWD=0V VREV=6V)
