Version 4
SHEET 1 1320 696
WIRE 96 -80 16 -80
WIRE 240 -80 176 -80
WIRE 256 -80 240 -80
WIRE 16 16 16 -80
WIRE 256 16 256 -80
WIRE 400 48 320 48
WIRE 496 48 400 48
WIRE 736 48 496 48
WIRE 208 64 208 16
WIRE 224 64 208 64
WIRE 496 80 496 48
WIRE 400 96 400 48
WIRE 16 192 16 96
WIRE 256 192 256 128
WIRE 256 192 16 192
WIRE 400 192 400 160
WIRE 400 192 256 192
WIRE 496 192 496 160
WIRE 496 192 400 192
WIRE 16 224 16 192
WIRE 288 224 288 128
WIRE 176 256 144 256
WIRE 288 256 288 224
WIRE 288 256 256 256
WIRE 288 304 288 256
WIRE 528 320 464 320
WIRE 640 320 592 320
WIRE 736 320 736 48
WIRE 464 384 464 320
WIRE 480 384 464 384
WIRE 576 384 560 384
WIRE 640 384 640 320
WIRE 288 416 288 384
WIRE 336 416 288 416
WIRE 464 416 464 384
WIRE 464 416 416 416
WIRE 288 448 288 416
WIRE 640 448 640 384
WIRE 640 448 608 448
WIRE 736 448 736 400
WIRE 736 448 640 448
WIRE 464 464 464 416
WIRE 512 464 464 464
WIRE 544 464 512 464
WIRE 640 480 608 480
WIRE 640 512 640 480
WIRE 736 512 736 448
WIRE 288 544 288 512
WIRE 640 624 640 592
WIRE 736 624 736 592
WIRE 736 624 640 624
WIRE 288 656 288 624
WIRE 640 656 640 624
FLAG 16 224 0
FLAG 16 -80 In
FLAG 496 48 Out
FLAG 240 -80 Swt
FLAG 512 464 Err
FLAG 640 656 0
FLAG 288 656 0
FLAG 288 224 VCtrl
FLAG 640 480 Ref
FLAG 144 256 0
FLAG 208 16 Duty
IOPIN 208 16 Out
SYMBOL voltage 16 0 R0
SYMATTR InstName Vin
SYMATTR Value {Vin}
SYMBOL ind 80 -64 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L
SYMATTR Value {LBoost}
SYMATTR SpiceLine Rser=1.5m
SYMBOL cap 384 96 R0
SYMATTR InstName C
SYMATTR Value 220µF
SYMATTR SpiceLine Rser=1m
SYMBOL res 480 64 R0
SYMATTR InstName R
SYMATTR Value 5
SYMBOL voltage 640 496 R0
SYMATTR InstName VRef
SYMATTR Value 2.5V
SYMBOL res 720 496 R0
SYMATTR InstName RLow
SYMATTR Value {RUpper}
SYMBOL res 752 416 R180
WINDOW 0 36 76 Left 2
WINDOW 3 28 120 Left 2
SYMATTR InstName RUp
SYMATTR Value {RUpper}
SYMBOL voltage 288 528 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 2
WINDOW 0 36 49 Left 2
SYMATTR Value2 AC 1
SYMATTR InstName VInj
SYMATTR Value ""
SYMBOL res 576 368 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rs
SYMATTR Value {Rk}
SYMBOL cap 640 368 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName Cs
SYMATTR Value {Ci}
SYMBOL cap 592 304 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName Cp
SYMATTR Value {Cn}
SYMBOL ind 320 432 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName LoL
SYMATTR Value 1kH
SYMBOL cap 304 512 R180
WINDOW 0 24 56 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName CoL
SYMATTR Value 1kF
SYMBOL res 272 288 R0
SYMATTR InstName R1
SYMATTR Value 10k
SYMBOL res 272 240 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1k
SYMBOL PWM-CM 272 80 R270
WINDOW 39 157 141 VCenter 2
WINDOW 40 95 144 VCenter 2
WINDOW 123 126 139 VCenter 2
WINDOW 0 54 70 VCenter 2
SYMATTR SpiceLine2 Lsw={LBoost} Fsw=1Meg
SYMATTR Value2 RISense=-40m Slope={Se}
SYMATTR InstName X1
SYMBOL AmpSimp 576 400 M0
WINDOW 39 0 96 Invisible 2
WINDOW 40 -32 120 Invisible 2
SYMATTR InstName X2
TEXT -288 -80 Left 2 !.Param LBoost=5uH\n.Param Se=0\n.Param VIn=2.7V
TEXT -288 440 Left 2 !.Param RUpper=10k fc=8k\n.Param  pm=60 Gfc=-20 pfc=-101\n* Feedback parameters\n.Param G=10**(-Gfc/20)\n.Param Boost=pm-pfc-90\n.Param K=tan((Boost/2+45)*pi/180)\n.Param Cn=1/(2*pi*fc*G*k*RUpper)\n.Param Ci=Cn*(K**2-1)\n.Param Rk=k/(2*pi*fc*Ci)
TEXT -288 296 Left 2 !.ac dec 100 1Hz 10Meg
TEXT -288 344 Left 2 !.Step Param Se List 0 16.4k\n.Step Param VIn List 2.7 4.2
