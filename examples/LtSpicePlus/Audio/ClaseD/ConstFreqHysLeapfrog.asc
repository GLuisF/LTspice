Version 4
SHEET 1 2192 1928
WIRE -304 880 -304 112
WIRE -304 944 -304 928
WIRE -304 1040 -304 1024
WIRE -272 928 -304 928
WIRE -240 352 -240 176
WIRE -240 480 -240 432
WIRE -240 592 -240 560
WIRE -240 880 -304 880
WIRE -240 928 -272 928
WIRE -208 176 -240 176
WIRE -192 752 -192 736
WIRE -192 848 -192 832
WIRE -192 864 -192 848
WIRE -192 960 -192 944
WIRE -176 496 -192 496
WIRE -160 544 -192 544
WIRE -96 176 -128 176
WIRE -96 736 -192 736
WIRE -96 752 -96 736
WIRE -96 848 -192 848
WIRE -96 848 -96 816
WIRE -96 864 -96 848
WIRE -96 960 -96 928
WIRE -64 176 -96 176
WIRE -32 496 -64 496
WIRE -32 496 -32 400
WIRE -32 544 -64 544
WIRE -32 656 -32 544
WIRE -16 400 -32 400
WIRE -16 656 -32 656
WIRE 16 400 -16 400
WIRE 16 528 0 528
WIRE 16 656 -16 656
WIRE 48 176 16 176
WIRE 96 736 -96 736
WIRE 96 752 96 736
WIRE 96 848 96 832
WIRE 112 176 48 176
WIRE 112 192 112 176
WIRE 112 288 112 256
WIRE 112 416 80 416
WIRE 112 528 96 528
WIRE 112 528 112 416
WIRE 112 640 80 640
WIRE 112 640 112 528
WIRE 128 528 112 528
WIRE 144 176 112 176
WIRE 144 384 80 384
WIRE 144 672 80 672
WIRE 144 736 96 736
WIRE 144 768 144 736
WIRE 144 848 144 816
WIRE 192 384 144 384
WIRE 192 416 192 384
WIRE 192 528 192 480
WIRE 192 560 192 528
WIRE 192 672 144 672
WIRE 192 672 192 624
WIRE 192 752 192 736
WIRE 192 848 192 832
WIRE 224 528 192 528
WIRE 224 736 192 736
WIRE 256 112 -304 112
WIRE 256 176 224 176
WIRE 256 176 256 112
WIRE 256 192 256 176
WIRE 256 288 256 272
WIRE 256 384 192 384
WIRE 256 400 256 384
WIRE 256 528 224 528
WIRE 256 528 256 480
WIRE 256 576 256 528
WIRE 256 672 192 672
WIRE 256 672 256 656
WIRE 256 736 224 736
WIRE 288 528 256 528
WIRE 336 176 256 176
WIRE 448 528 432 528
WIRE 464 176 416 176
WIRE 464 192 464 176
WIRE 464 288 464 256
WIRE 512 176 464 176
WIRE 624 176 592 176
WIRE 640 176 624 176
WIRE 640 192 640 176
WIRE 640 288 640 256
FLAG 0 528 0
FLAG 448 528 0
FLAG 144 384 tp
FLAG 144 672 tm
FLAG -16 656 s
FLAG -16 400 r
FLAG 128 528 ix
FLAG 224 528 ic
FLAG -240 592 0
FLAG 112 288 0
FLAG 256 288 0
FLAG -96 176 x
FLAG 48 176 o
FLAG 224 736 ic
FLAG -192 960 0
FLAG -96 960 0
FLAG 144 848 0
FLAG 192 848 0
FLAG 96 848 0
FLAG -272 928 i
FLAG -304 1040 0
FLAG 464 288 0
FLAG 640 288 0
FLAG 624 176 lp
SYMBOL ind2 -80 192 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 5 56 VBottom 0
WINDOW 39 -32 56 VBottom 0
SYMATTR InstName Lo
SYMATTR Value {L}
SYMATTR SpiceLine Rser=10m Rpar=10k
SYMATTR Type ind
SYMBOL voltage -224 176 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 -32 56 Invisible 0
SYMATTR InstName Vx
SYMATTR Value 0
SYMBOL cap 96 192 R0
SYMATTR InstName Co
SYMATTR Value 680n
SYMBOL res 240 176 R0
SYMATTR InstName Ro
SYMATTR Value 6
SYMBOL Digital\\srflop -112 592 R180
WINDOW 3 0 0 Center 0
WINDOW 0 0 144 Center 0
WINDOW 123 0 -24 Center 0
WINDOW 39 0 -48 Center 0
SYMATTR Value tau=30n
SYMATTR InstName A1
SYMATTR Value2 Td=1n
SYMATTR SpiceLine tripdt=0.1n
SYMBOL Digital\\diffschmtbuf 80 464 R180
WINDOW 0 14 112 Left 0
SYMATTR InstName A2
SYMATTR SpiceLine2 Vt=0 Vh=0
SYMATTR SpiceLine tripdt=.1n
SYMBOL Digital\\diffschmtbuf 80 720 R180
SYMATTR InstName A3
SYMATTR SpiceLine2 Vt=0 Vh=0
SYMATTR SpiceLine tripdt=.1n
SYMBOL h 112 528 M270
WINDOW 0 32 56 VTop 0
WINDOW 3 -32 56 VBottom 0
SYMATTR InstName Hx
SYMATTR Value Vx 1
SYMBOL cap 368 544 R270
WINDOW 0 32 32 VTop 0
WINDOW 3 0 32 VBottom 0
WINDOW 39 -28 32 VBottom 0
SYMATTR InstName Cdi
SYMATTR Value {1/f}
SYMATTR SpiceLine Rser={Rs} Lser={Ls}
SYMBOL voltage 272 528 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 -32 56 Invisible 0
SYMATTR InstName Vdi
SYMATTR Value 0
SYMBOL e -240 464 M0
WINDOW 0 -13 11 Right 0
WINDOW 3 -13 101 Right 0
SYMATTR InstName E1
SYMATTR Value {Vm}
SYMBOL voltage 128 176 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 -32 56 Invisible 0
SYMATTR InstName Vo
SYMATTR Value 0
SYMBOL f -192 832 M180
WINDOW 0 32 67 Left 0
WINDOW 3 32 13 Left 0
SYMATTR InstName F1
SYMATTR Value Vo 1
SYMBOL cap -112 816 M180
WINDOW 0 32 51 Left 0
WINDOW 3 38 25 Left 0
WINDOW 39 32 -3 Left 0
SYMATTR InstName C1
SYMATTR Value 1n
SYMATTR SpiceLine Rpar=1
SYMBOL g2 -192 848 R0
WINDOW 0 32 29 Left 0
WINDOW 3 32 83 Left 0
SYMATTR InstName G1
SYMATTR Value .6
SYMBOL cap -112 928 M180
WINDOW 0 32 51 Left 0
WINDOW 3 39 24 Left 0
WINDOW 39 32 -3 Left 0
SYMATTR InstName C2
SYMATTR Value 1n
SYMATTR SpiceLine Rpar=1
SYMBOL e 192 736 R0
WINDOW 0 35 35 Left 0
WINDOW 3 35 67 Left 0
SYMATTR InstName E2
SYMATTR Value 1
SYMBOL Misc\\xvaristor 112 736 M0
WINDOW 0 35 35 Left 0
WINDOW 3 35 67 Left 0
SYMATTR InstName D1
SYMATTR Value lim
SYMATTR Prefix D
SYMBOL res -256 336 R0
SYMATTR InstName R1
SYMATTR Value 30m
SYMBOL voltage -304 928 R0
WINDOW 0 35 40 Left 0
WINDOW 3 35 67 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 60 56 VTop 0
SYMATTR InstName Vi
SYMATTR Value SINE({dc} {sqrt(2)*ac} {fi})
SYMBOL ind 320 192 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 5 56 VBottom 0
WINDOW 39 63 58 VTop 0
SYMATTR InstName Lo1
SYMATTR Value {Lr}
SYMATTR SpiceLine Rser={Rr}
SYMBOL cap 480 192 M0
SYMATTR InstName Co1
SYMATTR Value {Cr}
SYMBOL ind 496 192 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 5 56 VBottom 0
WINDOW 39 63 58 VTop 0
SYMATTR InstName Lo2
SYMATTR Value {Lr*100}
SYMATTR SpiceLine Rser={Rr*100}
SYMBOL cap 624 192 R0
SYMATTR InstName Co2
SYMATTR Value {Cr/100}
SYMBOL bi 256 480 M180
WINDOW 0 35 51 Left 0
WINDOW 3 19 80 Left 0
WINDOW 123 93 51 Left 0
SYMATTR InstName Btp
SYMATTR Value I=.25*(Vp-V(o))/Vp*((Vp+V(o))/{f*L}+I(Vdi))
SYMATTR Value2 Rpar=1
SYMBOL bi 256 576 R0
WINDOW 0 35 51 Left 0
WINDOW 3 19 80 Left 0
WINDOW 123 93 51 Left 0
SYMATTR InstName Btm
SYMATTR Value I=.25*(Vm-V(o))/Vm*((Vm+V(o))/{f*L}+I(Vdi))
SYMATTR Value2 Rpar=1
SYMBOL cap 208 416 M0
SYMATTR InstName Ctp
SYMATTR Value 1n
SYMBOL cap 208 560 M0
SYMATTR InstName Ctm
SYMATTR Value 1n
TEXT 528 448 Left 0 !.param L=30u f=350k fa=22k Vs=50\n+ wm=2*pi*fa Ls=f/wm**2 Rs=f/wm\n+ Vp=Vs Vm=-Vs
TEXT 32 888 Left 0 !.model lim d(Ron=1m\n+ Vfwd=12 Vrev=12)
TEXT -272 1032 Left 0 !.param dc=0 ac=1 fi=5k
TEXT 304 1032 Left 0 !.tran {dt} {Tend} {Tdata} {dt} uic ; uic required for switching amps
TEXT -272 1064 Left 0 !.step param dc list 30 40 45 48 ; 50
TEXT 304 736 Left 0 !.param nfft=16384 nc=16
TEXT 304 328 Left 0 !.param Rr=1k2 fr=50k\n.param Lr=500/pi/fr Cr=500u/pi/fr ; Zr=1k
TEXT 304 784 Left 0 !.four {fi} {int(fr/fi)} {nc} V(lp) ; freq, harmonics, periods, source\n.save V(lp) ; save low pass output
TEXT 304 928 Left 0 !.param Tdata=nc/2/fi ; depends on settling time of simulation\n.param dt=1/fi/nfft ; calculated based on above inputs\n.param Tend=Tdata+dt+nc/fi ; calculated to yield nc cycles of data
TEXT 304 856 Left 0 !.options numdgt=16 ; no data digit compression\n.options plotwinsize=0 ; no data time compression
TEXT 224 696 Center 0 ;Icmd
TEXT 472 544 Left 0 ;di/dt calculation
TEXT -280 688 Left 0 ;output current\nfeed forward
TEXT 336 56 Center 0 ;Leapfrog/"Constant Frequency" Hysteresis class-d amp (simplified)
LINE Normal -144 304 -160 224 1
LINE Normal 16 496 -144 304 1
LINE Normal 16 496 16 496 1
LINE Normal 16 496 16 496 1
LINE Normal 16 496 16 496 1
LINE Normal 16 496 16 496 1
LINE Normal 16 496 16 496 1
LINE Normal 16 496 16 496 1
