Version 4
SHEET 1 16872 2188
WIRE -1184 384 -1184 336
WIRE -1184 464 -1184 496
WIRE -880 336 -1184 336
WIRE -800 336 -720 336
WIRE -720 384 -720 336
WIRE -720 336 -624 336
WIRE -720 448 -720 480
WIRE 608 384 608 336
WIRE 608 464 608 496
WIRE 496 336 608 336
WIRE 496 336 496 384
WIRE 496 464 496 496
WIRE -320 1056 -320 1088
WIRE 80 768 -16 768
WIRE -608 768 -608 864
WIRE -608 928 -608 992
WIRE -608 768 -816 768
WIRE -816 768 -816 848
WIRE -816 928 -816 992
WIRE -688 1504 -688 1472
WIRE -688 1584 -688 1600
WIRE -688 1600 -640 1600
WIRE -688 1600 -688 1632
WIRE -688 1712 -688 1760
WIRE -688 1760 -608 1760
WIRE 16 1648 16 1680
WIRE 16 1568 16 1536
WIRE 16 1536 -32 1536
WIRE -128 1536 -128 1568
WIRE -128 1648 -128 1680
WIRE -688 1472 -640 1472
WIRE -688 1472 -688 1408
WIRE -688 1328 -688 1264
WIRE -688 1264 -624 1264
WIRE -32 1536 -128 1536
WIRE -688 1808 -688 1760
WIRE -688 1888 -688 1920
WIRE -1200 1328 -1200 1264
WIRE -1200 1264 -688 1264
WIRE -1200 1408 -1200 1584
WIRE -1200 1760 -688 1760
WIRE -1200 1664 -1200 1760
WIRE -816 768 -944 768
WIRE -1200 768 -1200 832
WIRE -1200 912 -1200 992
WIRE -1088 768 -1200 768
WIRE -944 864 -944 768
WIRE -944 768 -1024 768
WIRE -944 928 -944 992
WIRE -112 896 -112 768
WIRE -112 976 -112 992
WIRE -112 496 -112 464
WIRE -112 384 -112 336
WIRE -112 336 -32 336
WIRE 704 336 608 336
WIRE 80 800 80 768
WIRE -240 496 -240 448
WIRE -240 368 -240 336
WIRE 80 880 80 896
WIRE -320 768 -608 768
WIRE -112 768 -320 768
WIRE -112 1296 -112 1264
WIRE -112 1264 16 1264
WIRE -112 1376 -112 1392
WIRE -16 768 -112 768
WIRE -112 336 -240 336
WIRE -320 976 -320 768
WIRE -832 1568 -832 1600
WIRE -688 1472 -832 1472
WIRE -832 1472 -832 1488
WIRE -688 1600 -832 1600
FLAG -1184 496 0
FLAG -720 480 0
FLAG 704 336 LowRate
FLAG 608 496 0
FLAG 496 496 0
FLAG -320 1088 0
FLAG 16 1264 SOC
FLAG -608 992 0
FLAG -816 992 0
FLAG -640 1472 Cell+
FLAG -640 1600 Cell-
FLAG -608 1760 EXT-
IOPIN -608 1760 In
FLAG 16 1680 0
FLAG -128 1680 0
FLAG -624 1264 EXT+
IOPIN -624 1264 In
FLAG -32 1536 SODC
FLAG -688 1920 0
FLAG -1200 992 0
FLAG -944 992 0
FLAG -112 992 0
FLAG -112 496 0
FLAG -624 336 Rate_d
FLAG -32 336 LostRate
FLAG -240 496 0
FLAG 80 896 0
FLAG -112 1392 0
FLAG -16 768 Charge
SYMBOL Misc\\Epoly -1184 368 R0
WINDOW 3 9 164 Left 0
SYMATTR Value VALUE = {  IF( (I(V_sense)>0 & V(Cell+,Cell-)>0), I(V_Sense)/CAPAH, CHEFF*I(V_Sense)/CAPAH ) }
SYMATTR InstName E_Rate
SYMBOL res -896 352 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 0 56 VBottom 0
SYMATTR InstName R2
SYMATTR Value 1
SYMBOL cap -736 384 R0
SYMATTR InstName C1
SYMATTR Value 1
SYMBOL Misc\\Epoly 608 368 R0
SYMATTR InstName E_LowRate
SYMATTR Value TABLE { V(Rate_d) } = (0,0) (0.001,0.15) (0.1,0.1) (0.2,0)
SYMBOL res 480 368 R0
SYMATTR InstName R3
SYMATTR Value 1G
SYMBOL Misc\\Gpoly -320 960 R0
SYMATTR InstName G_LowRate
SYMATTR Value VALUE = { IF( (I(V_sense)>0 & V(Cell+,Cell-))>0, V(LowRate)*I(V_Sense), 0) }
SYMBOL Misc\\Epoly -112 368 R0
WINDOW 0 92 21 Bottom 0
SYMATTR InstName E_LostRate
SYMATTR Value TABLE { V(Rate_d) } = (0.2,0.0) (1.0,0.1) (5,0.2)
SYMBOL cap -624 864 R0
SYMATTR InstName C_CellCapacity
SYMATTR Value { 3600 * CAPAH }
SYMBOL res -832 832 R0
SYMATTR InstName R1
SYMATTR Value 1MEG
SYMBOL res -704 1312 R0
SYMATTR InstName R_Cell
SYMATTR Value {R_SER}
SYMBOL voltage -688 1728 R180
WINDOW 0 24 104 Left 0
WINDOW 3 24 16 Left 0
SYMATTR InstName V_Sense
SYMATTR Value 0
SYMBOL Misc\\Epoly 16 1552 R0
SYMATTR InstName E_Invert
SYMATTR Value TABLE { V(SOC) } = (-1,2) (0,1) (1,0)
SYMBOL res -144 1552 R0
SYMATTR InstName R4
SYMATTR Value 1G
SYMBOL Misc\\Epoly -688 1488 R0
WINDOW 3 -589 500 Left 0
SYMATTR Value TABLE { V(SODC) } = (0.0 1.3346) (0.0293 1.3042) (0.0426 1.2942) (0.0689 1.2841) (0.13 1.2733) (0.436 1.2633) (0.512 1.2532) (0.580 1.2432) (0.646 1.2331) (0.702 1.2231) (0.7583 1.2130) (8.0324E-01 1.2030) (0.831 1.1929) (0.851 1.1828) (0.908 1.1425) 0.948 1.0919) (0.980 0.987) (0.99 0.9352) (0.995 0.8272) (0.996 0.741) (0.997 0.647)(0.998 0.514) (0.999 0.33) (1.0000 0.0) (1.1 -10)
SYMATTR InstName E_Cell
SYMBOL res -704 1792 R0
SYMATTR InstName Rx1
SYMATTR Value 1µ
SYMBOL res -1216 1312 R0
SYMATTR InstName Rx2
SYMATTR Value 1
SYMBOL voltage -1200 1568 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 14 141 Left 0
SYMATTR Value PULSE(-1 2.4 5000 1 1 10000)
SYMATTR InstName VX
SYMBOL voltage -1200 816 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 0.993
SYMBOL diode -1024 752 R90
WINDOW 0 0 32 VBottom 0
WINDOW 3 28 32 VBottom 0
WINDOW 38 63 31 VBottom 0
SYMATTR InstName D1
SYMATTR Value ""
SYMATTR SpiceModel DFULL
SYMBOL diode -928 928 R180
WINDOW 0 -41 46 Left 0
WINDOW 38 -63 2 Left 0
SYMATTR InstName D2
SYMATTR SpiceModel DREV
SYMATTR Value ""
SYMBOL Misc\\Gpoly -112 992 R180
WINDOW 0 -146 96 Left 0
WINDOW 3 -882 14 Left 0
SYMATTR InstName G_HighRate
SYMATTR Value VALUE = { IF( I(V_sense)>0 & V(Cell+,Cell-)>0, V(LostRate)*I(V_Sense), 0) }
SYMBOL res -256 352 R0
SYMATTR InstName R5
SYMATTR Value 1G
SYMBOL Misc\\Gpoly 80 896 R180
WINDOW 0 -206 88 Left 0
WINDOW 3 -1020 4 Left 0
SYMATTR InstName G_DisCharge
SYMATTR Value VALUE = { IF( I(V_Sense)>0 ^ (V(Cell+,Cell-)<0), I(V_Sense), I(V_Sense)*CHEFF) }
SYMBOL Misc\\Epoly -112 1280 R0
SYMATTR InstName E_Rate1
SYMATTR Value TABLE { V(Charge) } = (-1,-1) (1,1)
SYMBOL res -848 1472 R0
SYMATTR InstName R_dis
SYMATTR Value {R_DIS}
TEXT -1256 1208 Left 0 !.tran 0 15000 0 1
TEXT -816 -72 Left 0 !.PARAM CAPAH=1.8
TEXT -816 -40 Left 0 !.PARAM R_SER=0.1
TEXT -808 96 Left 0 !.IC V(Charge)={SOC}\n.NODESET V(Charge)={SOC}\n.PARAM R_DIS={VCELL/(SELFDC*CAPAH)}
TEXT -1160 640 Left 0 !.model DFULL  D(Is=1e-6 N=0.02)
TEXT -1160 680 Left 0 !.model DREV  D(Is=1e-8 N=0.02)
TEXT 496 280 Left 0 ;HIgher capacity for discharge current below 0.2*C
TEXT -240 280 Left 0 ;Lower capacity for discharge current above  0.2*C
TEXT -816 56 Left 0 !.PARAM CHEFF=0.7
TEXT -816 -8 Left 0 !.PARAM SELFDC=0.00028
TEXT -1184 240 Left 0 ;Actual rate of discharge from external load\ne.g. 0.2 means a full battery battery would last 5hours(=1/0.2).
TEXT -120 1224 Left 0 ;State of charge is actually just a 1 to 1 transform of "Charge"
TEXT -144 1480 Left 0 ;State of Discharge = 1-SOC
TEXT -760 696 Left 0 ;The charge model\nOvercharge and discharge clamped with diodes
TEXT -640 1544 Left 0 ;Charge to voltage translation with E-TABLE
TEXT -816 24 Left 0 !.PARAM SOC=1
TEXT -816 -104 Left 0 !.PARAM VCELL=1.2
TEXT -384 -112 Left 0 ;VCELL   nominal cell voltage in volt, e.g. 1.2\nCAPAH  cell capacity in Ah(ampere*hours), e.g. 1.8\nR_SER  series resistance in Ohms, e.g 0.2 \nSOC       state of charge (0..1, 0=empty, 1=full)\nCHEFF   charging effeciency, e.g 0.7  means you need 1/0.7 times the ampere*hours to charge fully\nSELFDC  self discharge per hour, e.g. 0.00028 if 20%/per month
TEXT -1184 -96 Left 0 ;The Rechargable Battery\nHelmut Sennewald \nV2.0  date 02/22/04
TEXT -472 1904 Left 0 ;The last table netry (1.1 -10) together with the clamped reverse voltage(D2) defines the battery voltage in reverse mode.\nIf this entry is omitted, then the battery will clamp to zero volts.
TEXT -1288 1136 Left 0 ;External test stimulus for charge and discharge test
TEXT -1024 1208 Left 0 !.OP
RECTANGLE Normal -896 1808 -1288 1176 2
