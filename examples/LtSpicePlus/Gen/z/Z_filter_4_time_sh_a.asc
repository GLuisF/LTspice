Version 4
SHEET 1 2344 1348
WIRE 80 160 80 128
WIRE 80 240 80 288
WIRE 80 128 144 128
WIRE 1072 144 1072 112
WIRE 1072 224 1072 272
WIRE 1072 112 1136 112
WIRE 304 592 368 592
WIRE 496 592 560 592
WIRE 128 752 128 720
WIRE 128 640 128 592
WIRE 128 592 160 592
WIRE 368 592 432 592
WIRE 560 592 624 592
WIRE 688 592 752 592
WIRE 992 752 992 720
WIRE 992 640 992 592
WIRE 752 592 800 592
WIRE 992 592 1072 592
WIRE 160 592 240 592
WIRE 592 128 144 128
WIRE 656 128 720 128
WIRE 1536 144 1536 112
WIRE 1536 224 1536 272
WIRE 1536 112 1600 112
WIRE 864 592 912 592
WIRE 912 592 928 592
WIRE 2208 -656 2272 -656
FLAG 80 288 0
FLAG 144 128 in0
FLAG 1072 272 0
FLAG 1136 112 z_phase1
FLAG 128 752 0
FLAG 368 592 z_1
FLAG 560 592 z_2
FLAG 752 592 z_3
FLAG 992 752 0
FLAG 160 592 sum
FLAG 1072 592 out
IOPIN 1072 592 Out
FLAG 720 128 in
IOPIN 720 128 Out
FLAG 1536 272 0
FLAG 1600 112 z_phase2
FLAG 912 592 z_4
SYMBOL voltage 80 144 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value PULSE(-1 +1 0 10n 10n 5m 10m)
SYMBOL voltage 1072 128 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value PULSE(0 1 0 10n 10n {1m*TS} {TS})
SYMBOL bv 128 624 R0
SYMATTR InstName SUM1
SYMATTR Value V={G1}*V(in) -(A1*V(z_1)+A2*V(z_2)+A3*V(z_3)+A4*V(z_4))
SYMBOL bv 992 624 R0
SYMATTR InstName SUM2
SYMATTR Value V=B0*V(sum) + B1*V(z_1) + B2*V(z_2) + B3*V(z_3) + B4*V(z_4)
SYMBOL voltage 1536 128 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value PULSE(0 1 {2m*TS} 10n 10n {1m*TS} {TS})
SYMBOL D:\\WUTemp\\Z-transform\\Z_1_sh 272 592 R0
SYMATTR InstName X3
SYMATTR SpiceLine TS={TS}
SYMBOL D:\\WUTemp\\Z-transform\\Z_1_sh 464 592 R0
SYMATTR InstName X1
SYMATTR SpiceLine TS={TS}
SYMBOL D:\\WUTemp\\Z-transform\\Z_1_sh 656 592 R0
SYMATTR InstName X2
SYMATTR SpiceLine TS={TS}
SYMBOL D:\\WUTemp\\Z-transform\\Z_0_sh 624 128 R0
SYMATTR InstName X4
SYMBOL D:\\WUTemp\\Z-transform\\Z_1_sh 832 592 R0
SYMATTR InstName X5
SYMATTR SpiceLine TS={TS}
TEXT 0 -264 Left 0 !.PARAM FS=10k
TEXT 0 -232 Left 0 !.PARAM TS=1/FS
TEXT 8 -312 Left 0 !.tran 15m
TEXT 0 -96 Left 0 !.PARAM  G1=0.00482434336   \n.PARAM   B0=1  B1=4  B2=6  B3=4  B4=1\n.PARAM   A0=1.0  A1=-2.369513   A2=2.3139884 A3=-1.0546654  A4=0.187379492
TEXT 232 -352 Left 0 ;.options plotwinsize=0
TEXT 8 -352 Left 0 !.options reltol=1e-5
TEXT 1824 120 Left 0 !.GLOBAL z_phase1\n.GLOBAL z_phase2
TEXT 48 504 Left 0 ;Direct Form II
TEXT 1104 64 Left 0 ;Pulses Generators used by  |Z-1| and |Z-0|
TEXT 0 -128 Left 0 ;Example: 4th order Butterworth lowpass, fg=0.1*fs
TEXT 232 -264 Left 0 ;sampling frequency
TEXT 584 56 Left 0 ;Sampler
TEXT 72 72 Left 0 ;Source for step response
TEXT 544 216 Left 0 ;Aperture time is 1e-3*TS_period
TEXT 16 -768 Left 0 ;Simulation Of Sampled Systems with Z-transform\n \nThe input signal is sampled with the z^0 sampler with nearly zero delay.\nIt may be replaced by your A/D converter.\n \nTwo realizations of Z-transform filters have been investigated, "Direct Form II" \nand "Direct Transposed Form II". I recommend to go with " Direct Form II",\nbecause it is less effort to use it in SPICE. The used delay elements z^-1\nconsist of sample and hold stages with switches and capaciors. They \ncan't be used for a frequency analysis. A second schematic with e^-sT\ndelay elements is necessary for the AC analysis.\n \nH(z) = G1 * ( B0 + B1*z^-1 + B2*z^-2  + .... Bn*z^-n) / (1 + A1*z^^-1 + A2*z^-2 + A3*z^-3 + ... Am*z^-m)    B0 = 1
TEXT 1224 512 Left 0 ;Delay with sample and hold z_1_sh.asy
TEXT 536 264 Left 0 ;Sample and hold z_0_sh.asy
TEXT 1736 -344 Left 0 ;Z
TEXT 1752 -360 Left 0 ;-1
TEXT 1912 -344 Left 0 ;Z
TEXT 1928 -360 Left 0 ;-1
TEXT 1560 -344 Left 0 ;Z
TEXT 1576 -360 Left 0 ;-1
TEXT 1384 -344 Left 0 ;Z
TEXT 1400 -360 Left 0 ;-1
TEXT 1648 -224 Left 0 ;A2
TEXT 1472 -224 Left 0 ;A1
TEXT 1824 -224 Left 0 ;A3
TEXT 2000 -224 Left 0 ;A4
TEXT 1104 -352 Left 0 ;G1
TEXT 1208 -352 Left 0 ;+
TEXT 1048 -368 Left 0 ;IN
TEXT 1328 -160 Left 0 ;+
TEXT 1328 -128 Left 0 ;+
TEXT 1328 -96 Left 0 ;+
TEXT 1328 -64 Left 0 ;+
TEXT 1232 -336 Left 0 ;-
TEXT 1648 -512 Left 0 ;B2
TEXT 1472 -512 Left 0 ;B1
TEXT 1824 -512 Left 0 ;B3
TEXT 2000 -512 Left 0 ;B4
TEXT 2152 -688 Left 0 ;+
TEXT 2152 -656 Left 0 ;+
TEXT 2152 -624 Left 0 ;+
TEXT 2152 -592 Left 0 ;+
TEXT 1296 -512 Left 0 ;B0
TEXT 2152 -720 Left 0 ;+
TEXT 2232 -680 Left 0 ;OUT
TEXT 1288 -336 Left 0 ;sum
TEXT 1552 -768 Left 0 ;Direct Form II  4th Order System
LINE Normal 1536 -352 1440 -352
LINE Normal 1536 -352 1536 -352
LINE Normal 1712 -352 1616 -352
LINE Normal 1712 -352 1712 -352
LINE Normal 1888 -352 1792 -352
LINE Normal 2016 -352 1968 -352
LINE Normal 1488 -352 1488 -256
LINE Normal 1664 -352 1664 -256
LINE Normal 1840 -352 1840 -256
LINE Normal 2016 -352 2016 -256
LINE Normal 1488 -160 1488 -192
LINE Normal 1344 -160 1488 -160
LINE Normal 1664 -128 1664 -192
LINE Normal 1344 -128 1664 -128
LINE Normal 1840 -96 1840 -192
LINE Normal 1344 -96 1840 -96
LINE Normal 2016 -64 2016 -192
LINE Normal 1344 -64 2016 -64
LINE Normal 1248 -112 1280 -112
LINE Normal 1232 -112 1248 -112
LINE Normal 1232 -320 1232 -112
LINE Normal 1360 -352 1312 -352
LINE Normal 1360 -352 1360 -352
LINE Normal 1264 -352 1312 -352
LINE Normal 1088 -352 1056 -352
LINE Normal 1088 -352 1088 -352
LINE Normal 1200 -352 1152 -352
LINE Normal 1200 -352 1200 -352
LINE Normal 1664 -480 1664 -352
LINE Normal 1488 -480 1488 -352
LINE Normal 1840 -480 1840 -352
LINE Normal 2016 -480 2016 -352
LINE Normal 1312 -480 1312 -352
LINE Normal 1488 -640 1488 -544
LINE Normal 1488 -688 1488 -640
LINE Normal 2144 -688 1488 -688
LINE Normal 1664 -624 1664 -544
LINE Normal 1664 -656 1664 -624
LINE Normal 1840 -624 1840 -544
LINE Normal 1840 -624 1840 -624
LINE Normal 2016 -560 2016 -544
LINE Normal 2016 -592 2016 -560
LINE Normal 1312 -624 1312 -544
LINE Normal 1312 -720 1312 -624
LINE Normal 2144 -656 1664 -656
LINE Normal 2144 -624 1840 -624
LINE Normal 2144 -592 2016 -592
LINE Normal 2144 -720 1312 -720
RECTANGLE Normal 1696 816 -16 464 2
RECTANGLE Normal 2064 320 1008 32 2
RECTANGLE Normal 960 320 528 32 2
RECTANGLE Normal 480 320 0 32 2
RECTANGLE Normal 1792 -320 1712 -384
RECTANGLE Normal 1968 -320 1888 -384
RECTANGLE Normal 1616 -320 1536 -384
RECTANGLE Normal 1440 -320 1360 -384
RECTANGLE Normal 1344 -48 1280 -176
RECTANGLE Normal 2208 -576 2144 -736
CIRCLE Normal 1696 -192 1632 -256
CIRCLE Normal 1520 -192 1456 -256
CIRCLE Normal 1872 -192 1808 -256
CIRCLE Normal 2048 -192 1984 -256
CIRCLE Normal 1152 -320 1088 -384
CIRCLE Normal 1264 -320 1200 -384
CIRCLE Normal 1696 -480 1632 -544
CIRCLE Normal 1520 -480 1456 -544
CIRCLE Normal 1872 -480 1808 -544
CIRCLE Normal 2048 -480 1984 -544
CIRCLE Normal 1344 -480 1280 -544
