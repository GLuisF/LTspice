Version 4
SHEET 1 4472 3404
WIRE 416 240 416 192
WIRE 416 192 992 192
WIRE 1248 192 1328 192
WIRE 1440 192 1520 192
WIRE 1712 192 1792 192
WIRE 1792 192 1792 400
WIRE 1792 464 1792 720
WIRE 1792 720 1520 720
WIRE 416 720 416 320
WIRE 1520 432 1520 192
WIRE 1520 192 1632 192
WIRE 1520 496 1520 720
WIRE 1520 720 1328 720
WIRE 1328 368 1328 192
WIRE 1328 192 1376 192
WIRE 1328 464 1328 720
WIRE 1328 720 992 720
WIRE 1280 448 1200 448
WIRE 1328 720 1328 784
WIRE 1968 384 1968 192
WIRE 1968 192 1792 192
WIRE 1968 464 1968 720
WIRE 1968 720 1792 720
WIRE 1696 1072 1696 1120
WIRE 1696 1120 1744 1120
WIRE 1792 1120 1792 1072
WIRE 1696 992 1696 960
WIRE 1792 992 1792 960
WIRE 1744 1120 1792 1120
WIRE 1360 1488 1312 1488
WIRE 1360 1360 1312 1360
WIRE 1312 1360 1312 1488
WIRE 1312 1488 1264 1488
WIRE 1424 1360 1456 1360
WIRE 1456 1360 1456 1504
WIRE 1456 1504 1424 1504
WIRE 1456 1504 1536 1504
WIRE 1456 1504 1456 1760
WIRE 1456 1760 1104 1760
WIRE 1024 1760 512 1760
WIRE 512 1760 512 1696
WIRE 512 1504 704 1504
WIRE 704 1472 592 1472
WIRE 592 1472 592 1552
WIRE 1184 1488 1136 1488
WIRE 1056 1488 1040 1488
WIRE 944 1488 880 1488
WIRE 1360 1520 1312 1520
WIRE 1312 1520 1312 1600
WIRE 672 1696 656 1696
WIRE 560 1696 512 1696
WIRE 512 1696 512 1616
WIRE 752 1696 800 1696
WIRE 880 1696 880 1568
WIRE 880 1488 768 1488
WIRE 880 1568 1040 1568
WIRE 880 1568 880 1488
WIRE 1040 1568 1040 1488
WIRE 1040 1488 1024 1488
WIRE 512 1616 656 1616
WIRE 512 1616 512 1504
WIRE 656 1616 656 1696
WIRE 656 1696 640 1696
WIRE 864 1056 1008 1056
WIRE 2704 1776 2896 1776
WIRE 2624 1776 2496 1776
WIRE 2416 1776 2384 1776
WIRE 2272 1776 2160 1776
WIRE 2080 1776 1888 1776
WIRE 2384 1776 2384 1600
WIRE 2384 1776 2352 1776
WIRE 2384 1600 2272 1600
WIRE 2272 1568 2384 1568
WIRE 2384 1568 2384 1440
WIRE 2384 1440 2144 1440
WIRE 2144 1440 2144 1584
WIRE 2144 1584 2208 1584
WIRE 2144 1584 2016 1584
WIRE 1072 1072 1280 1072
WIRE 560 592 480 592
WIRE 480 592 480 944
WIRE 560 512 352 512
WIRE 928 512 896 512
WIRE 992 384 992 448
WIRE 992 304 992 192
WIRE 656 592 656 720
WIRE 992 720 992 560
WIRE 992 448 1120 448
WIRE 992 448 992 464
WIRE 992 192 1168 192
WIRE 992 720 656 720
WIRE 656 720 416 720
WIRE 816 512 656 512
WIRE 1072 1040 1392 1040
FLAG 1328 784 0
FLAG 1968 192 out
FLAG 1696 960 15
FLAG 1792 960 -15
FLAG 1744 1120 0
FLAG 736 1456 15
FLAG 1392 1472 15
FLAG 736 1520 -15
FLAG 1392 1536 -15
FLAG 592 1552 0
FLAG 1312 1600 0
FLAG 1536 1504 tri
IOPIN 1536 1504 Out
FLAG 1040 1024 15
FLAG 1040 1088 -15
FLAG 416 192 in
FLAG 2896 1776 15
FLAG 1888 1776 -15
FLAG 2240 1552 15
FLAG 2240 1616 -15
FLAG 2016 1584 ref
IOPIN 2016 1584 Out
FLAG 864 1056 pwm
IOPIN 864 1056 Out
FLAG 480 944 0
FLAG 352 512 pwm
IOPIN 352 512 In
FLAG 1392 1040 tri
IOPIN 1392 1040 In
FLAG 1280 1072 ref
IOPIN 1280 1072 In
SYMBOL Misc\\battery 416 224 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 6
SYMBOL ind 1152 208 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 5 56 VBottom 0
SYMATTR InstName L1
SYMATTR Value 10m
SYMATTR SpiceLine Rser=0.02 Rpar=5000 Cpar=80p
SYMBOL ind 1728 208 M270
WINDOW 0 32 56 VTop 0
WINDOW 3 5 56 VBottom 0
SYMATTR InstName L2
SYMATTR Value 4.7m
SYMATTR SpiceLine Rser=0.02 Rpar=5000 Cpar=80p
SYMBOL polcap 1440 176 R90
WINDOW 0 0 32 VBottom 0
WINDOW 3 -62 18 VTop 0
SYMATTR InstName C2
SYMATTR Value 470n ic={cap}
SYMBOL polcap 1808 464 R180
WINDOW 0 24 57 Left 0
WINDOW 3 24 8 Left 0
SYMATTR InstName C3
SYMATTR Value 1µ ic={cap}
SYMBOL res 1952 368 R0
SYMATTR InstName R5
SYMATTR Value 2.2k
SYMBOL res 1104 464 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 0 56 VBottom 0
SYMATTR InstName R1
SYMATTR Value 2.2
SYMBOL res 928 1504 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 132 14 VBottom 0
SYMATTR InstName R2
SYMATTR Value {{POT}*(1-{alfa1})}
SYMBOL res 1040 1504 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 -21 123 VBottom 0
SYMATTR InstName R3
SYMATTR Value {{POT}*{alfa1}}
SYMBOL res 1168 1504 R270
WINDOW 0 75 56 VTop 0
WINDOW 3 70 56 VBottom 0
SYMATTR InstName R4
SYMATTR Value 10k
SYMBOL res 544 1712 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 -77 -5 VBottom 0
SYMATTR InstName R6
SYMATTR Value {{POT}*(1-{alfa2})}
SYMBOL res 656 1712 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 -4 145 VBottom 0
SYMATTR InstName R7
SYMATTR Value {{POT}*{alfa2}}
SYMBOL res 784 1712 R270
WINDOW 0 75 53 VTop 0
WINDOW 3 71 54 VBottom 0
SYMATTR InstName R8
SYMATTR Value 100k
SYMBOL cap 1424 1344 R90
WINDOW 0 0 32 VBottom 0
WINDOW 3 32 32 VTop 0
SYMATTR InstName C1
SYMATTR Value 1n
SYMBOL res 1008 1776 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 0 56 VBottom 0
SYMATTR InstName R9
SYMATTR Value 100k
SYMBOL Misc\\battery 1696 976 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 15
SYMBOL Misc\\battery 1792 976 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value -15
SYMBOL res 2720 1792 M270
WINDOW 0 32 56 VTop 0
WINDOW 3 0 56 VBottom 0
SYMATTR InstName R10
SYMATTR Value 47k
SYMBOL res 2512 1792 M270
WINDOW 0 32 56 VTop 0
WINDOW 3 -20 13 VBottom 0
SYMATTR InstName R11
SYMATTR Value {{POT}*(1-{alfa3})}
SYMBOL res 2368 1792 M270
WINDOW 0 32 56 VTop 0
WINDOW 3 -24 104 VBottom 0
SYMATTR InstName R12
SYMATTR Value {{POT}*{alfa3}}
SYMBOL res 2176 1792 M270
WINDOW 0 32 56 VTop 0
WINDOW 3 0 56 VBottom 0
SYMATTR InstName R14
SYMATTR Value 47k
SYMBOL ind2 544 608 M180
WINDOW 0 -54 72 Left 0
WINDOW 3 135 27 Left 0
SYMATTR InstName L3
SYMATTR Value 3m
SYMATTR Type ind
SYMATTR SpiceLine Rser=2.6 Rpar=1.4k Cpar=80p
SYMBOL ind2 672 608 R180
WINDOW 0 -33 67 Left 0
WINDOW 3 147 40 Left 0
SYMATTR InstName L4
SYMATTR Value 3m
SYMATTR Type ind
SYMATTR SpiceLine Rser=2.6 Rpar=1.4k Cpar=80p
SYMBOL res 976 288 R0
SYMATTR InstName R13
SYMATTR Value 1k
SYMBOL npn3 928 464 R0
SYMATTR InstName Q2
SYMATTR Value BC547C
SYMBOL res 800 528 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 0 56 VBottom 0
SYMATTR InstName R16
SYMATTR Value 2.2
SYMBOL diode 1504 432 R0
SYMATTR InstName D1
SYMATTR Value BYV27
SYMBOL nmos 1280 368 R0
SYMATTR InstName M1
SYMATTR Value IRF530
SYMBOL Opamps\\opamp2 2240 1520 M0
WINDOW 38 -117 56 Left 0
SYMATTR InstName U1
SYMATTR Value ""
SYMATTR SpiceModel TL084
SYMBOL Opamps\\opamp2 1392 1440 R0
WINDOW 38 16 100 Left 0
SYMATTR InstName U6
SYMATTR Value ""
SYMATTR SpiceModel TL084
SYMBOL Opamps\\opamp2 736 1424 R0
WINDOW 38 16 100 Left 0
SYMATTR InstName U7
SYMATTR Value ""
SYMATTR SpiceModel TL084
SYMBOL Opamps\\opamp2 1040 992 M0
WINDOW 38 16 100 Left 0
SYMATTR InstName U8
SYMATTR Value ""
SYMATTR SpiceModel TL084
TEXT 2192 480 Left 0 !.optons abstol=0.5n reltol=0.005 vntol=0.5m itl5=40000
TEXT 2192 632 Left 0 ;.save V(out)
TEXT 2192 584 Left 0 !.param POT=100k cap=6
TEXT 2190 536 Left 0 !.tran 0 16m 10u uic
TEXT 2184 192 Left 0 !.param alfa1=0.001 alfa2=0.8
TEXT 2400 336 Right 0 !.param  alfa3=0.999
TEXT 552 472 Left 0 !K L3 L4 1
TEXT 1984 808 Left 0 !.MODEL BC547C NPN(IS=4.679E-14 NF=1.01 ISE=2.642E-15 NE=1.581 BF=458.7\n+  IKF=0.1371 VAF=52.64 NR=1.019 ISC=2.337E-14 NC=1.164 BR=11.57 IKR=0.1144\n+  VAR=364.5 RB=1 IRB=1E-06 RBM=1 RE=0.2598 RC=1 XTB=0 EG=1.11 XTI=3\n+  CJE=1.229E-11 VJE=0.5591 MJE=0.3385 TF=4.689E-10 XTF=160 VTF=2.828\n+  ITF=0.8842 PTF=0 CJC=4.42E-12 VJC=0.1994 MJC=0.2782 XCJC=0.6193 TR=1E-32\n+  CJS=0 VJS=0.75 MJS=0.333 FC=0.7936 )
TEXT 1976 1048 Left 0 !.MODEL BYV27 D(IS=34p RS=213m N=1.117 IBV=100p CJO=114.7p VJ=702m M=385m\n+ FC=500m TT=52n XTI=1.79 EG=1.018 BV=200)
TEXT 1976 1152 Left 0 !.MODEL IRF530 VDMOS(Rg=3 Rd=49m Rs=30m Vto=2.9 Kp=10 Cgdmax=1.4n\n+ Cgdmin=0.18n Cgs=0.8n Cjo=0.72n Is=72p Rb=49m\n+ mfg=International_Rectifier Vds=112 Ron=98m Qg=36n)
TEXT 888 1864 Left 0 ;GENERADOR DE\nSEÑAL TRIANGULAR
TEXT 2480 1376 Left 0 ;TENSIÓN DE REFERENCIA
TEXT 1048 1176 Left 0 ;COMPARADOR: PWM
TEXT 512 408 Left 0 ;TRANSFORMADOR\nDE PULSOS
TEXT 2224 760 Left 0 ;MODELOS DE BJT, DIODO Y NMOSFET
TEXT 2256 432 Left 0 ;PARÁMETROS DE LA SIMULACIÓN
TEXT 2232 152 Left 0 ;REGULACIÓN DE LA TRIANGULAR
TEXT 2256 288 Left 0 ;REGULACIÓN TENSIÓN DE REFERENCIA
TEXT 1664 808 Left 0 ;ALIMENTACIÓN\nCIRCUITO DE\nCONTROL
TEXT 3232 200 Left 0 !*             connections:\n*                      non-inverting input\n*                       | inverting input\n*                       |  | positive power supply\n*                       |  |  | negative power supply\n*                       |  |  |  | output\n*                       |  |  |  |  |\n.subckt TL084 1 2 3 4 5\n*\nc1 11 12 2.412E-12\nc2 6 7 18.00E-12\ncss 10 99 5.400E-12\ndc 5 53 dx\nde 54 5 dx\ndlp 90 91 dx\ndln 92 90 dx\ndp 4 3 dx\negnd 99 0 poly(2),(3,0),(4,0) 0 .5 .5\nfb 7 99 poly(5) vb vc ve vlp vln 0 3.467E6 -3E6 3E6 3E6 -3E6\nga 6 0 11 12 339.3E-6\ngcm 0 6 10 99 17.01E-9\niss 10 4 dc 234.0E-6\nhlim 90 0 vlim 1K\nj1 11 2 10 jx\nj2 12 1 10 jx\nr2 6 9 100.0E3\nrd1 3 11 2.947E3\nrd2 3 12 2.947E3\nro1 8 5 50\nro2 7 99 170\nrp 3 4 20.00E3\nrss 10 99 854.7E3\nvb 9 0 dc 0\nvc 3 53 dc 1.500\nve 54 4 dc 1.500\nvlim 7 8 dc 0\nvlp 91 0 dc 50\nvln 0 92 dc 50\n.model dx D(Is=800.0E-18 Rs=1)\n.model jx NJF(Is=2.500E-12 Beta=984.2E-6 Vto=-1)\n.ends\n*$
TEXT 3344 128 Left 0 ;MODELO DEL OPERACIONAL TL084
TEXT 2216 56 Left 0 ;alfa1 regula la frecuencia\nalfa2 regula la amplitud
RECTANGLE Normal 1632 1920 384 1248
RECTANGLE Normal 2976 1936 1792 1296
RECTANGLE Normal 1568 1216 704 928
RECTANGLE Normal 784 624 448 384
RECTANGLE Normal 3152 1280 1952 736
RECTANGLE Normal 2944 688 2144 400
RECTANGLE Normal 2784 232 2160 120
RECTANGLE Normal 2944 384 2144 256
RECTANGLE Normal 1920 1168 1600 768
RECTANGLE Normal 4032 1600 3184 96
