Version 4
SHEET 1 940 708
WIRE -1536 -1568 -1568 -1568
WIRE -1536 -1536 -1536 -1568
WIRE -1632 -1520 -1760 -1520
WIRE -1408 -1520 -1488 -1520
WIRE -1296 -1520 -1328 -1520
WIRE -1184 -1520 -1216 -1520
WIRE -1136 -1520 -1184 -1520
WIRE -1088 -1520 -1136 -1520
WIRE -992 -1520 -1088 -1520
WIRE -1088 -1488 -1088 -1520
WIRE -1760 -1472 -1760 -1520
WIRE -1184 -1424 -1184 -1440
WIRE -1760 -1344 -1760 -1392
WIRE -1552 -1344 -1552 -1472
WIRE -1552 -1344 -1760 -1344
WIRE -1440 -1344 -1552 -1344
WIRE -1184 -1344 -1184 -1360
WIRE -1184 -1344 -1440 -1344
WIRE -1088 -1344 -1088 -1408
WIRE -1088 -1344 -1184 -1344
WIRE -1440 -1312 -1440 -1344
WIRE -1136 -1312 -1136 -1520
WIRE -1312 -1280 -1392 -1280
WIRE -1184 -1280 -1248 -1280
WIRE -1392 -1184 -1392 -1280
WIRE -1376 -1184 -1392 -1184
WIRE -1280 -1184 -1296 -1184
WIRE -1184 -1184 -1184 -1280
WIRE -1184 -1184 -1216 -1184
WIRE -1184 -1120 -1184 -1184
WIRE -1184 -1120 -1248 -1120
WIRE -1136 -1120 -1136 -1232
WIRE -1136 -1120 -1184 -1120
WIRE -1616 -1104 -1616 -1472
WIRE -1392 -1104 -1392 -1184
WIRE -1392 -1104 -1616 -1104
WIRE -1312 -1104 -1392 -1104
WIRE -1216 -1088 -1248 -1088
WIRE -1392 -1056 -1392 -1104
WIRE -1392 -1056 -1408 -1056
WIRE -1136 -1056 -1136 -1120
WIRE -1216 -1008 -1216 -1088
WIRE -1168 -928 -1216 -928
WIRE -1136 -928 -1136 -976
WIRE -1136 -928 -1168 -928
WIRE -1168 -912 -1168 -928
FLAG -1568 -1568 DC
FLAG -1168 -912 0
FLAG -1440 -1312 0
FLAG -992 -1520 Vout
IOPIN -992 -1520 Out
FLAG -1408 -1056 Verr
IOPIN -1408 -1056 Out
SYMBOL voltage -1760 -1488 R0
WINDOW 0 38 33 Left 0
WINDOW 3 37 59 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName VIN
SYMATTR Value 8.24
SYMBOL voltage -1216 -1024 R0
WINDOW 0 -86 32 Left 0
WINDOW 3 -86 59 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName VREF
SYMATTR Value 2.5
SYMBOL ind -1424 -1504 R270
WINDOW 0 39 54 VTop 0
WINDOW 3 -9 49 VBottom 0
SYMATTR InstName L1
SYMATTR Value 35µ
SYMBOL res -1312 -1504 R270
WINDOW 0 33 52 VTop 0
WINDOW 3 -1 47 VBottom 0
SYMATTR InstName R2
SYMATTR Value 20m
SYMBOL res -1200 -1536 R0
WINDOW 0 -31 54 Left 0
WINDOW 3 -42 96 Left 0
SYMATTR InstName R3
SYMATTR Value 70m
SYMBOL cap -1200 -1424 R0
WINDOW 0 -45 18 Left 0
WINDOW 3 -56 53 Left 0
SYMATTR InstName C1
SYMATTR Value 100µ
SYMBOL res -1152 -1328 R0
SYMATTR InstName R5
SYMATTR Value 10K
SYMBOL res -1152 -1072 R0
SYMATTR InstName R6
SYMATTR Value 10K
SYMBOL ampsimp -1280 -1104 M0
WINDOW 3 5 -25 Left 0
WINDOW 39 -19 77 Left 0
SYMATTR Value AMPSIMP
SYMATTR SpiceLine POLE=30 GAIN=30000 VHIGH=4V VLOW=100mV
SYMATTR InstName U1
SYMATTR SpiceModel ""
SYMBOL PWMCM -1584 -1488 R0
SYMATTR InstName X1
SYMATTR Prefix X
SYMATTR Value PWMCM
SYMATTR SpiceLine L= 35U Fs = 200K Ri = 1 Se = 0
SYMBOL cap -1248 -1296 R90
WINDOW 0 0 32 VBottom 0
WINDOW 3 32 32 VTop 0
SYMATTR InstName C2
SYMATTR Value 470p
SYMBOL cap -1216 -1200 R90
WINDOW 0 0 32 VBottom 0
WINDOW 3 32 32 VTop 0
SYMATTR InstName C3
SYMATTR Value 10n
SYMBOL res -1392 -1168 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 0 56 VBottom 0
SYMATTR InstName R1
SYMATTR Value 20k
SYMBOL load2 -1088 -1488 R0
WINDOW 3 36 40 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(1 2 5m 100u 300u 3.5m)
SYMATTR InstName I1
TEXT -520 -1480 Left 0 !.include ampsimp.sub\n.include limit.sub\n.include limit2.sub\n.include varicap.sub
TEXT -520 -1360 Left 0 !;ac dec 20 10 1000000
TEXT -520 -1328 Left 0 !.tran 0 10m 1u
TEXT -1056 -1416 Left 0 !.SUBCKT PWMCM a c p vc dc \n*\n* auto toggling between DCM and CCM, current-mode\n*\nEdc dcx 0 value = { v(d2)*v(cx,p)/(v(a,p)-v(cx,p)+1u) }\nXdc dcx dc limit params: clampH=0.99 clampL=7m\nEd2 d2X 0 value = { (2*{L}*{Fs}*I(VM)/(V(dc)*V(a,cx)+1u)) - V(dc) }\nXd2 d2X dc d2 limit2\nGIap a p value = { (V(dc)/(V(dc)+V(d2)+1u))*I(VM) }\nGIpc p cx value = { V(vc)/{Ri} }\nGImju cx p value = { {Se}*V(dc)/({Ri}*{Fs}) + (v(cx,p)/{L})*V(d2)*{1/Fs}*(1-(V(dc)+V(d2))/2) }\nRdum1 dc 0 1Meg\nRdum2 vc 0 1Meg\nVM cx c \n*XC1 cx p mode varicap\n*Emode mode 0 Value = { IF (  (2*{L}*{Fs}*I(VM)/(V(dc)*V(a,cx)+1u))\n*+ < 1, 1p , {4/((L)*(6.28*Fs)**2)}	) } ; connect or disconnects the resonating capacitor\n*\n.ENDS
TEXT -1176 -1568 Left 0 ;Switched Load I1
