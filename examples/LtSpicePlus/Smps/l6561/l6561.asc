Version 4
SHEET 1 2440 1480
WIRE -272 272 -272 240
WIRE -272 640 -272 272
WIRE -208 -128 -208 -160
WIRE -208 -32 -208 -48
WIRE -208 -16 -208 -32
WIRE -192 160 -272 160
WIRE -192 160 -192 128
WIRE -192 272 -272 272
WIRE -192 272 -192 240
WIRE -192 512 -192 480
WIRE -192 640 -272 640
WIRE -192 640 -192 592
WIRE -160 480 -192 480
WIRE -128 -160 -208 -160
WIRE -128 -144 -128 -160
WIRE -128 -32 -208 -32
WIRE -128 -32 -128 -64
WIRE -112 1072 -112 1056
WIRE -112 1120 -112 1072
WIRE -112 1168 -112 1120
WIRE -112 1184 -112 1168
WIRE -112 1312 -112 1264
WIRE -96 176 -96 48
WIRE -96 192 -96 176
WIRE -96 272 -192 272
WIRE -96 736 -112 736
WIRE -96 784 -96 736
WIRE -96 800 -96 784
WIRE -96 928 -96 880
WIRE -96 1120 -112 1120
WIRE -80 -160 -128 -160
WIRE -80 128 -80 -160
WIRE -80 176 -96 176
WIRE -80 736 -96 736
WIRE -64 480 -80 480
WIRE -64 480 -64 416
WIRE -64 512 -64 480
WIRE -64 640 -192 640
WIRE -64 640 -64 576
WIRE -48 1168 -112 1168
WIRE -48 1312 -112 1312
WIRE -48 1312 -48 1216
WIRE -32 112 -32 96
WIRE -32 272 -96 272
WIRE -32 272 -32 192
WIRE -32 304 -32 272
WIRE -32 480 -64 480
WIRE -32 560 -80 560
WIRE -32 560 -32 528
WIRE -32 784 -96 784
WIRE -32 928 -96 928
WIRE -32 928 -32 832
WIRE 0 1120 -16 1120
WIRE 0 1152 0 1120
WIRE 0 1312 -48 1312
WIRE 0 1312 0 1232
WIRE 16 96 -32 96
WIRE 16 464 16 416
WIRE 16 640 -64 640
WIRE 16 640 16 544
WIRE 16 736 0 736
WIRE 16 768 16 736
WIRE 16 928 -32 928
WIRE 16 928 16 848
WIRE 32 224 32 176
WIRE 32 736 16 736
WIRE 48 416 16 416
WIRE 48 416 48 352
WIRE 64 1312 0 1312
WIRE 64 1344 64 1312
WIRE 80 864 80 832
WIRE 80 928 16 928
WIRE 80 960 80 928
WIRE 128 64 128 48
WIRE 128 96 96 96
WIRE 128 96 128 64
WIRE 128 128 128 96
WIRE 128 176 112 176
WIRE 128 192 128 176
WIRE 128 272 -32 272
WIRE 144 512 144 448
WIRE 144 640 16 640
WIRE 144 640 144 592
WIRE 144 736 112 736
WIRE 144 736 144 720
WIRE 144 784 144 736
WIRE 160 1072 -112 1072
WIRE 160 1168 160 1072
WIRE 160 1312 64 1312
WIRE 160 1312 160 1248
WIRE 176 112 176 96
WIRE 176 272 128 272
WIRE 176 272 176 192
WIRE 176 832 160 832
WIRE 176 848 176 832
WIRE 176 928 80 928
WIRE 192 784 144 784
WIRE 192 832 176 832
WIRE 208 1312 160 1312
WIRE 208 1312 208 1232
WIRE 224 528 224 448
WIRE 224 640 144 640
WIRE 224 640 224 592
WIRE 240 720 224 720
WIRE 240 768 240 720
WIRE 240 928 176 928
WIRE 240 928 240 848
WIRE 240 1184 208 1184
WIRE 240 1184 240 1072
WIRE 240 1216 240 1184
WIRE 240 1312 208 1312
WIRE 240 1312 240 1280
WIRE 256 96 176 96
WIRE 256 336 256 96
WIRE 272 448 224 448
WIRE 272 496 272 448
WIRE 272 640 224 640
WIRE 272 640 272 576
WIRE 272 1072 240 1072
WIRE 288 96 256 96
WIRE 288 128 288 96
WIRE 288 272 176 272
WIRE 288 272 288 208
WIRE 288 1312 240 1312
WIRE 288 1312 288 1200
WIRE 304 1168 160 1168
WIRE 304 1200 288 1200
WIRE 336 720 320 720
WIRE 336 768 336 720
WIRE 336 928 240 928
WIRE 336 928 336 832
WIRE 352 64 128 64
WIRE 352 80 352 64
WIRE 352 272 288 272
WIRE 352 272 352 144
WIRE 416 64 352 64
WIRE 416 160 416 64
WIRE 416 208 384 208
WIRE 416 768 416 720
WIRE 416 928 336 928
WIRE 416 928 416 848
WIRE 416 1072 352 1072
WIRE 416 1184 368 1184
WIRE 416 1184 416 1072
WIRE 464 144 464 112
WIRE 464 272 352 272
WIRE 464 272 464 224
WIRE 464 336 256 336
WIRE 464 352 48 352
WIRE 496 720 480 720
WIRE 496 768 496 720
WIRE 496 928 416 928
WIRE 496 928 496 848
WIRE 512 112 464 112
WIRE 512 1072 416 1072
WIRE 512 1072 512 1040
WIRE 544 112 512 112
WIRE 544 144 544 112
WIRE 544 272 464 272
WIRE 544 272 544 224
WIRE 608 352 528 352
WIRE 608 768 608 720
WIRE 608 928 496 928
WIRE 608 928 608 848
WIRE 624 160 624 16
WIRE 624 192 624 160
WIRE 624 272 544 272
WIRE 656 720 608 720
WIRE 672 160 624 160
WIRE 672 272 624 272
WIRE 672 272 672 208
WIRE 704 720 656 720
WIRE 704 768 704 720
WIRE 704 928 608 928
WIRE 704 928 704 848
WIRE 720 144 720 112
WIRE 720 272 672 272
WIRE 720 272 720 224
WIRE 720 1152 720 1136
WIRE 720 1312 288 1312
WIRE 720 1312 720 1232
WIRE 768 112 720 112
WIRE 816 112 768 112
WIRE 816 144 816 112
WIRE 816 272 720 272
WIRE 816 272 816 224
WIRE 832 1136 720 1136
WIRE 832 1136 832 1040
WIRE 832 1152 832 1136
WIRE 832 1312 720 1312
WIRE 832 1312 832 1232
WIRE 864 768 864 720
WIRE 864 928 704 928
WIRE 864 928 864 848
WIRE 928 720 864 720
WIRE 960 144 960 112
WIRE 960 272 816 272
WIRE 960 272 960 224
WIRE 976 720 928 720
WIRE 976 768 976 720
WIRE 976 928 864 928
WIRE 976 928 976 848
WIRE 1104 112 960 112
WIRE 1104 144 1104 112
WIRE 1104 272 960 272
WIRE 1104 272 1104 224
WIRE 1184 112 1104 112
WIRE 1184 144 1184 112
WIRE 1184 272 1104 272
WIRE 1184 272 1184 192
WIRE 1232 144 1184 144
WIRE 1232 192 1184 192
WIRE 1280 128 1280 112
WIRE 1280 272 1184 272
WIRE 1280 272 1280 208
WIRE 1296 768 1296 720
WIRE 1296 928 1296 848
WIRE 1296 976 1296 928
WIRE 1296 1120 1296 1072
WIRE 1296 1216 1296 1200
WIRE 1296 1248 1296 1216
WIRE 1344 112 1280 112
WIRE 1376 464 1312 464
WIRE 1376 480 1312 480
WIRE 1392 720 1296 720
WIRE 1408 112 1344 112
WIRE 1408 128 1408 112
WIRE 1408 272 1280 272
WIRE 1408 272 1408 208
WIRE 1456 1072 1296 1072
WIRE 1472 480 1440 480
WIRE 1472 512 1472 480
WIRE 1520 720 1472 720
WIRE 1520 816 1520 720
WIRE 1520 928 1296 928
WIRE 1520 928 1520 880
WIRE 1552 512 1472 512
WIRE 1552 560 1472 560
WIRE 1568 112 1408 112
WIRE 1568 144 1568 112
WIRE 1600 1216 1296 1216
WIRE 1648 192 1648 112
WIRE 1648 272 1408 272
WIRE 1664 720 1520 720
WIRE 1664 768 1664 720
WIRE 1664 928 1520 928
WIRE 1664 928 1664 848
WIRE 1680 1072 1536 1072
WIRE 1712 0 1712 -48
WIRE 1712 112 1648 112
WIRE 1712 112 1712 80
WIRE 1712 208 1712 112
WIRE 1712 272 1648 272
WIRE 1712 928 1664 928
WIRE 1712 928 1712 832
WIRE 1744 512 1648 512
WIRE 1760 784 1712 784
WIRE 1776 112 1712 112
WIRE 1776 144 1568 144
WIRE 1824 512 1744 512
WIRE 1824 768 1824 512
WIRE 1872 784 1824 784
WIRE 1904 272 1712 272
WIRE 1904 272 1904 160
WIRE 1904 784 1872 784
WIRE 1920 128 1840 128
WIRE 1920 160 1904 160
WIRE 1984 720 1664 720
WIRE 1984 768 1968 768
WIRE 1984 768 1984 720
WIRE 2032 144 1984 144
WIRE 2032 800 1968 800
WIRE 2032 928 1712 928
WIRE 2032 928 2032 800
WIRE 2080 144 2032 144
FLAG -32 304 0
FLAG -96 48 inv
FLAG 128 48 comp
FLAG -192 128 ref25
FLAG -80 560 ref25
FLAG 48 416 dyn_ovp
FLAG 272 448 soft_ovp
FLAG -192 480 iea
FLAG 32 224 ref25
FLAG 288 96 stat_ovp
FLAG 384 208 ref25
FLAG 512 112 comp_offset
FLAG 624 16 mult
FLAG 768 112 mult_clamp
FLAG 1344 112 mult_out
FLAG 80 864 ref25
FLAG 80 960 0
FLAG 496 720 zcd_int
FLAG -112 736 zcd
FLAG 336 720 zcd_delay
FLAG 928 720 disable
FLAG 656 720 set_zcd
FLAG 1712 -48 cs
FLAG 1520 720 ramp
FLAG 1872 784 start
FLAG 2032 144 reset
FLAG 1296 976 0
FLAG 64 1344 0
FLAG -112 1056 vcc
FLAG 512 1040 uvl
FLAG 832 1040 vcc_int
FLAG 1296 1248 0
FLAG 1680 1072 gd
FLAG -208 -16 0
FLAG 1744 512 ff_out
FLAG 1312 464 set_zcd
FLAG 1312 480 start
FLAG 1472 560 reset
FLAG 608 352 ovp
SYMBOL e -32 96 R0
SYMATTR InstName E1
SYMATTR Value table
SYMATTR Value2 (0,2)(1m,5.8)
SYMBOL voltage -272 144 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 24 44 Left 0
SYMATTR Value 2.5
SYMATTR InstName V1
SYMBOL res -208 144 R0
SYMATTR InstName R1
SYMATTR Value 10k
SYMBOL res 112 80 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R2
SYMATTR Value 10
SYMBOL res -112 176 R0
SYMATTR InstName R3
SYMATTR Value 2meg
SYMBOL e 16 448 R0
SYMATTR InstName E2
SYMATTR Value table
SYMATTR Value2 (0,0)(1m,5)
SYMBOL res -64 464 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R4
SYMATTR Value 11k
SYMBOL res 32 400 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R5
SYMATTR Value 18k
SYMBOL h -192 496 R0
SYMATTR InstName H1
SYMATTR Value E1 100000
SYMBOL evalue 144 496 R0
WINDOW 3 -61 172 Left 0
SYMATTR Value value={if(v(iea)>3.7,1,0)}
SYMATTR InstName E3
SYMBOL res 256 480 R0
SYMATTR InstName R6
SYMATTR Value 1meg
SYMBOL e2 176 96 R0
SYMATTR InstName E4
SYMATTR Value table
SYMATTR Value2 (0,0)(1m,5)
SYMBOL res 112 176 R0
SYMATTR InstName R7
SYMATTR Value 10k
SYMBOL res 128 160 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R8
SYMATTR Value 1k
SYMBOL res 272 112 R0
SYMATTR InstName R9
SYMATTR Value 10k
SYMBOL e 464 128 R0
SYMATTR InstName E5
SYMATTR Value table
SYMATTR Value2 (0,0)(0.2,0.05)(0.5,0.2)(0.7,0.33)(1,0.5)(1.5,0.9)(2,1.3)(2.5,1.6)(3.3,1.8)
SYMBOL res 528 128 R0
SYMATTR InstName R12
SYMATTR Value 10k
SYMBOL e 720 128 R0
SYMATTR InstName E6
SYMATTR Value table
SYMATTR Value2 (0,0)(3,3)
SYMBOL res 608 176 R0
SYMATTR InstName R13
SYMATTR Value 2meg
SYMBOL res 800 128 R0
SYMATTR InstName R14
SYMATTR Value 10k
SYMBOL evalue 960 128 R0
SYMATTR InstName E7
SYMATTR Value value={if(v(soft_ovp),0.1,v(mult_clamp)*v(comp_offset))}
SYMBOL res 1088 128 R0
SYMATTR InstName R15
SYMATTR Value 10k
SYMBOL e 1280 112 R0
SYMATTR InstName E8
SYMATTR Value table
SYMATTR Value2 (0,0)(1.6,1.6)(2,1.7)
SYMBOL res 1392 112 R0
SYMATTR InstName R16
SYMATTR Value 10k
SYMBOL e 16 752 R0
SYMATTR InstName E10
SYMATTR Value table
SYMATTR Value2 (0,0.3)(0.6,0.6)(5.1,5.1)
SYMBOL res 16 720 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R18
SYMATTR Value 22
SYMBOL res -112 784 R0
SYMATTR InstName R19
SYMATTR Value 2meg
SYMBOL e 240 752 R0
SYMATTR InstName E11
SYMATTR Value table
SYMATTR Value2 (0,0)(0.01m,3)
SYMBOL res 128 720 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R20
SYMATTR Value 10k
SYMBOL res 240 704 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R21
SYMATTR Value 47k
SYMBOL res 176 816 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R22
SYMATTR Value 3.9k
SYMBOL res 160 832 R0
SYMATTR InstName R23
SYMATTR Value 10k
SYMBOL cap 480 704 R90
WINDOW 0 0 32 VBottom 0
WINDOW 3 32 32 VTop 0
SYMATTR InstName C1
SYMATTR Value 100p
SYMBOL res 480 752 R0
SYMATTR InstName R24
SYMATTR Value 1k
SYMBOL evalue 608 752 R0
WINDOW 3 -70 134 Left 0
SYMATTR Value value={if(v(zcd_int)<-0.1,1,0)}
SYMATTR InstName E12
SYMBOL res 224 736 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 -7 56 VBottom 0
SYMATTR InstName R25
SYMATTR Value 1k
SYMBOL evalue 416 752 R0
WINDOW 3 -117 198 Left 0
SYMATTR Value value={if(v(zcd_delay)>1.5,1,0)}
SYMATTR InstName E13
SYMBOL cap 320 768 R0
SYMATTR InstName C2
SYMATTR Value 470p
SYMBOL res 688 752 R0
SYMATTR InstName R27
SYMATTR Value 10k
SYMBOL evalue 864 752 R0
SYMATTR InstName E14
SYMATTR Value value={if(v(zcd)<0.15,1,0)}
SYMBOL res 960 752 R0
SYMATTR InstName R28
SYMATTR Value 10k
SYMBOL cap 1696 208 R0
SYMATTR InstName C3
SYMATTR Value 5p
SYMBOL res 1696 -16 R0
SYMATTR InstName R31
SYMATTR Value 40k
SYMBOL res 1632 176 R0
SYMATTR InstName R32
SYMATTR Value 2meg
SYMBOL evalue 1296 752 R0
SYMATTR InstName E19
SYMATTR Value value={if(v(disable)|v(ovp),0,v(vcc_int))}
SYMBOL res 1488 704 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R34
SYMATTR Value 22k
SYMBOL cap 1504 816 R0
SYMATTR InstName C5
SYMATTR Value 10n
SYMBOL sw 1664 864 R180
SYMATTR InstName S1
SYMATTR Value myswitch
SYMBOL e 0 1136 R0
WINDOW 3 20 121 Left 0
SYMATTR Value table
SYMATTR InstName E22
SYMATTR Value2 (0,0)(20,20)
SYMBOL res 0 1104 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R37
SYMATTR Value 220
SYMBOL res -128 1168 R0
SYMATTR InstName R38
SYMATTR Value 240k
SYMBOL g2 160 1264 R180
SYMATTR InstName G1
SYMATTR Value 0.005
SYMBOL cap 224 1216 R0
SYMATTR InstName C6
SYMATTR Value 1n
SYMBOL res 368 1056 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R39
SYMATTR Value 1k
SYMBOL evalue 720 1136 R0
SYMATTR InstName E24
SYMATTR Value value={(v(vcc)-0.6)*v(uvl)}
SYMBOL res 816 1136 R0
SYMATTR InstName R42
SYMATTR Value 10k
SYMBOL evalue 1296 1104 R0
SYMATTR InstName E25
SYMATTR Value value={if( v(ovp)|v(disable),0,v(ff_out)*v(vcc_int) )}
SYMBOL res 1552 1056 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R43
SYMATTR Value 25
SYMBOL cap 336 80 R0
SYMATTR InstName C8
SYMATTR Value 10p
SYMBOL cap -80 512 R0
SYMATTR InstName C9
SYMATTR Value 10p
SYMBOL res 240 432 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R10
SYMATTR Value 10k
SYMBOL cap 208 528 R0
SYMATTR InstName C10
SYMATTR Value 1n
SYMBOL evalue -208 -144 R0
SYMATTR InstName E26
SYMATTR Value Value={if (v(uvl)>0.5 , 2.5 , 0) }
SYMBOL res -144 -160 R0
SYMATTR InstName R11
SYMATTR Value 10k
SYMBOL Digital\\diffschmtbuf 1776 64 R0
WINDOW 3 10 -14 Left 0
SYMATTR InstName A1
SYMATTR Value trise 500n vt = 5m vh = 1m
SYMBOL Digital\\diffschmtbuf 1920 80 R0
WINDOW 3 -121 123 Left 0
SYMATTR InstName A2
SYMATTR Value trise = 50n vt = 0.5 vh = 1m
SYMBOL Digital\\srflop 1600 464 R0
WINDOW 3 -40 28 Left 0
SYMATTR InstName A3
SYMATTR Value trise = 100n
SYMBOL Digital\\or 1408 432 R0
WINDOW 3 -8 36 Left 0
SYMATTR InstName A4
SYMATTR Value trise = 100n
SYMBOL Digital\\diffschmtbuf 1968 720 M0
WINDOW 3 -196 115 Left 0
SYMATTR InstName A5
SYMATTR Value trise = 100n vt = 4.9 vh = 0.1
SYMBOL Digital\\or 1792 736 M0
WINDOW 3 -72 115 Left 0
SYMATTR InstName A6
SYMATTR Value trise = 100n
SYMBOL Digital\\diffschmtbuf 304 1120 R0
WINDOW 3 10 113 Left 0
SYMATTR InstName A7
SYMATTR Value trise = 500n vt = 10.75 vh = 1.25
SYMBOL Digital\\or 496 304 R0
SYMATTR InstName A8
TEXT 1288 952 Left 0 !.model myswitch sw(ron=1 roff=1meg vt=0.5 vh=-0.1)
TEXT 1536 616 Left 0 !.ic v(ff_out) = 0
