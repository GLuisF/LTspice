Version 4
SHEET 1 1392 680
WIRE -592 112 -592 -160
WIRE -592 192 -592 112
WIRE -592 336 -592 256
WIRE -512 112 -592 112
WIRE -512 176 -512 112
WIRE -512 336 -592 336
WIRE -512 336 -512 240
WIRE -480 336 -512 336
WIRE -480 336 -480 -80
WIRE -464 208 -464 -16
WIRE -448 160 -448 48
WIRE -432 -80 -480 -80
WIRE -432 -16 -464 -16
WIRE -432 48 -448 48
WIRE -432 112 -512 112
WIRE -368 160 -448 160
WIRE -224 -160 -592 -160
WIRE -192 -16 -208 -16
WIRE -192 -16 -192 -32
WIRE -192 48 -208 48
WIRE -192 96 -192 48
WIRE -176 -160 -224 -160
WIRE -176 -80 -208 -80
WIRE -176 -80 -176 -160
WIRE -176 112 -208 112
WIRE -176 240 -176 112
WIRE -176 256 -176 240
WIRE -176 336 -480 336
WIRE -176 336 -176 320
WIRE -160 240 -176 240
WIRE -128 -160 -176 -160
WIRE -128 -144 -128 -160
WIRE -128 -32 -192 -32
WIRE -128 -32 -128 -64
WIRE -128 0 -128 -32
WIRE -128 96 -192 96
WIRE -128 96 -128 80
WIRE -48 -32 -128 -32
WIRE -48 16 -48 -32
WIRE -48 96 -128 96
WIRE -48 96 -48 80
WIRE -48 208 -464 208
WIRE -48 208 -48 96
WIRE -48 256 -48 208
WIRE -48 336 -176 336
WIRE -48 336 -48 320
WIRE 16 -32 -48 -32
WIRE 64 160 -368 160
WIRE 80 -160 -128 -160
WIRE 144 -32 96 -32
WIRE 256 -160 160 -160
WIRE 256 -112 256 -160
WIRE 256 -32 208 -32
WIRE 256 -32 256 -112
WIRE 256 208 256 -32
WIRE 256 256 256 208
WIRE 256 336 -48 336
WIRE 256 336 256 320
WIRE 320 -112 256 -112
WIRE 320 -32 256 -32
WIRE 352 208 256 208
WIRE 352 240 352 208
WIRE 352 336 256 336
WIRE 352 336 352 320
WIRE 448 -112 400 -112
WIRE 448 -32 384 -32
WIRE 448 -32 448 -112
WIRE 448 -16 448 -32
WIRE 448 64 448 48
WIRE 448 192 448 144
WIRE 448 224 448 192
WIRE 448 336 352 336
WIRE 448 336 448 304
WIRE 528 160 144 160
WIRE 528 208 528 160
WIRE 528 336 448 336
WIRE 528 336 528 272
WIRE 560 -160 256 -160
WIRE 576 160 528 160
WIRE 576 208 576 160
WIRE 576 336 528 336
WIRE 576 336 576 288
WIRE 608 160 576 160
WIRE 672 64 672 16
WIRE 672 96 672 64
WIRE 672 112 672 96
WIRE 672 336 576 336
WIRE 672 336 672 208
WIRE 688 -112 448 -112
WIRE 688 -64 688 -112
WIRE 688 16 672 16
WIRE 704 64 672 64
WIRE 752 -64 752 -112
WIRE 752 96 672 96
WIRE 752 128 752 96
WIRE 752 224 752 128
WIRE 752 336 672 336
WIRE 752 336 752 288
WIRE 784 -112 752 -112
WIRE 784 64 768 64
WIRE 784 64 784 -112
WIRE 816 -112 784 -112
WIRE 816 -64 816 -112
WIRE 816 16 752 16
WIRE 816 16 816 0
WIRE 816 224 816 16
WIRE 816 336 752 336
WIRE 816 336 816 224
WIRE 848 -112 816 -112
WIRE 864 224 816 224
WIRE 960 -112 912 -112
WIRE 976 -112 960 -112
WIRE 976 32 976 -112
WIRE 976 160 976 112
WIRE 976 224 944 224
WIRE 976 224 976 160
WIRE 1008 -112 976 -112
WIRE 1008 -80 1008 -112
WIRE 1008 16 816 16
WIRE 1008 16 1008 -16
WIRE 1008 160 976 160
WIRE 1056 -112 1008 -112
WIRE 1072 16 1008 16
WIRE 1072 112 1072 16
WIRE 1072 288 1024 288
WIRE 1072 288 1072 208
WIRE 1184 -112 1136 -112
WIRE 1184 -80 1184 -112
WIRE 1184 16 1072 16
WIRE 1184 16 1184 -16
WIRE 1184 48 1184 16
WIRE 1232 -112 1184 -112
WIRE 1280 -160 624 -160
WIRE 1280 -112 1232 -112
WIRE 1280 -112 1280 -160
WIRE 1280 -96 1280 -112
WIRE 1280 16 1184 16
WIRE 1280 16 1280 -16
FLAG 1232 -112 Out
FLAG 752 128 High
FLAG 960 -112 OutRect
FLAG -224 -160 Alim555
FLAG 1184 48 0
FLAG -368 160 Out555
FLAG 976 160 beQctrl
FLAG 1024 288 Pwm1
IOPIN 1024 288 Out
FLAG -160 240 Pwm1
IOPIN -160 240 In
FLAG -48 -32 Pwm2
FLAG 256 -160 Sense
FLAG 448 192 Pin
SYMBOL Robertugo\\555_ALL -272 32 R0
WINDOW 38 -79 78 Left 0
SYMATTR InstName U1
SYMBOL cap -64 256 R0
WINDOW 0 -33 29 Left 0
WINDOW 3 -37 54 Left 0
SYMATTR InstName Ct
SYMATTR Value 820p
SYMBOL res -112 96 R180
WINDOW 0 28 84 Left 0
WINDOW 3 30 48 Left 0
SYMATTR InstName Rtoff
SYMATTR Value 47k
SYMBOL diode -32 16 M0
WINDOW 3 22 60 Left 0
SYMATTR Value 1N914
SYMATTR InstName Dton
SYMBOL res 112 -48 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName RsZ2
SYMATTR Value 150
SYMBOL diode 544 272 R180
WINDOW 0 44 -56 VRight 0
WINDOW 3 42 37 VRight 0
SYMATTR InstName DretInv
SYMATTR Value 1N914
SYMBOL diode 624 -176 R90
WINDOW 0 16 113 VBottom 0
WINDOW 3 -12 -38 VTop 0
SYMATTR InstName Dalim
SYMATTR Value MURS120
SYMBOL diode 432 48 M180
WINDOW 0 -45 64 VLeft 0
WINDOW 3 -16 78 VLeft 0
SYMATTR InstName Dpol
SYMATTR Value MBRS1100
SYMBOL voltage 448 208 M0
WINDOW 0 34 22 VTop 0
WINDOW 3 -2 73 Bottom 0
WINDOW 123 41 81 Top 0
SYMATTR InstName VLocom
SYMATTR Value 80v
SYMATTR Value2 AC 1
SYMATTR SpiceLine Rser=1m
SYMBOL res 416 -128 R90
WINDOW 0 -10 126 VTop 0
WINDOW 3 -12 -9 VTop 0
SYMATTR InstName RDis
SYMATTR Value 22k
SYMATTR SpiceLine tol=10 pwr=5
SYMBOL res 160 144 R90
WINDOW 0 1 96 VRight 0
WINDOW 3 4 -19 VRight 0
SYMATTR InstName Rbuf1
SYMATTR Value 47
SYMATTR SpiceLine tol=1 pwr=0.1
SYMBOL res 560 192 R0
WINDOW 0 96 50 Right 0
WINDOW 3 56 87 Right 0
SYMATTR InstName Rbmin
SYMATTR Value 22
SYMATTR SpiceLine tol=1 pwr=0.1
SYMBOL polcap 1024 -80 M0
WINDOW 3 -9 48 Right 0
WINDOW 0 -23 24 Right 0
SYMATTR Value 220µ
SYMATTR InstName Cf1
SYMATTR Description Capacitor
SYMATTR Type cap
SYMATTR SpiceLine V=16 Irms=2.4 Rser=0.05 MTBF=0 Lser=2.1p ppPkg=1
SYMBOL polcap 1200 -80 M0
WINDOW 3 90 46 Right 0
WINDOW 0 86 25 Right 0
SYMATTR Value 220µ
SYMATTR InstName Cf2
SYMATTR Description Capacitor
SYMATTR Type cap
SYMATTR SpiceLine V=16 Irms=2.4 Rser=0.05 MTBF=0 Lser=2.1p ppPkg=1
SYMBOL ind 1152 -96 M270
WINDOW 0 62 10 VBottom 0
WINDOW 3 62 65 VBottom 0
SYMATTR InstName Lf
SYMATTR Value 100µ
SYMATTR SpiceLine Ipk=10 Rser=0.001 Rpar=0 Cpar=0
SYMBOL polcap 384 -48 R90
WINDOW 0 35 62 VTop 0
WINDOW 3 -31 74 VTop 0
SYMATTR InstName Cstart
SYMATTR Value 47µ
SYMATTR Description Capacitor
SYMATTR Type cap
SYMATTR SpiceLine V=100 Irms=210m Rser=0.37 MTBF=2000 Lser=0 mfg="Nichicon" pn="UPR2A470MPH" type="Al electrolytic" ppPkg=1
SYMBOL cap 736 224 R0
WINDOW 0 13 3 Right 0
WINDOW 3 -9 32 Right 0
SYMATTR InstName Csnub
SYMATTR Value 33n
SYMBOL ind2 672 -80 R0
WINDOW 0 -3 64 VRight 0
WINDOW 3 -7 -6 VRight 0
SYMATTR InstName LP
SYMATTR Value 1m1
SYMATTR Type ind
SYMATTR SpiceLine Rser=1 Rpar=1430 Cpar=5p
SYMBOL ind2 768 32 R180
WINDOW 0 -4 32 VRight 0
WINDOW 3 -4 91 VRight 0
SYMATTR InstName LS
SYMATTR Value 50µ
SYMATTR Type ind
SYMATTR SpiceLine Rser=0.01 Rpar=110
SYMBOL diode 848 -96 R270
WINDOW 0 32 32 VTop 0
WINDOW 3 0 32 VBottom 0
SYMATTR InstName Drect
SYMATTR Value MBR735
SYMBOL npn3 608 112 R0
WINDOW 3 31 59 Left 0
WINDOW 0 34 34 Left 0
SYMATTR Value BU508
SYMATTR InstName Qout
SYMBOL cap 800 -64 R0
WINDOW 0 97 30 Right 0
WINDOW 3 89 58 Right 0
SYMATTR InstName Csint
SYMATTR Value 100n
SYMBOL res 432 48 R0
WINDOW 0 -47 65 Left 0
WINDOW 3 -47 90 Left 0
SYMATTR InstName Rlim
SYMATTR Value 2R2
SYMATTR SpiceLine tol=1 pwr=0.1
SYMBOL cap 768 48 R90
WINDOW 0 15 61 VBottom 0
WINDOW 3 -10 5 VTop 0
SYMATTR InstName Cps
SYMATTR Value 10p
SYMBOL res 1264 -112 R0
WINDOW 0 -29 27 Left 0
WINDOW 3 -65 107 Left 0
SYMATTR InstName RL
SYMATTR Value {Rload}
SYMBOL polcap 240 256 R0
WINDOW 3 5 56 Right 0
WINDOW 0 -8 34 Right 0
SYMATTR Value 220µ
SYMATTR InstName Cf3
SYMATTR Description Capacitor
SYMATTR Type cap
SYMATTR SpiceLine V=16 Irms=2.4 Rser=0.05 MTBF=0 Lser=2.1p ppPkg=1
SYMBOL res 336 224 R0
WINDOW 0 7 28 Right 0
WINDOW 3 -3 65 Right 0
SYMATTR InstName R_uFan
SYMATTR Value 150
SYMATTR SpiceLine tol=1 pwr=0.1
SYMBOL zener -496 240 R180
WINDOW 0 49 -17 VRight 0
WINDOW 3 -236 -10 Invisible 0
SYMATTR InstName Dz+10v555
SYMATTR Value BZX84C10L
SYMBOL res 176 -176 R90
WINDOW 0 14 139 VBottom 0
WINDOW 3 -12 4 VTop 0
SYMATTR InstName RsZ1
SYMATTR Value 56
SYMBOL zener 144 -16 R270
WINDOW 0 36 32 VTop 0
WINDOW 3 -4 32 VBottom 0
SYMATTR InstName DzPwm2
SYMATTR Value BZX84C6V2L
SYMBOL polcap -608 192 R0
WINDOW 3 59 126 Right 0
WINDOW 0 62 100 Right 0
SYMATTR Value .1µ
SYMATTR InstName Cf4
SYMATTR Description Capacitor
SYMATTR Type cap
SYMATTR SpiceLine V=16 Irms=2.4 Rser=0.05 MTBF=0 Lser=2.1p ppPkg=1
SYMBOL cap -192 256 R0
WINDOW 0 -41 28 Left 0
WINDOW 3 -43 52 Left 0
SYMATTR InstName Cf5
SYMATTR Value 10n
SYMBOL res -144 -160 R0
WINDOW 0 36 46 Left 0
SYMATTR InstName Rton
SYMATTR Value 22K
SYMBOL npn 1008 208 M180
WINDOW 0 -8 107 Left 0
WINDOW 3 28 47 Left 0
SYMATTR InstName QCtrl
SYMATTR Value BC547A
SYMBOL res 960 208 R90
WINDOW 0 -15 33 VRight 0
WINDOW 3 55 39 VRight 0
SYMATTR InstName Rd1
SYMATTR Value 1K
SYMATTR SpiceLine tol=1 pwr=0.1
SYMBOL res 992 128 R180
WINDOW 0 79 72 Right 0
WINDOW 3 79 46 Right 0
SYMATTR InstName Rd2
SYMATTR Value 20K
SYMATTR SpiceLine tol=1 pwr=0.1
TEXT -570 -176 Left 0 !.tran 0 8m 0 startup
TEXT 720 -120 VRight 0 !K1 LP LS .85
TEXT 336 -64 Left 0 ;x100V
TEXT 680 280 Left 0 ;x250V
TEXT 1200 32 Left 0 ;2R7min
TEXT 456 -96 Left 0 ;Cheap & dirty(some\nfreq var) for 80V\n(Locomotive) to\n12V x 3A PWM\n  Flyback. If short-\n  circuit autostop!\n  Ef(35W)>70%\n  &Full NE555\n  bipolar use.
TEXT 744 -176 Left 0 ;.step param val 80n 120n 20n
TEXT 1088 -176 Left 0 ;.option noopiter
TEXT 960 112 Right 0 ;(20K)
TEXT 848 328 Left 0 !.step param Rload list 4 6 12 10k
TEXT -576 -296 Left 0 !.meas tran Pin avg(V(Pin)*I(VLocom)) from td=6m\n.meas tran Pout avg(V(Out)*I(RL)) from td=6m\n.meas tran Eff% Param (Pout/Pin)*-100\n.meas tran PdQ avg(V(High)*Ic(Qout)+V(N003)*Ib(Qout)) from td=6m
TEXT 152 -328 Left 0 !.meas tran ta FIND time WHEN V(out555)=5 td=6m rise=1\n.meas tran tb FIND time WHEN V(out555)=5 td=6m rise=11\n.meas tran Frec PARAM 10/(tb-ta)\n.Meas tran Tc FIND time WHEN V(Out555)=5 td=6m fall=1\n.Meas tran Td FIND time WHEN V(Out555)=5 td=6m fall=2
TEXT 760 -312 Left 0 !.Meas tran T1 Param  (Tc-Ta)\n.Meas tran T2  Param  (Td-Ta)\n.Meas tran Ton Param If (T1>0, T1, T2)\n.Meas tran Duty% Param  Ton*Frec*100
