**************************************************************************************************************************************************************************************************
*
*  888888              888888               888888  .o888888888888o.    8888         88888888888  o888888888888888   88888888888888o   88888888888  88888888888  8888888888o
*   88888             88888888             88888   .8888888  8888888.   8888         88888888888  o8888888888888888  888888  8888888o  88888888888  88888888888  88888888888o
*    88888           8888  8888           88888   .8888888.  .8888888.  8888         8888         888888888          888888  88888888  8888         8888         8888   88888
*     88888         8888    8888         88888    88888888    88888888  8888         8888         888888888          888888  88888888  8888         8888         8888   88888
*      88888       8888      8888       88888     88888888    88888888  8888         8888888      o888888888888888o  888888  8888888o  8888888      8888888      8888   88888
*       88888     8888        8888     88888      88888888    88888888  8888         8888888      o888888888888888o  88888888888888o   8888888      8888888      8888   88888
*        88888   8888          8888   88888       88888888    88888888  8888         8888                  88888888  8888              8888         8888         8888   88888
*         88888 8888            8888 88888        .8888888.  .8888888.  8888         8888                  88888888  8888              8888         8888         8888   88888
*          88888888             88888888           .8888888  8888888.   88888888888  8888         8888888888888888o  8888              88888888888  88888888888  88888888888o
*           888888               888888             .o888888888888o.    88888888888  8888         888888888888888o   8888              88888888888  88888888888  8888888888o
*
**************************************************************************************************************************************************************************************************
*******************************************************************************
**	DISCLAIMER
*******************************************************************************
**	This model is provided as is, where is, and with no warranty of any kind
**	either expressed or implied, including but not rdlimed to any implied
**	warranties of merchantability and fitness for a particular purpose.
*******************************************************************************

***********************************************************
****	Wolfspeed SiC MOSFET C3M0021120D Spice Library
****	Revision 1.0 Date: 11-24-2023
***********************************************************
****	Revision record
****	Revision 1	Initial Release
*********************************************************************************
****Parasitics Included
****Tj = Junction Temperature
****Tc = Case Temperature
****D = Drain
****G = Gate
****S1 = Kelvin Source
***********************************************************

.subckt C3M0016120D d g s1 Tj Tc

* Put in specified Rgint
.param Rgint = 3.3

Ci_d d 0 1p Rpar=1G
Ci_g	g 0 1p Rpar=1G
Ci_s1 s1 0 1p Rpar=1G
Ci_Tj Tj 0 1p Rpar=1G
Ci_Tc Tc 0 1p Rpar=1G

.func rdlim(x,n,p,z) {
+	uplim(dnlim(x,n,z),p,z)
+}

R1022	Tjc	0	1E6
E1022	Tjc	0 	value {rdlim(v(Tj),-40,175,.1)}

R100	gk	0	1E6
E100	gk	0 	value {rdlim(v(g1,s),-4,19,.1)}


e33	NET3	0	Value {rdlim(12.7090u*V(Tjc)**2-6.0898m*V(Tjc)+3.0156,-3.5,3.5,0.01)}
R_cc	NET3	0 	1E6

Ls1 		s1	s	2.17n Rser=10.11m
R_Ls1 		s1	s  	100

*R_gg 		g1	s	1E6
R_g 		g1	g2	{Rgint}
Lg 			g	g2	7.7n Rser=13.255m
R_Lg 		g	g2	100

Ld 		d	d3	4.366n Rser=87.416u
R_Ld		d	d3	100


Rdrain_s	d3	d1	10u
Cdrs		d3	d1	1p
Gheat		0	Tj	value = {abs((V(d1,s)*I(Rdrain_s)))+abs((V(g1,g2)**2/Rgint))}
CGS		g1	s	4806p Rpar=100k

*Body Diode Implementation
.func rbody(vgs,t) {table(t,-40,r1(vgs),25,r2(vgs),175,r3(vgs))}
.func r1(vgs) {table(vgs,-4,13.8m,-2,14.6m,0,16.6m,5,20m,10,30m,15,60m)}
.func r2(vgs) {table(vgs,-4,14.4m,-2,15.7m,0,18.01m,5,20m,10,35m,15,65m)}
.func r3(vgs) {table(vgs,-4,13.5m,-2,14.6m,0,16.3m,5,20m,10,30m,15,60m)}

.func nd(vgs,t) {table(t,-40,nd_n40(vgs),25,nd_25(vgs),175,nd_175(vgs))}
.func nd_n40(vgs) {table(vgs,-4,321.1m,-2,284.6m,0,228.5m,5,40m,10,10m,15,1m)}
.func nd_25(vgs) {table(vgs,-4,283.2m,-2,248.8m,0,198.7m,5,55m,10,35m,15,20m)}
.func nd_175(vgs) {table(vgs,-4,250.8m,-2,223.6m,0,191.3m,5,40m,10,10m,15,1m)}

GRbd d1 dd2 value {V(d1,dd2)/rdlim(rbody(V(gk),V(Tjc)),10m,60m,0.1)}
GITQ s dd2 value {uplim(1u*(-1+exp(V(s,dd2)/(V(ND)))),1e4,1m)}

Ef	ND	0	value {rdlim(nd(V(gk),V(Tjc)),1m,320m,0.01)}
Rf	ND	0	10Meg	

CDS1		dd2	s	1p
CGD1		g1	d3	1p
R_DS1		dd2	s	0.5G


R0 N1 Tj 44.1m
R1 N2 N1 103.97m
R2 N3 N2 63.77m
R3 Tc N3 112.06m

C0 Tj 0 2.214m
C1 N1 0 12.602m
C2 N2 0 34.161m
C3 N3 0 129.425m

R_tc Tc 0 10k

****************************************
.func gain(vgs,t) {
+	table(t,-40,g1(vgs),25,g2(vgs),175,g3(vgs))
+}

.func nval(vgs,t) {
+	table(t,-40,n1(vgs),25,n2(vgs),175,n3(vgs))
+}

.func lam(vgs,t) {
+	table(t,-40,l1(vgs),25,l2(vgs),175,l3(vgs))
+}

.func drain_current(vgs,vds,vth,g,n,l) {
+	g*(vgs-vth)*(log(1+exp(vgs-vth))**2 - log(1+exp(vgs-vth-n*vds))**2)*(1+l*vds)
+}

.func g1(vgs) {table(vgs,3,0.437187,3.32653,0.381029,3.65306,0.324932,3.97959,0.273285,4.30612,0.230477,4.63265,0.200898,4.95918,0.188937,5.28571,0.191097,5.61224,0.196476,5.93878,0.204646,6.26531,0.215327,6.59184,0.228238,6.91837,0.243099,7.2449,0.259491,7.57143,0.276881,7.89796,0.295141,8.22449,0.314164,8.55102,0.33384,8.87755,0.354059,9.20408,0.375303,9.53061,0.399112,9.85714,0.424328,10.1837,0.44955,10.5102,0.473377,10.8367,0.494407,11.1633,0.511748,11.4898,0.527151,11.8163,0.539971,12.1429,0.549062,12.4694,0.553279,12.7959,0.551479,13.1224,0.542388,13.449,0.52473,13.7755,0.500599,14.102,0.472696,14.4286,0.443725,14.7551,0.416386,15.0816,0.393158,15.4082,0.371282,15.7347,0.349491,16.0612,0.328321,16.3878,0.308306,16.7143,0.289983,17.0408,0.273866,17.3673,0.258854,17.6939,0.244398,18.0204,0.230962,18.3469,0.21901,18.6735,0.209004,19,0.201408)}
.func n1(vgs) {table(vgs,3,0.217282,3.32653,0.233482,3.65306,0.253855,3.97959,0.277533,4.30612,0.303649,4.63265,0.331334,4.95918,0.359722,5.28571,0.393716,5.61224,0.438284,5.93878,0.486965,6.26531,0.533165,6.59184,0.570291,6.91837,0.591748,7.2449,0.595751,7.57143,0.591708,7.89796,0.58179,8.22449,0.567722,8.55102,0.551229,8.87755,0.534034,9.20408,0.516794,9.53061,0.497091,9.85714,0.475998,10.1837,0.454965,10.5102,0.435444,10.8367,0.418884,11.1633,0.406236,11.4898,0.395657,11.8163,0.387365,12.1429,0.382044,12.4694,0.38038,12.7959,0.383059,13.1224,0.390819,13.449,0.40414,13.7755,0.42156,14.102,0.44131,14.4286,0.461616,14.7551,0.480708,15.0816,0.496932,15.4082,0.511604,15.7347,0.525777,16.0612,0.539635,16.3878,0.553357,16.7143,0.567127,17.0408,0.581124,17.3673,0.595257,17.6939,0.609401,18.0204,0.623559,18.3469,0.637731,18.6735,0.651918,19,0.666121)}
.func l1(vgs) {table(vgs,3,0.010286,3.32653,0.0103506,3.65306,0.0104124,3.97959,0.0104714,4.30612,0.0105273,4.63265,0.01058,4.95918,0.0106291,5.28571,0.010674,5.61224,0.010714,5.93878,0.0107494,6.26531,0.0107807,6.59184,0.0108082,6.91837,0.0108324,7.2449,0.0108444,7.57143,0.0108231,7.89796,0.01077,8.22449,0.0106877,8.55102,0.0105788,8.87755,0.010446,9.20408,0.0102635,9.53061,0.00994552,9.85714,0.0095239,10.1837,0.00904162,10.5102,0.00854167,10.8367,0.00806705,11.1633,0.00763409,11.4898,0.00713351,11.8163,0.00660088,12.1429,0.00609925,12.4694,0.00569166,12.7959,0.00544115,13.1224,0.00539211,13.449,0.0053927,13.7755,0.00539476,14.102,0.00539784,14.4286,0.00540151,14.7551,0.00540531,15.0816,0.00540884,15.4082,0.00541233,15.7347,0.0054159,16.0612,0.00541945,16.3878,0.00542288,16.7143,0.0054261,17.0408,0.00542899,17.3673,0.00543169,17.6939,0.00543428,18.0204,0.00543671,18.3469,0.00543895,18.6735,0.00544093,19,0.00544262)}
.func g2(vgs) {table(vgs,3,0.39186,3.32653,0.38375,3.65306,0.376825,3.97959,0.371783,4.30612,0.369321,4.63265,0.370133,4.95918,0.374917,5.28571,0.384653,5.61224,0.398954,5.93878,0.41591,6.26531,0.433596,6.59184,0.45009,6.91837,0.463469,7.2449,0.473417,7.57143,0.482469,7.89796,0.489899,8.22449,0.494815,8.55102,0.496323,8.87755,0.493532,9.20408,0.48548,9.53061,0.472101,9.85714,0.454865,10.1837,0.435326,10.5102,0.415037,10.8367,0.395552,11.1633,0.377906,11.4898,0.360114,11.8163,0.342088,12.1429,0.324211,12.4694,0.306862,12.7959,0.290425,13.1224,0.275211,13.449,0.260768,13.7755,0.246947,14.102,0.233768,14.4286,0.221249,14.7551,0.209408,15.0816,0.198243,15.4082,0.187348,15.7347,0.176706,16.0612,0.166505,16.3878,0.156936,16.7143,0.148187,17.0408,0.14044,17.3673,0.133149,17.6939,0.126071,18.0204,0.119436,18.3469,0.113474,18.6735,0.108414,19,0.104486)}
.func n2(vgs) {table(vgs,3,0.263405,3.32653,0.284886,3.65306,0.310278,3.97959,0.338802,4.30612,0.369682,4.63265,0.40214,4.95918,0.435399,5.28571,0.474416,5.61224,0.524076,5.93878,0.577816,6.26531,0.62894,6.59184,0.670753,6.91837,0.696559,7.2449,0.701323,7.57143,0.689538,7.89796,0.668522,8.22449,0.645553,8.55102,0.627911,8.87755,0.622873,9.20408,0.633768,9.53061,0.649363,9.85714,0.667395,10.1837,0.686833,10.5102,0.706641,10.8367,0.725787,11.1633,0.743487,11.4898,0.760661,11.8163,0.777679,12.1429,0.794709,12.4694,0.811922,12.7959,0.829486,13.1224,0.847526,13.449,0.865764,13.7755,0.884301,14.102,0.903372,14.4286,0.923209,14.7551,0.944045,15.0816,0.966139,15.4082,0.990111,15.7347,1.01572,16.0612,1.04239,16.3878,1.06958,16.7143,1.09672,17.0408,1.12326,17.3673,1.14947,17.6939,1.17571,18.0204,1.20199,18.3469,1.22831,18.6735,1.25468,19,1.28108)}
.func l2(vgs) {table(vgs,3,0.00693166,3.32653,0.00696267,3.65306,0.00699259,3.97959,0.00702113,4.30612,0.00704797,4.63265,0.00707281,4.95918,0.00709533,5.28571,0.00711705,5.61224,0.00713948,5.93878,0.0071605,6.26531,0.00717798,6.59184,0.00718977,6.91837,0.00719372,7.2449,0.00718748,7.57143,0.00717126,7.89796,0.0071484,8.22449,0.00712231,8.55102,0.00709643,8.87755,0.00707416,9.20408,0.00706025,9.53061,0.00705895,9.85714,0.00706512,10.1837,0.00707292,10.5102,0.00707653,10.8367,0.00707011,11.1633,0.00704395,11.4898,0.00697645,11.8163,0.00687688,12.1429,0.00675921,12.4694,0.00663741,12.7959,0.00652546,13.1224,0.0064337,13.449,0.00633735,13.7755,0.00623713,14.102,0.00614354,14.4286,0.0060671,14.7551,0.00601831,15.0816,0.00600622,15.4082,0.00600649,15.7347,0.00600693,16.0612,0.00600749,16.3878,0.0060081,16.7143,0.00600872,17.0408,0.00600928,17.3673,0.0060098,17.6939,0.00601033,18.0204,0.00601085,18.3469,0.00601138,18.6735,0.00601191,19,0.00601245)}
.func g3(vgs) {table(vgs,3,0.720402,3.32653,0.739909,3.65306,0.758471,3.97959,0.774833,4.30612,0.78774,4.63265,0.795936,4.95918,0.798166,5.28571,0.794251,5.61224,0.785716,5.93878,0.77314,6.26531,0.757085,6.59184,0.738111,6.91837,0.716782,7.2449,0.692244,7.57143,0.662165,7.89796,0.628041,8.22449,0.59154,8.55102,0.554328,8.87755,0.518071,9.20408,0.483178,9.53061,0.446502,9.85714,0.409062,10.1837,0.37233,10.5102,0.337773,10.8367,0.30686,11.1633,0.280513,11.4898,0.256408,11.8163,0.234204,12.1429,0.214054,12.4694,0.196113,12.7959,0.180532,13.1224,0.167285,13.449,0.154695,13.7755,0.142597,14.102,0.131343,14.4286,0.121282,14.7551,0.112767,15.0816,0.106088,15.4082,0.100181,15.7347,0.0945821,16.0612,0.0893471,16.3878,0.084531,16.7143,0.080189,17.0408,0.0763708,17.3673,0.0727061,17.6939,0.0690505,18.0204,0.0655506,18.3469,0.0623529,18.6735,0.0596039,19,0.0574502)}
.func n3(vgs) {table(vgs,3,0.231883,3.32653,0.25443,3.65306,0.279434,3.97959,0.306446,4.30612,0.335019,4.63265,0.364703,4.95918,0.395052,5.28571,0.429868,5.61224,0.472677,5.93878,0.518356,6.26531,0.561682,6.59184,0.597435,6.91837,0.620391,7.2449,0.626424,7.57143,0.618644,7.89796,0.602926,8.22449,0.585139,8.55102,0.571153,8.87755,0.566835,9.20408,0.575123,9.53061,0.587966,9.85714,0.60376,10.1837,0.621806,10.5102,0.641402,10.8367,0.661848,11.1633,0.682714,11.4898,0.705029,11.8163,0.728647,12.1429,0.753162,12.4694,0.778169,12.7959,0.803261,13.1224,0.828112,13.449,0.853204,13.7755,0.878612,14.102,0.904217,14.4286,0.929899,14.7551,0.955539,15.0816,0.981025,15.4082,1.00643,15.7347,1.03182,16.0612,1.05721,16.3878,1.0826,16.7143,1.108,17.0408,1.13344,17.3673,1.15889,17.6939,1.18437,18.0204,1.20985,18.3469,1.23535,18.6735,1.26087,19,1.28639)}
.func l3(vgs) {table(vgs,3,0.006517,3.32653,0.00656148,3.65306,0.00660398,3.97959,0.00664423,4.30612,0.00668199,4.63265,0.00671701,4.95918,0.00674903,5.28571,0.00677981,5.61224,0.0068106,5.93878,0.00683836,6.26531,0.00686,6.59184,0.00687243,6.91837,0.00687255,7.2449,0.00685364,7.57143,0.00681001,7.89796,0.0067505,8.22449,0.00668446,8.55102,0.00662124,8.87755,0.0065702,9.20408,0.00653512,9.53061,0.00650126,9.85714,0.00646902,10.1837,0.00644063,10.5102,0.00641832,10.8367,0.00640433,11.1633,0.00639938,11.4898,0.00639585,11.8163,0.00639267,12.1429,0.00639027,12.4694,0.00638903,12.7959,0.00638937,13.1224,0.00639154,13.449,0.00639438,13.7755,0.00639743,14.102,0.00640056,14.4286,0.00640365,14.7551,0.00640655,15.0816,0.00640917,15.4082,0.00641168,15.7347,0.00641415,16.0612,0.00641654,16.3878,0.00641881,16.7143,0.00642092,17.0408,0.00642284,17.3673,0.00642465,17.6939,0.00642641,18.0204,0.00642807,18.3469,0.00642961,18.6735,0.00643097,19,0.00643213)}


****************************************
G2 d1 s value {
+	if(V(d3,s)<=0,
+		if (V(gk)<=V(NET3),
+		0
+		,
+		-drain_current(V(gk),V(s,d3),V(NET3),gain(V(gk),V(Tjc)),nval(V(gk),V(Tjc)),lam(V(gk),V(Tjc)))
+		)
+		,
+		if (V(gk)<=V(NET3),
+		0
+		,
+		drain_current(V(gk),V(d3,s),V(NET3),gain(V(gk),V(Tjc)),nval(V(gk),V(Tjc)),lam(V(gk),V(Tjc)))
+		)
+			)
+			}
****************************************
.param k1=2565p
.param k2=0.5
.param ka=90
.param kb=0.3
.param kc=3.0

G11 g1 d11 value {
+		k1*(
+		(1+(rdlim(v(d3,g1),0.1,270,0.01))*(1+ka*(1+TANH(kb*V(d3,g1)-kc))/2))**(-k2)
+		)*ddt(v(g1,d3))
+			} Rpar=1Meg
R_CGD d11 d3 1E-4


.param Cjo = 5179p
.param Vj  = 4.4365
.param M   = 0.643

G12 d12 s value {
+		(Cjo/(1+(rdlim(v(d3,s),0.1,270,0.01)/Vj)**M))*ddt(v(d3,s))
+			} Rpar=1Meg
R_CDS d12 d3 1E-4

****************************************


.ends C3M0016120D

****************************************

