**************************************************************************************************************************************************************************************************
*
*  888888              888888               888888  .o888888888888o.    8888         88888888888  o888888888888888   88888888888888o   88888888888  88888888888  8888888888o
*   88888             88888888             88888   .8888888  8888888.   8888         88888888888  o8888888888888888  888888  8888888o  88888888888  88888888888  88888888888o
*    88888           8888  8888           88888   .8888888.  .8888888.  8888         8888         888888888          888888  88888888  8888         8888         8888   88888
*     88888         8888    8888         88888    88888888    88888888  8888         8888         888888888          888888  88888888  8888         8888         8888   88888
*      88888       8888      8888       88888     88888888    88888888  8888         8888888      o888888888888888o  888888  8888888o  8888888      8888888      8888   88888
*       88888     8888        8888     88888      88888888    88888888  8888         8888888      o888888888888888o  88888888888888o   8888888      8888888      8888   88888
*        88888   8888          8888   88888       88888888    88888888  8888         8888                  88888888  8888              8888         8888         8888   88888
*         88888 8888            8888 88888        .8888888.  .8888888.  8888         8888                  88888888  8888              8888         8888         8888   88888
*          88888888             88888888           .8888888  8888888.   88888888888  8888         8888888888888888o  8888              88888888888  88888888888  88888888888o
*           888888               888888             .o888888888888o.    88888888888  8888         888888888888888o   8888              88888888888  88888888888  8888888888o
*
**************************************************************************************************************************************************************************************************
*******************************************************************************
**	DISCLAIMER
*******************************************************************************
**	This model is provided as is, where is, and with no warranty of any kind
**	either expressed or implied, including but not rdlimed to any implied
**	warranties of merchantability and fitness for a particular purpose.
*******************************************************************************

***********************************************************
****	Wolfspeed SiC MOSFET C3M0040120D Spice Library
****	Version 1.0 Date: 12-04-2020
****	Version 2.0 Date: 07-31-2023
***********************************************************
****	Revision record
****	Version 1	Initial Release, Datasheet Rev 1, 10-2020
****	Version 2	Update to new model structure
*********************************************************************************
****Parasitics Included
****Tj = Junction Temperature
****Tc = Case Temperature
****D = Drain
****G = Gate
****S1 = Kelvin Source
****S2 = Power Source
***********************************************************

.subckt C3M0040120D d g s1 Tj Tc

* Put in specified Rgint
.param Rgint = 3.5

Ci_d d 0 1p Rpar=1G
Ci_g	g 0 1p Rpar=1G
Ci_s1 s1 0 1p Rpar=1G
Ci_Tj Tj 0 1p Rpar=1G
Ci_Tc Tc 0 1p Rpar=1G

.func rdlim(x,n,p,z) {
+	uplim(dnlim(x,n,z),p,z)
+}

R1022	Tjc	0	1E6
E1022	Tjc	0 	value {rdlim(v(Tj),-40,175,.1)}

R100	gk	0	1E6
E100	gk	0 	value {rdlim(v(g1,s),-4,19,.1)}


e33	NET3	0	Value {rdlim(12.9761u*V(Tjc)**2-6.0066m*V(Tjc)+2.6953,-3.5,3.5,0.01)}
R_cc	NET3	0 	1E6

Ls1 		s1	s	2.17n Rser=1.881m
R_Ls1 		s1	s  	100

*R_gg 		g1	s	1E6
R_g 		g1	g2	{Rgint}
Lg 			g	g2	7.7n Rser=13.255m
R_Lg 		g	g2	100

Ld 		d	d3	4.366n Rser=87.416u
R_Ld		d	d3	100


Rdrain_s	d3	d1	10u
Cdrs		d3	d1	1p
Gheat		0	Tj	value = {abs((V(d1,s)*I(Rdrain_s)))+abs((V(g1,g2)**2/Rgint))}
CGS		g1	s	2578p Rpar=100k

*Body Diode Implementation
.func rbody(vgs,t) {table(t,-40,r1(vgs),25,r2(vgs),175,r3(vgs))}
.func r1(vgs) {table(vgs,-4,24.71m,-2,26.27m,0,29.1m,5,20m,10,30m,15,60m)}
.func r2(vgs) {table(vgs,-4,24.61m,-2,27.1m,0,30.68m,5,20m,10,35m,15,65m)}
.func r3(vgs) {table(vgs,-4,20.57m,-2,21.92m,0,23.52m,5,10m,10,30m,15,60m)}

.func nd(vgs,t) {table(t,-40,nd_n40(vgs),25,nd_25(vgs),175,nd_175(vgs))}
.func nd_n40(vgs) {table(vgs,-4,322.54m,-2,282.65m,0,227.03m,5,40m,10,10m,15,1m)}
.func nd_25(vgs) {table(vgs,-4,293.26m,-2,256.81m,0,206.8m,5,55m,10,35m,15,20m)}
.func nd_175(vgs) {table(vgs,-4,273.94m,-2,250.06m,0,224.66m,5,40m,10,10m,15,1m)}

GRbd d1 dd2 value {V(d1,dd2)/rdlim(rbody(V(gk),V(Tjc)),10m,60m,0.1)}
GITQ s dd2 value {uplim(1u*(-1+exp(V(s,dd2)/(V(ND)))),1e4,1m)}

Ef	ND	0	value {rdlim(nd(V(gk),V(Tjc)),1m,320m,0.01)}
Rf	ND	0	10Meg	

CDS1		dd2	s	1p
CGD1		g1	d3	1p
R_DS1		dd2	s	0.5G


R0 N1 Tj 63.78m
R1 N2 N1 0.1553
R2 N3 N2 99.42m
R3 Tc N3 0.1417

C0 Tj 0 1.31m
C1 N1 0 6.698m
C2 N2 0 19.41m
C3 N3 0 73.01m

R_tc Tc 0 10k

****************************************
.func gain(vgs,t) {
+	table(t,-40,g1(vgs),25,g2(vgs),175,g3(vgs))
+}

.func nval(vgs,t) {
+	table(t,-40,n1(vgs),25,n2(vgs),175,n3(vgs))
+}

.func lam(vgs,t) {
+	table(t,-40,l1(vgs),25,l2(vgs),175,l3(vgs))
+}

.func drain_current(vgs,vds,vth,g,n,l) {
+	g*(vgs-vth)*(log(1+exp(vgs-vth))**2 - log(1+exp(vgs-vth-n*vds))**2)*(1+l*vds)
+}

.func g1(vgs) {table(vgs,3,1.99998,3.32653,1.57747,3.65306,1.1492,3.97959,0.750502,4.30612,0.416688,4.63265,0.183084,4.95918,0.0850146,5.28571,0.0874282,5.61224,0.0926092,5.93878,0.0986679,6.26531,0.105057,6.59184,0.11123,6.91837,0.11664,7.2449,0.121346,7.57143,0.126397,7.89796,0.131538,8.22449,0.136446,8.55102,0.1408,8.87755,0.144279,9.20408,0.146691,9.53061,0.148333,9.85714,0.149219,10.1837,0.149321,10.5102,0.148613,10.8367,0.147066,11.1633,0.144609,11.4898,0.141049,11.8163,0.136611,12.1429,0.131579,12.4694,0.126236,12.7959,0.120865,13.1224,0.115687,13.449,0.110275,13.7755,0.104626,14.102,0.0989062,14.4286,0.093283,14.7551,0.0879232,15.0816,0.0829769,15.4082,0.0782159,15.7347,0.0735764,16.0612,0.069139,16.3878,0.0649843,16.7143,0.0611929,17.0408,0.0578412,17.3673,0.0546925,17.6939,0.0516449,18.0204,0.0488017,18.3469,0.0462664,18.6735,0.0441424,19,0.0425331)}
.func n1(vgs) {table(vgs,3,1.96136,3.32653,1.62068,3.65306,1.27712,3.97959,0.959614,4.30612,0.697093,4.63265,0.518498,4.95918,0.452767,5.28571,0.481108,5.61224,0.532663,5.93878,0.59485,6.26531,0.655958,6.59184,0.704275,6.91837,0.72809,7.2449,0.726999,7.57143,0.723362,7.89796,0.719189,8.22449,0.715364,8.55102,0.712772,8.87755,0.712296,9.20408,0.714223,9.53061,0.716834,9.85714,0.720011,10.1837,0.723832,10.5102,0.728375,10.8367,0.73372,11.1633,0.74062,11.4898,0.752757,11.8163,0.769743,12.1429,0.790468,12.4694,0.813821,12.7959,0.838688,13.1224,0.864377,13.449,0.893996,13.7755,0.927191,14.102,0.962426,14.4286,0.998162,14.7551,1.03286,15.0816,1.06508,15.4082,1.09576,15.7347,1.12581,16.0612,1.15546,16.3878,1.18495,16.7143,1.21453,17.0408,1.24442,17.3673,1.27451,17.6939,1.30463,18.0204,1.33479,18.3469,1.36498,18.6735,1.39522,19,1.42549)}
.func l1(vgs) {table(vgs,3,0.099999,3.32653,0.0821805,3.65306,0.064116,3.97959,0.0472877,4.30612,0.0331777,4.63265,0.0232682,4.95918,0.0190416,5.28571,0.0190057,5.61224,0.019037,5.93878,0.019074,6.26531,0.0191121,6.59184,0.0191468,6.91837,0.0191734,7.2449,0.0191934,7.57143,0.0192177,7.89796,0.019243,8.22449,0.0192657,8.55102,0.0192819,8.87755,0.0192878,9.20408,0.019281,9.53061,0.0192651,9.85714,0.0192434,10.1837,0.0192184,10.5102,0.0191929,10.8367,0.0191698,11.1633,0.0191506,11.4898,0.0191305,11.8163,0.0191105,12.1429,0.0190925,12.4694,0.0190786,12.7959,0.0190708,13.1224,0.0190722,13.449,0.0190938,13.7755,0.0191308,14.102,0.0191749,14.4286,0.0192177,14.7551,0.0192506,15.0816,0.0192659,15.4082,0.019274,15.7347,0.0192811,16.0612,0.0192872,16.3878,0.0192925,16.7143,0.0192973,17.0408,0.0193017,17.3673,0.0193062,17.6939,0.0193107,18.0204,0.0193152,18.3469,0.0193194,18.6735,0.0193231,19,0.0193261)}
.func g2(vgs) {table(vgs,3,0.174616,3.32653,0.168684,3.65306,0.162806,3.97959,0.157564,4.30612,0.153542,4.63265,0.151324,4.95918,0.151495,5.28571,0.154145,5.61224,0.158331,5.93878,0.163356,6.26531,0.168529,6.59184,0.173161,6.91837,0.176562,7.2449,0.178534,7.57143,0.179928,7.89796,0.180757,8.22449,0.180981,8.55102,0.180566,8.87755,0.179473,9.20408,0.177548,9.53061,0.174432,9.85714,0.170321,10.1837,0.165458,10.5102,0.160088,10.8367,0.154454,11.1633,0.148646,11.4898,0.142012,11.8163,0.13474,12.1429,0.127178,12.4694,0.119674,12.7959,0.112574,13.1224,0.106156,13.449,0.0999526,13.7755,0.0938868,14.102,0.0880615,14.4286,0.08258,14.7551,0.0775454,15.0816,0.0730459,15.4082,0.0688356,15.7347,0.0648253,16.0612,0.0610559,16.3878,0.0575682,16.7143,0.0544031,17.0408,0.0515981,17.3673,0.0489292,17.6939,0.0463119,18.0204,0.0438425,18.3469,0.0416173,18.6735,0.0397327,19,0.0382851)}
.func n2(vgs) {table(vgs,3,0.320089,3.32653,0.344104,3.65306,0.372956,3.97959,0.405683,4.30612,0.441323,4.63265,0.478914,4.95918,0.517494,5.28571,0.563756,5.61224,0.624114,5.93878,0.68959,6.26531,0.751024,6.59184,0.799259,6.91837,0.825134,7.2449,0.826617,7.57143,0.818487,7.89796,0.805038,8.22449,0.789903,8.55102,0.776715,8.87755,0.769107,9.20408,0.768639,9.53061,0.769682,9.85714,0.771887,10.1837,0.775571,10.5102,0.781054,10.8367,0.788654,11.1633,0.799218,11.4898,0.815584,11.8163,0.836956,12.1429,0.86194,12.4694,0.889143,12.7959,0.917168,13.1224,0.944932,13.449,0.97447,13.7755,1.00587,14.102,1.0384,14.4286,1.07134,14.7551,1.10396,15.0816,1.13557,15.4082,1.16665,15.7347,1.19757,16.0612,1.22841,16.3878,1.25924,16.7143,1.29012,17.0408,1.32112,17.3673,1.3522,17.6939,1.38332,18.0204,1.41449,18.3469,1.44569,18.6735,1.47694,19,1.50822)}
.func l2(vgs) {table(vgs,3,0.0171738,3.32653,0.017221,3.65306,0.0172668,3.97959,0.0173105,4.30612,0.0173515,4.63265,0.0173891,4.95918,0.0174226,5.28571,0.0174511,5.61224,0.0174753,5.93878,0.0174969,6.26531,0.0175181,6.59184,0.0175405,6.91837,0.0175661,7.2449,0.0175992,7.57143,0.0176428,7.89796,0.0176905,8.22449,0.0177355,8.55102,0.0177711,8.87755,0.0177905,9.20408,0.01779,9.53061,0.0177787,9.85714,0.0177607,10.1837,0.0177392,10.5102,0.0177176,10.8367,0.0176992,11.1633,0.017686,11.4898,0.0176728,11.8163,0.0176594,12.1429,0.0176469,12.4694,0.0176361,12.7959,0.017628,13.1224,0.0176232,13.449,0.0176197,13.7755,0.0176169,14.102,0.017615,14.4286,0.0176143,14.7551,0.017615,15.0816,0.0176175,15.4082,0.0176211,15.7347,0.0176255,16.0612,0.0176303,16.3878,0.017635,16.7143,0.0176394,17.0408,0.0176431,17.3673,0.0176464,17.6939,0.0176496,18.0204,0.0176527,18.3469,0.0176555,18.6735,0.0176581,19,0.0176602)}
.func g3(vgs) {table(vgs,3,0.324316,3.32653,0.325902,3.65306,0.326633,3.97959,0.326521,4.30612,0.325579,4.63265,0.323817,4.95918,0.32125,5.28571,0.317505,5.61224,0.312142,5.93878,0.305427,6.26531,0.297635,6.59184,0.289041,6.91837,0.27992,7.2449,0.27011,7.57143,0.258894,7.89796,0.246641,8.22449,0.233772,8.55102,0.220705,8.87755,0.207862,9.20408,0.195326,9.53061,0.182255,9.85714,0.168951,10.1837,0.155837,10.5102,0.143336,10.8367,0.131873,11.1633,0.121709,11.4898,0.112172,11.8163,0.103211,12.1429,0.0949229,12.4694,0.087405,12.7959,0.0807547,13.1224,0.0750017,13.449,0.0695493,13.7755,0.0643343,14.102,0.0594827,14.4286,0.0551203,14.7551,0.051373,15.0816,0.0483437,15.4082,0.0456274,15.7347,0.0430525,16.0612,0.0406439,16.3878,0.0384269,16.7143,0.0364265,17.0408,0.0346653,17.3673,0.0329773,17.6939,0.0312981,18.0204,0.0296944,18.3469,0.0282329,18.6735,0.0269804,19,0.0260036)}
.func n3(vgs) {table(vgs,3,0.27115,3.32653,0.295525,3.65306,0.322941,3.97959,0.352821,4.30612,0.384585,4.63265,0.417655,4.95918,0.451452,5.28571,0.490984,5.61224,0.540869,5.93878,0.594349,6.26531,0.644534,6.59184,0.684539,6.91837,0.707472,7.2449,0.709076,7.57143,0.695614,7.89796,0.673531,8.22449,0.64912,8.55102,0.628672,8.87755,0.618477,9.20408,0.621395,9.53061,0.627936,9.85714,0.63678,10.1837,0.647691,10.5102,0.660433,10.8367,0.674769,11.1633,0.69063,11.4898,0.708664,11.8163,0.728512,12.1429,0.749639,12.4694,0.771507,12.7959,0.793583,13.1224,0.815418,13.449,0.837577,13.7755,0.860217,14.102,0.883276,14.4286,0.906691,14.7551,0.9304,15.0816,0.954354,15.4082,0.978767,15.7347,1.00362,16.0612,1.02877,16.3878,1.05405,16.7143,1.07932,17.0408,1.10444,17.3673,1.12947,17.6939,1.15451,18.0204,1.17956,18.3469,1.20463,18.6735,1.22972,19,1.25481)}
.func l3(vgs) {table(vgs,3,0.0157792,3.32653,0.0158469,3.65306,0.0159127,3.97959,0.0159752,4.30612,0.0160329,4.63265,0.0160846,4.95918,0.0161289,5.28571,0.0161677,5.61224,0.0162051,5.93878,0.0162395,6.26531,0.0162694,6.59184,0.0162932,6.91837,0.0163093,7.2449,0.0163158,7.57143,0.0163118,7.89796,0.0162985,8.22449,0.0162771,8.55102,0.016249,8.87755,0.0162154,9.20408,0.016172,9.53061,0.0161031,9.85714,0.016018,10.1837,0.0159278,10.5102,0.015844,10.8367,0.015778,11.1633,0.0157367,11.4898,0.015702,11.8163,0.0156709,12.1429,0.0156442,12.4694,0.0156228,12.7959,0.0156074,13.1224,0.0155984,13.449,0.0155899,13.7755,0.0155813,14.102,0.0155737,14.4286,0.0155682,14.7551,0.0155662,15.0816,0.0155685,15.4082,0.0155731,15.7347,0.0155787,16.0612,0.0155847,16.3878,0.0155907,16.7143,0.0155962,17.0408,0.0156007,17.3673,0.0156047,17.6939,0.0156087,18.0204,0.0156125,18.3469,0.015616,18.6735,0.015619,19,0.0156216)}


****************************************
G2 d1 s value {
+	if(V(d3,s)<=0,
+		if (V(gk)<=V(NET3),
+		0
+		,
+		-drain_current(V(gk),V(s,d3),V(NET3),gain(V(gk),V(Tjc)),nval(V(gk),V(Tjc)),lam(V(gk),V(Tjc)))
+		)
+		,
+		if (V(gk)<=V(NET3),
+		0
+		,
+		drain_current(V(gk),V(d3,s),V(NET3),gain(V(gk),V(Tjc)),nval(V(gk),V(Tjc)),lam(V(gk),V(Tjc)))
+		)
+			)
+			}
****************************************
.param k1=1030p
.param k2=0.36847
.param ka=1953.229
.param kb=6028.025
.param kc=71938.74

G11 g1 d11 value {
+		k1*(
+		(1+(rdlim(v(d3,g1),0.1,270,0.01))*(1+ka*(1+TANH(kb*V(d3,g1)-kc))/2))**(-k2)
+		)*ddt(v(g1,d3))
+			} Rpar=1Meg
R_CGD d11 d3 1E-4


.param Cjo = 2315.84p
.param Vj  = 4.20
.param M   = 0.67


G12 d12 s value {
+		(Cjo/(1+(rdlim(v(d3,s),0.1,270,0.01)/Vj)**M))*ddt(v(d3,s))
+			} Rpar=1Meg
R_CDS d12 d3 1E-4

****************************************


.ends C3M0040120D

****************************************

