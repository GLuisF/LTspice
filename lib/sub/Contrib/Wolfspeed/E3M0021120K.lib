**************************************************************************************************************************************************************************************************
*
*  888888              888888               888888  .o888888888888o.    8888         88888888888  o888888888888888   88888888888888o   88888888888  88888888888  8888888888o
*   88888             88888888             88888   .8888888  8888888.   8888         88888888888  o8888888888888888  888888  8888888o  88888888888  88888888888  88888888888o
*    88888           8888  8888           88888   .8888888.  .8888888.  8888         8888         888888888          888888  88888888  8888         8888         8888   88888
*     88888         8888    8888         88888    88888888    88888888  8888         8888         888888888          888888  88888888  8888         8888         8888   88888
*      88888       8888      8888       88888     88888888    88888888  8888         8888888      o888888888888888o  888888  8888888o  8888888      8888888      8888   88888
*       88888     8888        8888     88888      88888888    88888888  8888         8888888      o888888888888888o  88888888888888o   8888888      8888888      8888   88888
*        88888   8888          8888   88888       88888888    88888888  8888         8888                  88888888  8888              8888         8888         8888   88888
*         88888 8888            8888 88888        .8888888.  .8888888.  8888         8888                  88888888  8888              8888         8888         8888   88888
*          88888888             88888888           .8888888  8888888.   88888888888  8888         8888888888888888o  8888              88888888888  88888888888  88888888888o
*           888888               888888             .o888888888888o.    88888888888  8888         888888888888888o   8888              88888888888  88888888888  8888888888o
*
**************************************************************************************************************************************************************************************************
*******************************************************************************
**	DISCLAIMER
*******************************************************************************
**	This model is provided as is, where is, and with no warranty of any kind
**	either expressed or implied, including but not rdlimed to any implied
**	warranties of merchantability and fitness for a particular purpose.
*******************************************************************************

***********************************************************
****	Wolfspeed SiC MOSFET E3M0021120K Spice Library
****	Revision 1.0 Date: 11-24-2023
***********************************************************
****	Revision record
****	Revision 1	Initial Release
*********************************************************************************
****Parasitics Included
****Tj = Junction Temperature
****Tc = Case Temperature
****D = Drain
****G = Gate
****S1 = Kelvin Source
****S2 = Power Source
***********************************************************

.subckt E3M0021120K d g s1 s2 Tj Tc

* Put in specified Rgint
.param Rgint = 3.3

Ci_d d 0 1p Rpar=1G
Ci_g	g 0 1p Rpar=1G
Ci_s1 s1 0 1p Rpar=1G
Ci_s2 s2 0 1p Rpar=1G
Ci_Tj Tj 0 1p Rpar=1G
Ci_Tc Tc 0 1p Rpar=1G

.func rdlim(x,n,p,z) {
+	uplim(dnlim(x,n,z),p,z)
+}

R1022	Tjc	0	1E6
E1022	Tjc	0 	value {rdlim(v(Tj),-40,175,.1)}

R100	gk	0	1E6
E100	gk	0 	value {rdlim(v(g1,s),-4,19,.1)}


e33	NET3	0	Value {rdlim(12.7090u*V(Tjc)**2-6.0898m*V(Tjc)+3.0156,-3.5,3.5,0.01)}
R_cc	NET3	0 	1E6

Ls1 		s1	sv	8.17n Rser=10.34m
R_Ls1 		s1	sv  	100

Ls2 		s2	sv	2.3n Rser=0.73m
R_Ls2 		s2	sv  	100

Rv		sv	s	100
Lv		sv	s	0.65n Rser=0.1m

*R_gg 		g1	s	1E6
R_g 		g1	g2	{Rgint}
Lg 			g	g2	7.7n Rser=13.255m
R_Lg 		g	g2	100

Ld 		d	d3	4.366n Rser=87.416u
R_Ld		d	d3	100


Rdrain_s	d3	d1	10u
Cdrs		d3	d1	1p
Gheat		0	Tj	value = {abs((V(d1,s)*I(Rdrain_s)))+abs((V(g1,g2)**2/Rgint))}
CGS		g1	s	4806p Rpar=100k

*Body Diode Implementation
.func rbody(vgs,t) {table(t,-40,r1(vgs),25,r2(vgs),175,r3(vgs))}
.func r1(vgs) {table(vgs,-4,13.8m,-2,14.6m,0,16.6m,5,20m,10,30m,15,60m)}
.func r2(vgs) {table(vgs,-4,14.4m,-2,15.7m,0,18.01m,5,20m,10,35m,15,65m)}
.func r3(vgs) {table(vgs,-4,13.5m,-2,14.6m,0,16.3m,5,20m,10,30m,15,60m)}

.func nd(vgs,t) {table(t,-40,nd_n40(vgs),25,nd_25(vgs),175,nd_175(vgs))}
.func nd_n40(vgs) {table(vgs,-4,321.1m,-2,284.6m,0,228.5m,5,40m,10,10m,15,1m)}
.func nd_25(vgs) {table(vgs,-4,283.2m,-2,248.8m,0,198.7m,5,55m,10,35m,15,20m)}
.func nd_175(vgs) {table(vgs,-4,250.8m,-2,223.6m,0,191.3m,5,40m,10,10m,15,1m)}

GRbd d1 dd2 value {V(d1,dd2)/rdlim(rbody(V(gk),V(Tjc)),10m,60m,0.1)}
GITQ s dd2 value {uplim(1u*(-1+exp(V(s,dd2)/(V(ND)))),1e4,1m)}

Ef	ND	0	value {rdlim(nd(V(gk),V(Tjc)),1m,320m,0.01)}
Rf	ND	0	10Meg	

CDS1		dd2	s	1p
CGD1		g1	d3	1p
R_DS1		dd2	s	0.5G


R0 N1 Tj 44.1m
R1 N2 N1 103.97m
R2 N3 N2 63.77m
R3 Tc N3 112.06m

C0 Tj 0 2.214m
C1 N1 0 12.602m
C2 N2 0 34.161m
C3 N3 0 129.425m

R_tc Tc 0 10k

****************************************
.func gain(vgs,t) {
+	table(t,-40,g1(vgs),25,g2(vgs),175,g3(vgs))
+}

.func nval(vgs,t) {
+	table(t,-40,n1(vgs),25,n2(vgs),175,n3(vgs))
+}

.func lam(vgs,t) {
+	table(t,-40,l1(vgs),25,l2(vgs),175,l3(vgs))
+}

.func drain_current(vgs,vds,vth,g,n,l) {
+	g*(vgs-vth)*(log(1+exp(vgs-vth))**2 - log(1+exp(vgs-vth-n*vds))**2)*(1+l*vds)
+}

.func g1(vgs) {table(vgs,3,0.000661418,3.32653,0.0264153,3.65306,0.0518686,3.97959,0.0758115,4.30612,0.0970343,4.63265,0.114327,4.95918,0.12648,5.28571,0.134333,5.61224,0.140909,5.93878,0.146699,6.26531,0.152155,6.59184,0.15773,6.91837,0.163876,7.2449,0.170898,7.57143,0.178471,7.89796,0.186219,8.22449,0.193777,8.55102,0.200777,8.87755,0.206853,9.20408,0.211873,9.53061,0.216435,9.85714,0.220445,10.1837,0.223726,10.5102,0.226101,10.8367,0.227394,11.1633,0.227397,11.4898,0.225902,11.8163,0.223097,12.1429,0.219216,12.4694,0.214494,12.7959,0.209169,13.1224,0.203362,13.449,0.196205,13.7755,0.187847,14.102,0.178762,14.4286,0.169428,14.7551,0.16032,15.0816,0.151867,15.4082,0.143438,15.7347,0.134882,16.0612,0.126456,16.3878,0.118419,16.7143,0.11103,17.0408,0.104537,17.3673,0.0985509,17.6939,0.0928534,18.0204,0.0876101,18.3469,0.0829866,18.6735,0.0791487,19,0.0762621)}
.func n1(vgs) {table(vgs,3,0.834273,3.32653,0.754498,3.65306,0.675121,3.97959,0.603905,4.30612,0.548615,4.63265,0.517014,4.95918,0.516868,5.28571,0.552161,5.61224,0.612359,5.93878,0.684235,6.26531,0.754587,6.59184,0.810213,6.91837,0.837911,7.2449,0.837131,7.57143,0.832827,7.89796,0.827203,8.22449,0.821207,8.55102,0.815787,8.87755,0.811888,9.20408,0.809857,9.53061,0.808021,9.85714,0.806313,10.1837,0.804866,10.5102,0.803812,10.8367,0.803283,11.1633,0.80386,11.4898,0.808128,11.8163,0.81609,12.1429,0.827276,12.4694,0.841216,12.7959,0.85744,13.1224,0.876155,13.449,0.903176,13.7755,0.937596,14.102,0.976466,14.4286,1.01684,14.7551,1.05576,15.0816,1.09048,15.4082,1.123,15.7347,1.15494,16.0612,1.18652,16.3878,1.21797,16.7143,1.24951,17.0408,1.28136,17.3673,1.3134,17.6939,1.34549,18.0204,1.37762,18.3469,1.40981,18.6735,1.44204,19,1.47432)}
.func l1(vgs) {table(vgs,3,0.0148308,3.32653,0.015866,3.65306,0.0169097,3.97959,0.0178823,4.30612,0.0187045,4.63265,0.0192966,4.95918,0.0195793,5.28571,0.0196249,5.61224,0.0196476,5.93878,0.0196596,6.26531,0.0196703,6.59184,0.0196892,6.91837,0.0197254,7.2449,0.0197812,7.57143,0.0198421,7.89796,0.0199044,8.22449,0.0199653,8.55102,0.0200218,8.87755,0.020071,9.20408,0.0201117,9.53061,0.0201484,9.85714,0.0201816,10.1837,0.0202109,10.5102,0.0202363,10.8367,0.0202574,11.1633,0.0202712,11.4898,0.0202639,11.8163,0.0202416,12.1429,0.020214,12.4694,0.0201904,12.7959,0.0201805,13.1224,0.0201976,13.449,0.0202799,13.7755,0.0204116,14.102,0.0205635,14.4286,0.0207065,14.7551,0.0208114,15.0816,0.0208518,15.4082,0.020867,15.7347,0.0208795,16.0612,0.02089,16.3878,0.020899,16.7143,0.020907,17.0408,0.0209147,17.3673,0.0209227,17.6939,0.0209309,18.0204,0.020939,18.3469,0.0209467,18.6735,0.0209537,19,0.0209595)}
.func g2(vgs) {table(vgs,3,0.660764,3.32653,0.564978,3.65306,0.468012,3.97959,0.37796,4.30612,0.302917,4.63265,0.250976,4.95918,0.230233,5.28571,0.233352,5.61224,0.238618,5.93878,0.244882,6.26531,0.251285,6.59184,0.25697,6.91837,0.261078,7.2449,0.263687,7.57143,0.266518,7.89796,0.269384,8.22449,0.271999,8.55102,0.274079,8.87755,0.275339,9.20408,0.275438,9.53061,0.27412,9.85714,0.271581,10.1837,0.268053,10.5102,0.263766,10.8367,0.258948,11.1633,0.253581,11.4898,0.246489,11.8163,0.237906,12.1429,0.228325,12.4694,0.21824,12.7959,0.208144,13.1224,0.198401,13.449,0.188126,13.7755,0.177365,14.102,0.166521,14.4286,0.155993,14.7551,0.146184,15.0816,0.137459,15.4082,0.129355,15.7347,0.121656,16.0612,0.114431,16.3878,0.107751,16.7143,0.101687,17.0408,0.0963014,17.3673,0.0911824,17.6939,0.0861802,18.0204,0.0814787,18.3469,0.0772619,18.6735,0.0737137,19,0.0710181)}
.func n2(vgs) {table(vgs,3,0.376392,3.32653,0.401285,3.65306,0.432753,3.97959,0.469434,4.30612,0.509967,4.63265,0.552992,4.95918,0.597145,5.28571,0.650874,5.61224,0.722495,5.93878,0.800746,6.26531,0.874136,6.59184,0.931178,6.91837,0.960381,7.2449,0.9598,7.57143,0.948924,7.89796,0.932168,8.22449,0.913044,8.55102,0.895061,8.87755,0.881732,9.20408,0.874498,9.53061,0.867781,9.85714,0.861416,10.1837,0.855913,10.5102,0.851783,10.8367,0.849535,11.1633,0.850081,11.4898,0.85586,11.8163,0.866542,12.1429,0.881343,12.4694,0.899479,12.7959,0.920165,13.1224,0.943286,13.449,0.974369,13.7755,1.01246,14.102,1.05462,14.4286,1.09789,14.7551,1.13931,15.0816,1.17613,15.4082,1.21031,15.7347,1.24356,16.0612,1.27622,16.3878,1.30865,16.7143,1.34121,17.0408,1.37422,17.3673,1.40752,17.6939,1.44087,18.0204,1.47427,18.3469,1.50772,18.6735,1.54123,19,1.57479)}
.func l2(vgs) {table(vgs,3,0.0170922,3.32653,0.0171249,3.65306,0.0171562,3.97959,0.0171862,4.30612,0.0172149,4.63265,0.0172425,4.95918,0.0172692,5.28571,0.0172921,5.61224,0.0173087,5.93878,0.0173224,6.26531,0.0173366,6.59184,0.0173546,6.91837,0.0173799,7.2449,0.0174219,7.57143,0.017491,7.89796,0.0175762,8.22449,0.0176659,8.55102,0.0177486,8.87755,0.0178125,9.20408,0.0178523,9.53061,0.0178852,9.85714,0.0179129,10.1837,0.0179354,10.5102,0.0179526,10.8367,0.0179643,11.1633,0.0179677,11.4898,0.01795,11.8163,0.0179176,12.1429,0.01788,12.4694,0.0178465,12.7959,0.0178266,13.1224,0.0178342,13.449,0.0179117,13.7755,0.0180428,14.102,0.0181961,14.4286,0.0183406,14.7551,0.0184451,15.0816,0.0184813,15.4082,0.0184916,15.7347,0.0185,16.0612,0.018507,16.3878,0.018513,16.7143,0.0185184,17.0408,0.0185236,17.3673,0.018529,17.6939,0.0185346,18.0204,0.0185401,18.3469,0.0185454,18.6735,0.0185502,19,0.0185543)}
.func g3(vgs) {table(vgs,3,0.503998,3.32653,0.506591,3.65306,0.508209,3.97959,0.508832,4.30612,0.508437,4.63265,0.507003,4.95918,0.504509,5.28571,0.500489,5.61224,0.49444,5.93878,0.486708,6.26531,0.477654,6.59184,0.467637,6.91837,0.457013,7.2449,0.445504,7.57143,0.43196,7.89796,0.416782,8.22449,0.400444,8.55102,0.383419,8.87755,0.36618,9.20408,0.348753,9.53061,0.330001,9.85714,0.310403,10.1837,0.290598,10.5102,0.27123,10.8367,0.252939,11.1633,0.236108,11.4898,0.219692,11.8163,0.203741,12.1429,0.188549,12.4694,0.17441,12.7959,0.161618,13.1224,0.150358,13.449,0.13973,13.7755,0.129623,14.102,0.120226,14.4286,0.11173,14.7551,0.104325,15.0816,0.0981613,15.4082,0.0925673,15.7347,0.0872677,16.0612,0.0823123,16.3878,0.077751,16.7143,0.0736338,17.0408,0.0700055,17.3673,0.0665317,17.6939,0.0630849,18.0204,0.0598018,18.3469,0.0568189,18.6735,0.054273,19,0.0523004)}
.func n3(vgs) {table(vgs,3,0.321183,3.32653,0.348164,3.65306,0.379357,3.97959,0.413917,4.30612,0.450996,4.63265,0.489749,4.95918,0.529331,5.28571,0.576179,5.61224,0.6364,5.93878,0.701392,6.26531,0.762387,6.59184,0.810614,6.91837,0.837304,7.2449,0.836479,7.57143,0.814907,7.89796,0.781011,8.22449,0.743083,8.55102,0.709414,8.87755,0.688296,9.20408,0.683211,9.53061,0.680934,9.85714,0.680406,10.1837,0.682118,10.5102,0.686561,10.8367,0.694226,11.1633,0.705453,11.4898,0.719444,11.8163,0.735559,12.1429,0.753262,12.4694,0.772019,12.7959,0.791296,13.1224,0.810665,13.449,0.830814,13.7755,0.851876,14.102,0.873713,14.4286,0.896188,14.7551,0.919166,15.0816,0.942537,15.4082,0.966708,15.7347,0.991661,16.0612,1.01713,16.3878,1.04284,16.7143,1.06853,17.0408,1.09392,17.3673,1.11916,17.6939,1.14442,18.0204,1.1697,18.3469,1.195,18.6735,1.22032,19,1.24565)}
.func l3(vgs) {table(vgs,3,0.0157417,3.32653,0.0157911,3.65306,0.0158389,3.97959,0.0158844,4.30612,0.0159269,4.63265,0.0159655,4.95918,0.0159996,5.28571,0.0160282,5.61224,0.0160519,5.93878,0.0160727,6.26531,0.0160927,6.59184,0.0161138,6.91837,0.016138,7.2449,0.0161708,7.57143,0.0162175,7.89796,0.0162703,8.22449,0.016321,8.55102,0.0163613,8.87755,0.0163829,9.20408,0.0163745,9.53061,0.0163255,9.85714,0.0162477,10.1837,0.0161549,10.5102,0.0160607,10.8367,0.0159787,11.1633,0.0159179,11.4898,0.0158598,11.8163,0.0158028,12.1429,0.0157494,12.4694,0.0157024,12.7959,0.0156643,13.1224,0.0156368,13.449,0.0156114,13.7755,0.0155874,14.102,0.0155668,14.4286,0.0155514,14.7551,0.0155434,15.0816,0.0155444,15.4082,0.0155495,15.7347,0.0155558,16.0612,0.0155627,16.3878,0.0155696,16.7143,0.0155758,17.0408,0.0155807,17.3673,0.0155852,17.6939,0.0155896,18.0204,0.015594,18.3469,0.0155981,18.6735,0.0156017,19,0.0156047)}


****************************************
G2 d1 s value {
+	if(V(d3,s)<=0,
+		if (V(gk)<=V(NET3),
+		0
+		,
+		-drain_current(V(gk),V(s,d3),V(NET3),gain(V(gk),V(Tjc)),nval(V(gk),V(Tjc)),lam(V(gk),V(Tjc)))
+		)
+		,
+		if (V(gk)<=V(NET3),
+		0
+		,
+		drain_current(V(gk),V(d3,s),V(NET3),gain(V(gk),V(Tjc)),nval(V(gk),V(Tjc)),lam(V(gk),V(Tjc)))
+		)
+			)
+			}
****************************************
.param k1=1810p
.param k2=0.475
.param ka=80
.param kb=0.5
.param kc=6

G11 g1 d11 value {
+		k1*(
+		(1+(rdlim(v(d3,g1),0.1,270,0.01))*(1+ka*(1+TANH(kb*V(d3,g1)-kc))/2))**(-k2)
+		)*ddt(v(g1,d3))
+			} Rpar=1Meg
R_CGD d11 d3 1E-4


.param Cjo = 3835p
.param Vj  = 3
.param M   = 0.615

G12 d12 s value {
+		(Cjo/(1+(rdlim(v(d3,s),0.1,270,0.01)/Vj)**M))*ddt(v(d3,s))
+			} Rpar=1Meg
R_CDS d12 d3 1E-4

****************************************


.ends E3M0021120K

****************************************

