* Copyright (c) 1998-2021 Analog Devices, Inc.  All rights reserved.
*
.SUBCKT MAX41400 G0 G1 G2 GND INM INP OUT REFIN SHDN_ VDD
X_U2 GND INM UMP MAX41400_EMI  
X_U3 GND INP UPP MAX41400_EMI  
G_E_E1         0 VDD_BUF VDD GND 1k
R_E_E1 0 VDD_BUF 1m Noiseless
C_E_E1 0 VDD_BUF 10f
R_R6         0 VDDG Rbreak 20000e6
G_E_E4         GND N242402 REFING 0 1 
R_E_E4 GND N242402 1 Noiseless
C_E_E4 GND N242402 10f
X_UP         UPP N28508 VDDG 0 VUPOUT GAIN MAX41400_OPIN PARAMS:
G_E_E5         0 N28344 R2A 0 1
R_E_E5 0 N28344 1 Noiseless
C_E_E5 0 N28344 10f
R_R3         N24276 N242402  1m TC=0,0 
R_R4         0 R2A  100e6 TC=0,0 
R_R5         0 R2B  100e6 TC=0,0 
X_U6 N05368 N05417 OUTG REFING VUMIN VUMOUT VUPIN VUPOUT MAX41400_GAIN2
R_R1         0 REFING  10e9 TC=0,0 
R_R9         0 VUMIN  1e9 TC=0,0 
X_U7         VUPIN VUMIN N03083 0 OUTG GAIN MAX41400_OPOUT PARAMS:
R_R8         0 VUPIN  1e9 TC=0,0 
G_E_E2         0 VDDI VDD GND 1
R_E_E2 0 VDDI 1 Noiseless
C_E_E2 0 VDDI 10f
G_G2         VDD GND U7_IQ 0 1
V_F2 N20903 OUT 0
F_F2 N20955 0 V_F2 1
V_F4 VDDI N03083 0
F_F4 U7_IQ 0 V_F4 -1
S_S2 U7_IQ 0 SHDN_N_OP 0 _S2
RS_S2 SHDN_N_OP 0 1G
X_U1 GND SHDN_ SHDN_N_OP VDD_BUF MAX41400_HK  
R_R2         N24535 REFING  1m TC=0,0 
V_F1 VDDI VDDG 0
F_F1 VDD GND V_F1 1
R_R7         0 OUTG  10e6 TC=0,0 
R_R10         0 VUMOUT  1e9 TC=0,0 
V_F3  N24276 REFIN 0
F_F3 N24535 0 V_F3 1
R_R11         0 VUPOUT  1e9 TC=0,0 
G_G1         VDDG 0 TABLE { V(VDDG, 0) } 
+ ( (0,0) (1.8,76n)(2.5,136n)(3.3,206n)(3.6,236n)(10,1u) )
G_E_E3         GND N20903 N20955 0 1
R_E_E3 GND N20903 1 Noiseless
C_E_E3 GND N20903 10f
X_UM         UMP N28344 VDDG 0 VUMOUT GAIN MAX41400_OPIN PARAMS:
X_U5 N05058 N05181 N05130 N05122 N05134 N05126 R2A R2B VUMOUT VUPOUT
+  MAX41400_GAIN1  
S_S1 OUTG N20955 SHDN_N_OP 0 _S1
RS_S1 SHDN_N_OP 0 1G
X_U4 G0 G1 N05058 N05181 N05130 N05122 N05134 N05126 G2 N05368 N05417 GND
+  VDD_BUF MAX41400_DECODER  
G_E_E6         0 N28508 R2B 0 1
R_E_E6 0 N28508 1 Noiseless
C_E_E6 0 N28508 10f
B1 0 GAIN I=IF((V(G2) < V(VDD)/2) & (V(G1) < V(VDD)/2) & (V(G0) < V(VDD)/2),10,IF((V(G2) < V(VDD)/2) 
+ & (V(G1) < V(VDD)/2) & (V(G0) >= V(VDD)/2),20,IF((V(G2) < V(VDD)/2) & (V(G1) >= V(VDD)/2) & (V(G0) 
+ < V(VDD)/2),40,IF((V(G2) < V(VDD)/2) & (V(G1) >= V(VDD)/2) & (V(G0) >= V(VDD)/2),80,IF((V(G2) >= 
+ V(VDD)/2) & (V(G1) < V(VDD)/2) & (V(G0) < V(VDD)/2),100,IF((V(G2) >= V(VDD)/2) & (V(G1) < V(VDD)/2) 
+ & (V(G0) >= V(VDD)/2),150,IF((V(G2) >= V(VDD)/2) & (V(G1) >= V(VDD)/2) & (V(G0) < V(VDD)/2),200,250))))))) 
R_B1 0 GAIN 1 Noiseless
C_B1 0 GAIN 1n
.MODEL Rbreak RES R=1 TCE=-7.7
.MODEL         _S1 SW Roff=1Meg Ron=1.0 VT=0.5V VH=-0.5V
.MODEL         _S2 SW Roff=1u Ron=1.0 VT=0.5V VH=-0.5V
.ENDS

.SUBCKT MAX41400_DECODER G0 G1 G1_5 G1_8 G1_10 G1_15 G1_20 G1_25 G2 G2_2 G2_10
+  GND VDD_BUF  
X_U7          NG0N NG1N NG2N G1_5 AND3
X_U4          G0N NG0N INVERTER
X_U3          N20278 0VDD5 G2N COMPARATOR
X_U9          NG0N G1N NG2N G1_20A AND3
R_R2         GND G1  {1/8/100e-9} TC=0,0 
X_U8          G0N NG1N NG2N G1_10A AND3
R_R12         GND G2  {1/8/100e-9} TC=0,0 
X_U5          G1N NG1N INVERTER
X_U18          G1_20A N18314 G1_20 OR
X_U14          G0N G1N G2N G1_25 AND3
X_U12          G0N NG1N G2N G1_15 AND3
X_U15          G1_5 G1_10A G1_20A G2_2 OR3
E_E1         0VDD5 0 VDD_BUF GND 0.5
X_U13          NG0N G1N G2N N18314 AND3
X_U16          G2_2 G2_10 INVERTER
X_U10          G0N G1N NG2N G1_8 AND3
X_U6          G2N NG2N INVERTER
X_U2          N20073 0VDD5 G1N COMPARATOR
X_U17          G1_10A N18294 G1_10 OR
X_U1          N19874 0VDD5 G0N COMPARATOR
X_U11          NG0N NG1N G2N N18294 AND3
R_R1         GND G0  {1/8/100e-9} TC=0,0 
G_E_E3         GND N20073 G1 GND 1
R_E_E3 GND N20073 1 Noiseless
C_E_E3 GND N20073 10f
G_E_E4         GND N20278 G2 GND 1
R_E_E4 GND N20278 1 Noiseless
C_E_E4 GND N20278 10f
G_E_E2         GND N19874 G0 GND 1
R_E_E2 GND N19874 1 Noiseless
C_E_E2 GND N19874 10f
I_G0 G0 0 1f 
I_G1 G1 0 1f
I_G1_5 G1_5 0 1f
I_G1_8 G1_8 0 1f
I_G1_10 G1_10 0 1f
I_G1_15 G1_15 0 1f
I_G1_20 G1_20 0 1f
I_G1_25 G1_25 0 1f
I_G2 G2 0 1f
I_G2_2 G2_2 0 1f
I_G2_10 G2_10 0 1f
I_GND GND 0 1f
I_VDD_BUF VDD_BUF 0 1f
.ENDS
 
.SUBCKT MAX41400_GAIN1 G1_5 G1_8 G1_10 G1_15 G1_20 G1_25 R2A R2B VUMOUT VUPOUT 
+
B_E_LIMIT2         0 R2X I=Uplim(Dnlim(V(R2),1,10m),1000,10m)
R_E_LIMIT2 0 R2X 1 Noiseless
C_E_LIMIT2 0 R2X 10f
R_R1_INT         0 R1  6.8K TC=0,0 
G_G6         0 R1 G1_25 0 {7.2/1000}
G_G11         0 R2 G1_20 0 {1/1000}
G_G9         0 R2 G1_10 0 {2/1000}
G_ABM3I3         R2A VUMOUT VALUE { (V(R2A)-V(VUMOUT))/(V(R1X)*1000+1e-3)    }
B_E_LIMIT1         0 R1X I=Uplim(Dnlim(V(R1),1,10m),1000,10m)
R_E_LIMIT1 0 R1X 1 Noiseless
C_E_LIMIT1 0 R1X 10f
R_R2_INT         0 R2  6.8K TC=0,0 
G_ABM3I2         R2B VUPOUT VALUE { (V(R2B)-V(VUPOUT))/(V(R1X)*1000+1e-3)    }
G_G7         0 R2 G1_5 0 {4/1000}
G_ABM3I1         R2A R2B VALUE { (V(R2A)-V(R2B))/(V(R2X)*1000+1e-3)    }
G_G10         0 R2 G1_15 0 {1/1000}
G_G1         0 R1 G1_5 0 {8/1000}
G_G12         0 R2 G1_25 0 {0.6/1000}
G_G3         0 R1 G1_10 0 {9/1000}
G_G8         0 R2 G1_8 0 {2.5/1000}
G_G5         0 R1 G1_20 0 {9.5/1000}
G_G2         0 R1 G1_8 0 {8.75/1000}
G_G4         0 R1 G1_15 0 {7/1000}
I_G1_5 G1_5 0 1f
I_G1_8 G1_8 0 1f
I_G1_10 G1_10 0 1f
I_G1_15 G1_15 0 1f
I_G1_20 G1_20 0 1f
I_G1_25 G1_25 0 1f
.ENDS
 
.SUBCKT MAX41400_HK GND SHDN_ SHDN_N_OP VDD_BUF  
R_R12         N24506 N24671  1k TC=0,0 
R_R2         N12560 SHDN_N_OP  1k TC=0,0 
X_U17          N12572 PG N24506 AND
X_U18          VDD_BUF PG COMPARATOR2 PARAMS:  TH=1.6  
X_U16          N24671 N24515 COMPARATOR2 PARAMS:  TH=0.5  
G_E_E3         0 N12560 N24515 0 5
R_E_E3	0 N12560 1 Noiseless
C_E_E3 0 N12560 10f
G_E_E2         0 N20862 SHDN_ GND 1
R_E_E2 0 N20862 1 Noiseless
C_E_E2 0 N20862 10f
R_R1         VDD_BUF 0  1k TC=0,0 
X_U15          SHDN_G 0VDD5 N12572 COMPARATOR
C_C1         0 SHDN_N_OP  1n IC=-5 TC=0,0 
R_R11         0 SHDN_G  {1/8/100e-9} TC=0,0 
G_E_E1         0 0VDD5 VDD_BUF 0 0.5
R_E_E1 0 0VDD5 1 Noiseless
C_E_E1 0 0VDD5 10f
F_F1 SHDN_ GND V_F1 1
V_F1	N20862 SHDN_G 0
C_C2         0 N24671  144n IC=-1 TC=0,0 
G_G1         N24671 N24506 TABLE { V(N24671, N24506) } 
+ ( (-100,-1u)(0,0)(1m,1)(2m,10) )
.ENDS

.SUBCKT MAX41400_GAIN2 G2_2 G2_10 OUT REFIN VUMIN VUMOUT VUPIN VUPOUT  
G_ABM3I2         VUMIN OUT VALUE { (V(VUMIN)-V(OUT))/(V(R4X)*1000+1e-3)    }
B_E_LIMIT2         0 R4X I=Uplim(Dnlim(V(R4),1,10m),1000,10m)
R_E_LIMIT2 R4X 0 1 Noiseless
C_E_LIMIT2 R4X 0 10f
G_G8         0 R4 G2_10 0 {120/1000}
G_ABM3I1         VUMOUT VUMIN VALUE { (V(VUMOUT)-V(VUMIN))/(V(R3X)*1000+1e-3)  
+   }
B_E_LIMIT1         0 R3X I=Uplim(Dnlim(V(R3),1,10m),1000,10m)
R_E_LIMIT1 R3X 0 1 Noiseless
C_E_LIMIT1 R3X 0 10f
R_R2_INT         0 R4  6.8K TC=0,0 
G_G7         0 R4 G2_2 0 {88/1000}
G_ABM3I3         VUPOUT VUPIN VALUE { (V(VUPOUT)-V(VUPIN))/(V(R3X)*1000+1e-3)  
+   }
R_R1_INT         0 R3  6.8K TC=0,0 
G_G1         0 R3 G2_2 0 {44/1000}
G_G2         0 R3 G2_10 0 {12/1000}
G_ABM3I4         VUPIN REFIN VALUE { (V(VUPIN)-V(REFIN))/(V(R4X)*1000+1e-3)   
+  }
I_G2_2 G2_2 0 1f
I_G2_10 G2_10 0 1f
.ENDS
 
.SUBCKT MAX41400_EMI GND IN OUT  
R_R2         IN N20710  1G TC=0,0 
G_E_E2         GND E2OUT N20710 GND 1
R_E2 E2OUT GND 1 Noiseless
C_C2         GND N20710  5p  TC=0,0 
R_G_G1         IN N20710 2000
V_F1 E2OUT OUT 0 
F_F1 N20710 GND V_F1 1
.ENDS

.subckt MAX41400_OPIN 1 2 3 4 5 GAIN
* CM / DM Input Parameters 
C2  1 4 1.00P
C3  2 4 1.00P
R19  1 4 200G
R20  2 4 200G
R21  1 2 400G
* Differential Stage 
GIVR 0 IVR 14 0 1m
RIVR 0 IVR 1k Noiseless
CIVR IVR 0 1.59f
BCMPI 0 CMpi I=1m*(V(3)+{Vcm_max})
RCMPI CMpi 0 1k Noiseless
CCMPI CMpi 0 1n
BCMNI 0 CMni I=1m*(V(4)+{Vcm_min})
RCMNI CMni 0 1k Noiseless
CCMNI CMni 0 1n
GCMP 0 CMp CMpi 0 1k
RCMP 0 CMp 1m Noiseless
GCMN 0 CMn CMni 0 1k
RCMN 0 CMn 1m Noiseless
DIP CMp IVR DI
DIN IVR CMn DI
CIN IVR CMn 1f
CIP IVR CMp 1f
* Noise Stage 
I2 21 20 1.00
D1 20  0 DN1
D2  0 21 DN1
I3 22 23 1N
R10 22 0  1k
R11  0 23 1k
B_E1 71 14 I=V(20) * 174U + V(21) * 174U + V(22) * 174U + V(23) * 174U
R_E1 71 14 1 Noiseless
I8 0 70 DC 1
R22 0 70 1 TC=5.00N
B_E5 1 71 I=V(70)-1
R_E5 1 71 1 Noiseless
EG1 VIBIASP 0 62 0 1u
GB1 1 0 VIBIASP 0 1
EG2 VIBIASM 0 622 0 1u
GB2 2 0 VIBIASM 0 1
I6 0 62 DC 1uA
VA100 62A 62 DC 0
R17 0 62A 64.0 TC=3.71M,-3.73U
I622 0 622 DC 1uA
VA101 622A 622 DC 0
R17A 0 622A 100 TC=0.00,0.00
R16 0 61 1 TC=867U,-1.90U
G61 3 4 61 0 1
G60 0 61 TABLE { V(3, 4) } ((0, 0)(500M,1.5E-21)(1.6,1.2N)(1.7,1.3N)(1.8,1.4N)(2.7,1.5N)(3.6,1.6N))
* PSRR / CMRR 
G30 0 110 3 0 10.0E-24
R30 110 0 1G 
GR30 110 0 110 0 1m 
C30 110 0 106M
G31 0 111 110 0 1 
L31 111 112 159P
GRL31 111 112 111 112 9.99
R32 112 0 1G 
GR32 112 0 112 0 1 
G33 0 114 111 0 1 
R34 114 0 1G 
C34 114 0 159P
GR34 114 0 114 0 1 
G35 0 115 114 0 1 
L35 115 116 159P
GRL35 115 116 115 116 9.99
R36 116 0 1G 
GR36 116 0 116 0 1 
G37 0 117 115 0 1 
R37 117 0 1G 
C37 117 0 159P
GR37 117 0 117 0 1 
G38 0 118 117 0 1 
L38 118 119 159P
GRL38 118 119 118 119 9.99
R39 119 0 1G 
GR39 119 0 119 0 1 
G40 0 120 4 0 10.0E-24
R40 120 0 1G 
GR40 120 0 120 0 1m 
C40 120 0 106M
G41 0 121 120 0 1 
L41 121 122 159P
GRL41 121 122 121 122 9.99
R42 122 0 1G 
GR42 122 0 122 0 1 
G43 0 124 121 0 1 
R44 124 0 1G 
C44 124 0 159P
GR44 124 0 124 0 1 
G45 0 125 124 0 1 
L45 125 126 159P
GRL45 125 126 125 126 9.99
R46 126 0 1G 
GR46 126 0 126 0 1 
G147 0 127 125 0 1 
R47 127 0 1G 
C47 127 0 159P
GR47 127 0 127 0 1 
G48 0 128 127 0 1 
L48 128 129 159P
GRL48 128 129 128 129 9.99
R49 129 0 1G 
GR49 129 0 129 0 1 
G50 0 130 VALUE { ( V(1)+V(2))/2 * 10.0E-24}
R50 130 0 1G 
GR50 130 0 130 0 1m 
C50 130 0 106M
G51 0 131 130 0 1 
L51 131 132 159P
GRL51 131 132 131 132 9.99
R51 132 0 1G 
GR51 132 0 132 0 1 
G53 0 133 131 0 1 
R53 133 0 1G 
C53 133 0  159P
GR53 133 0 133 0 1 
G55 0 134 133 0 1 
L55 134 135 159P
GRL55 134 135 134 135 9.99
R55 135 0 1G 
GR55 135 0 135 0 1 
G57 0 137 134 0 1 
R57 137 0 1G 
C57 137 0  159P
GR57 137 0 137 0 1 
*
* OP Amp Output Gain / Response 
G3A  0 30A IVR 2 1 
RG3A 30A 0 1 
G3  0 30 30A 0 1 
R3 30  0 1.00K
G6  0 33 30 0 1m
R6  33 0 1K
I_GAIN GAIN 0 1f
B_ADJ 0 Adj I=1m*table(V(Gain), 10, 1.11, 40, 278m, 100, 1.39, 200, 1.52)
R_ADJ Adj 0 1k Noiseless
R7  34 0 R=1k*V(Adj)
C7  34 0 {Cfp1}
BSR 0 34 I=Uplim(Dnlim(V(33)*113*(1/V(Adj)), {Isink},1m),{Isrc},1m)
C_30 30 0 1f
C_33 33 0 1f
G8  0 37 34 0 1m
R8  37 0 1K
C8  37 0 265P
G9  0 38 37 0 1m
R9  39 0 1K
L9  38 39 159N
GRL9  38 39 38 39 10.0M
B_E9 0 35 I={1/Zo_dc}*V(38)+V(118)+V(128)+V(137)
R_E9 0 35 {Zo_dc} Noiseless
* Output Impedance / Saturation / Current Limit 
B1 0 N001 I=Uplim(Dnlim({G1_Zo}* V(35,57), {Izon}, 25m), {Izop}, 25m)
R_B1 N001 0 1 Noiseless
RX 57 N001 {Rx_Zo} Noiseless
RDUMMY 57 0 {Rdummy_Zo} Noiseless
R23 50 0 100MEG
VR15 57 96 0
R15X 57 96 1G
F1 0 50 VR15 1
C_CGD8 55 57 .1P 
C_CGD9 56 57 .1P 
E3 55  0 VALUE { 0.00 + V(3) * 1 + V(51) * -111M }
E4 56  0 VALUE { 0.00 + V(4) * 1 + V(52) * -111M }
R12 51 0 1k
R13 52 0 1k
GD12 50 51 VALUE={( IF( (V(50,51))>0,V(50,51)/0.002,V(50,51)/1E9 ) ) }
GD13 50 52 VALUE={( IF( (V(50,52))>0,V(50,52)/1E9,V(50,52)/0.002 ) ) }
G21  3  0 VALUE { 0 + V(51) * 1M }
G22  0  4 VALUE { 0 + V(52) * -1M }
R_96_5 96 5 1m
S_D4 3 5 5 3 ESDO
S_D3 5 4 4 5 ESDO
DOP Vsatp 57 DO
COP 57 Vsatp 1f
DON 57 Vsatn DO
CON 57 Vsatn 1f
GSATP 0 Vsatp 55 0 1k
RSATP Vsatp 0 1m
GSATN 0 Vsatn 56 0 1k
RSATN Vsatn 0 1m
CSATP Vsatp 0 1n
CSATN Vsatn 0 1n
DGP N007 34 DG
DGN 34 N008 DG
GRP 0 N007 GRpi 0 1k
GRN 0 N008 GRni 0 1k
RRP N007 0 1m Noiseless
RRN N008 0 1m Noiseless
RGRP GRpi 0 1k Noiseless
RGRN GRni 0 1k Noiseless
CGRN GRni 0 10p
CGRP GRpi 0 10p
CGP 34 N007 1f
CGN 34 N008 1f
BGRP 0 GRpi I=1m*({Zo_max}* {Iscp}+V(3))
BGRN 0 GRni I=1m*({Zo_max}* {Iscn}+V(4))
* Models
.MODEL ESDO SW (Ron=50 Roff=1G Vt=0.5 Vh=-0.1 Vser=0.6 Ilimit=4m Lser=1n Noiseless)
.MODEL DN1 D   IS=1P KF=10.0P AF=1
.MODEL DIDL2 D()
.MODEL DO D(Vfwd=1k Vrev=0 Revepsilon=0.1 Ron=1m Noiseless)
.MODEL DG D(Vfwd=10k Vrev=0 Revepsilon=0.5 Noiseless Ron=1m)
.MODEL DI D(Vfwd=1k Vrev=0 Revepsilon=0.1 Noiseless)
.param Vcm_min=0.1 Vcm_max=-0.1
.param Zo_dc=1k
.param Cfp1=100m
.param SRp=1 SRn=-1
.param Isrc = {Cfp1 * SRp * 1Meg} Isink = {Cfp1 * SRn * 1Meg}
.param beta_Zo=1.13
.param Rx_Zo = {100 * Zo_max}
.param Rdummy_Zo = {10 * Zo_max}
.param G1_Zo={Rx_Zo/(Zo_dc*beta_Zo)}
.param Zo_max={Zo_dc}
.param Iscp=10m Iscn=-10m
.param IZop={Rx_Zo*Iscp} IZon={Rx_Zo*Iscn}
*
.ends MAX41400_OPIN

.subckt MAX41400_OPOUT 1 2 3 4 5 GAIN
* CM / DM Input Parameters 
C2  1 4 1.00P
C3  2 4 1.00P
R19  1 4 100E12
R20  2 4 100E12
R21  1 2 100E12
* Differential Stage 
GIVR 0 IVR 14 0 1m
RIVR 0 IVR 1k Noiseless
CIVR IVR 0 1.59f
BCMPI 0 CMpi I=1m*(V(3)+{Vcm_max})
RCMPI CMpi 0 1k Noiseless
CCMPI CMpi 0 1n
BCMNI 0 CMni I=1m*(V(4)+{Vcm_min})
RCMNI CMni 0 1k Noiseless
CCMNI CMni 0 1n
GCMP 0 CMp CMpi 0 1k
RCMP 0 CMp 1m Noiseless
GCMN 0 CMn CMni 0 1k
RCMN 0 CMn 1m Noiseless
DIP CMp IVR DI
DIN IVR CMn DI
CIN IVR CMn 1f
CIP IVR CMp 1f
* Noise Stage 
I2 21 20 10.0
D1 20  0 DN1
D2  0 21 DN1
I3 22 23 1n ;1n
R10 22 0  52k ;1k
R11  0 23 52k ;1k
I_GAIN GAIN 0 1f
B_MULT 0 Mult I=1m*table(V(GAIN), 10, 4, 40, 13.23, 100, 9.03, 200, 16.75)
R_MULT Mult 0 1k Noiseless
B_E1 71 14 I=V(20) * 4.00 + V(21) * 4.00 + V(22) * V(Mult) + V(23) * V(Mult)
R_E1 71 14 1 Noiseless
I8 0 70 DC 1
R22 0 70 1 TC=5.00N
B_E5 1 71 I=V(70)-1
R_E5 1 71 1 Noiseless
EG1 VIBIASP 0 62 0 1u
GB1 1 0 VIBIASP 0 1
EG2 VIBIASM 0 622 0 1u
GB2 2 0 VIBIASM 0 1
I6 0 62 DC 1uA
VA200 62A 62 DC 0.00
R17 0 62A REXP  1
I622 0 622 DC 1uA
VA201 622A 622 DC 0.00
R17A 0 622A REXPM  1
R16 0 61 1 TC=2.23M,-3.02U
G61 3 4 61 0 1
G60 0 61 TABLE { V(3, 4) } ((0, 0)(500M,68.1E-18)(1.6,74.0U)(1.7,65.0U)(2.3,66.2U)(3.2,68.1U)(3.6,69.0U))
* PSRR
G40 0 120 4 0 562N
R40 120 0 1G 
GR40 120 0 120 0 1m 
C40 120 0 530U
G41 0 121 120 0 1 
L41 121 122 1.59M
GRL41 121 122 121 122 999N
R42 122 0 1G 
GR42 122 0 122 0 1 
G43 0 124 121 0 1 
R44 124 0 1G 
C44 124 0 159P
GR44 124 0 124 0 1 
G45 0 125 124 0 1 
L45 125 126 31.8U
GRL45 125 126 125 126 49.9U
R46 126 0 1G 
GR46 126 0 126 0 1 
G147 0 127 125 0 1 
R47 127 0 1G 
C47 127 0 159P
GR47 127 0 127 0 1 
G48 0 128 127 0 1 
L48 128 129 31.8U
GRL48 128 129 128 129 49.9U
R49 129 0 1G 
GR49 129 0 129 0 1 
*
* OP Amp Output Gain / Response 
G3A  0 30A 14 2 1 
RG3A 30A 0 1 
G3  0 30 30A 0 1 
R3 30  0 1.00K
G6  0 33 30 0 1m
R6  33 0 1K
R7  34 0 1K
C7  34 0 {Cfp1}
BSR 0 34 I=Uplim(Dnlim(V(33)*1.13, {Isink},1m),{Isrc},1m)
C_30 30 0 1f
C_33 33 0 1f
G8  0 37 34 0 1m
R8  37 0 1K
C8  37 0 159E-15
G9  0 38 37 0 1m
R9  39 0 1K
L9  38 39 159N
GRL9  38 39 38 39 10.0M
B_E9 0 35 I={1/Zo_dc}*V(38)+V(128)
R_E9 0 35 {Zo_dc} Noiseless
* Output Impedance / Saturation / Current Limit 
B1 0 N001 I=Uplim(Dnlim({G1_Zo}* V(35,57), {Izon}, 25m), {Izop}, 25m)
R_B1 N001 0 1 Noiseless
RX 57 N001 {Rx_Zo} Noiseless
RDUMMY 57 0 {Rdummy_Zo} Noiseless
R23 50 0 100MEG
VR15 57 96 0
R15X 57 96 1G
F1 0 50 VR15 1
C_CGD8 55 57 .1P 
C_CGD9 56 57 .1P 
E3 55  0 VALUE { 0.00 + V(3) * 1 + V(51) * -318M }
E4 56  0 VALUE { 0.00 + V(4) * 1 + V(52) * -144M }
R12 51 0 1k
R13 52 0 1k
GD12 50 51 VALUE={( IF( (V(50,51))>0,V(50,51)/0.002,V(50,51)/1E9 ) ) }
GD13 50 52 VALUE={( IF( (V(50,52))>0,V(50,52)/1E9,V(50,52)/0.002 ) ) }
G21  3  0 VALUE { 0 + V(51) * 1M }
G22  0  4 VALUE { 0 + V(52) * -1M }
R_96_5 96 5 1m
DOP Vsatp 57 DO
COP 57 Vsatp 1f
DON 57 Vsatn DO
CON 57 Vsatn 1f
GSATP 0 Vsatp 55 0 1k
RSATP Vsatp 0 1m
GSATN 0 Vsatn 56 0 1k
RSATN Vsatn 0 1m
CSATP Vsatp 0 1n
CSATN Vsatn 0 1n
S_D4 3 5 5 3 ESDO
S_D3 5 4 4 5 ESDO
DGP N007 34 DG
DGN 34 N008 DG
GRP 0 N007 GRpi 0 1k
GRN 0 N008 GRni 0 1k
RRP N007 0 1m Noiseless
RRN N008 0 1m Noiseless
RGRP GRpi 0 1k Noiseless
RGRN GRni 0 1k Noiseless
CGRN GRni 0 10p
CGRP GRpi 0 10p
CGP 34 N007 1f
CGN 34 N008 1f
BGRP 0 GRpi I=1m*({Zo_max}* {Iscp}+V(3))
BGRN 0 GRni I=1m*({Zo_max}* {Iscn}+V(4))
* Models
.MODEL ESDO SW (Ron=50 Roff=1G Vt=0.5 Vh=-0.1 Vser=0.6 Ilimit=4m Lser=1n Noiseless)
.MODEL DN1 D   IS=1P KF=20.0E-15 AF=1
.MODEL REXP  RES TCE=0.00
.MODEL REXPM  RES TCE=0.00
.MODEL DIDL2 D()
.MODEL DO D(Vfwd=1k Vrev=0 Revepsilon=0.1 Ron=1m Noiseless)
.MODEL DG D(Vfwd=10k Vrev=0 Revepsilon=0.5 Noiseless Ron=1m)
.MODEL DI D(Vfwd=1k Vrev=0 Revepsilon=0.1 Noiseless)
.param Vcm_min=0 Vcm_max=0
.param Zo_dc=1k
.param Cfp1=530u
.param SRp=99.2m SRn=-99.2m
.param Isrc = {Cfp1 * SRp * 1Meg} Isink = {Cfp1 * SRn * 1Meg}
.param beta_Zo=1.13
.param Rx_Zo = {100 * Zo_max}
.param Rdummy_Zo = {10 * Zo_max}
.param G1_Zo={Rx_Zo/(Zo_dc*beta_Zo)}
.param Zo_max={Zo_dc}
.param Iscp=2m Iscn=-2m
.param IZop={Rx_Zo*Iscp} IZon={Rx_Zo*Iscn}
*
.ENDS MAX41400_OPOUT

.SUBCKT AND A B OUT  
B_EOUT 0 OUT I=IF(V(A)>0.5 & V(B)>0.5,1,1n)
R_EOUT OUT 0 1 Noiseless
C_EOUT OUT 0 10f
I_A A 0 1f
I_B B 0 1f
I_OUT OUT 0 1f
.ends AND

.SUBCKT AND3 A B C OUT  
B_EOUT 0 OUT I=IF(V(A)>0.5 & V(B)>0.5 & V(C)>0.5,1,1n)
R_EOUT OUT 0 1 Noiseless
C_EOUT OUT 0 10f
I_A A 0 1f
I_B B 0 1f
I_C C 0 1f
I_OUT OUT 0 1f
.ends AND3

.SUBCKT INVERTER IN OUT  
B_EOUT 0 OUT I=IF(V(IN)<0.5,1,1n)
R_EOUT OUT 0 1 Noiseless
C_EOUT OUT 0 10f
I_IN IN 0 1f
I_OUT OUT 0 1f
.ends INVERTER

.SUBCKT OR A B OUT  
B_EOUT 0 OUT I=IF(V(A)>0.5 | V(B)>0.5,1,1n)
R_EOUT OUT 0 1 Noiseless
C_EOUT OUT 0 10f
I_A A 0 1f
I_B B 0 1f
I_OUT OUT 0 1f
.ends OR

.SUBCKT OR3 A B C OUT  
B_EOUT 0 OUT I=IF(V(A)>0.5 | V(B)>0.5 | V(C)>0.5,1,1n)
R_EOUT OUT 0 1 Noiseless
C_EOUT OUT 0 10f
I_A A 0 1f
I_B B 0 1f
I_C C 0 1f
I_OUT OUT 0 1f
.ends OR3

.SUBCKT COMPARATOR INP INM OUT  
B_EOUT 0 OUT I=IF(V(INP)>V(INM),1,1n)
R_EOUT OUT 0 1 Noiseless
C_EOUT OUT 0 10f
I_INP INP 0 1F
I_INM INM 0 1f
I_OUT OUT 0 1f
.ends COMPARATOR

.SUBCKT COMPARATOR2 INP OUT  
+ PARAMs:  TH=1
B_EOUT 0 OUT I=IF(V(INP)>TH,1,1n)
R_EOUT OUT 0 1 Noiseless
C_EOUT OUT 0 10f
I_INP INP 0 1f
I_OUT OUT 0 1f
.ends COMPARATOR2