Version 4
SHEET 1 1072 912
WIRE -1632 -1488 -2000 -1488
WIRE -1408 -1488 -1488 -1488
WIRE -1232 -1488 -1312 -1488
WIRE -1120 -1488 -1152 -1488
WIRE -992 -1488 -992 -1520
WIRE -992 -1488 -1040 -1488
WIRE -928 -1488 -992 -1488
WIRE -752 -1488 -928 -1488
WIRE -608 -1488 -752 -1488
WIRE -928 -1456 -928 -1488
WIRE -2000 -1440 -2000 -1488
WIRE -752 -1440 -752 -1488
WIRE -1408 -1408 -1440 -1408
WIRE -1280 -1408 -1312 -1408
WIRE -992 -1360 -992 -1424
WIRE -928 -1344 -928 -1376
WIRE -928 -1344 -960 -1344
WIRE -928 -1312 -928 -1344
WIRE -608 -1264 -608 -1296
WIRE -2000 -1200 -2000 -1360
WIRE -1552 -1200 -1552 -1440
WIRE -1552 -1200 -2000 -1200
WIRE -1440 -1200 -1440 -1408
WIRE -1440 -1200 -1552 -1200
WIRE -1280 -1200 -1280 -1408
WIRE -1280 -1200 -1440 -1200
WIRE -992 -1200 -992 -1280
WIRE -992 -1200 -1280 -1200
WIRE -928 -1200 -928 -1232
WIRE -928 -1200 -992 -1200
WIRE -752 -1200 -752 -1360
WIRE -752 -1200 -928 -1200
WIRE -2000 -1168 -2000 -1200
WIRE -960 -1168 -960 -1344
WIRE -784 -1168 -960 -1168
WIRE -1616 -1136 -1616 -1440
WIRE -928 -1120 -976 -1120
WIRE -784 -1120 -784 -1168
WIRE -784 -1120 -864 -1120
WIRE -608 -1120 -784 -1120
WIRE -976 -1040 -976 -1120
WIRE -880 -1040 -896 -1040
WIRE -784 -1040 -784 -1120
WIRE -784 -1040 -816 -1040
WIRE -784 -960 -784 -1040
WIRE -784 -960 -864 -960
WIRE -976 -944 -976 -1040
WIRE -976 -944 -1088 -944
WIRE -928 -944 -976 -944
WIRE -784 -928 -864 -928
WIRE -976 -896 -976 -944
WIRE -592 -896 -592 -944
WIRE -448 -896 -448 -960
WIRE -288 -896 -288 -944
WIRE -144 -896 -144 -944
WIRE 0 -896 0 -944
WIRE -784 -880 -784 -928
WIRE -1616 -832 -1616 -1008
WIRE -1424 -832 -1616 -832
WIRE -1264 -832 -1344 -832
WIRE -1088 -832 -1088 -944
WIRE -1088 -832 -1184 -832
WIRE -784 -784 -784 -800
WIRE -1616 -768 -1616 -832
WIRE -592 -752 -592 -816
WIRE -448 -752 -448 -816
WIRE -448 -752 -592 -752
WIRE -288 -752 -288 -816
WIRE -288 -752 -448 -752
WIRE -144 -752 -144 -816
WIRE -144 -752 -288 -752
WIRE 0 -752 0 -816
WIRE 0 -752 -144 -752
WIRE -1616 -656 -1616 -704
FLAG -2000 -1168 0
FLAG -608 -1488 Vout2
IOPIN -608 -1488 Out
FLAG -784 -784 0
FLAG -976 -896 Verr
IOPIN -976 -896 Out
FLAG -608 -1296 vout
FLAG -992 -1520 vout
FLAG -1616 -576 0
FLAG -288 -752 0
SYMBOL PWMVM -1584 -1456 R0
SYMATTR InstName X1
SYMATTR SpiceLine L=57u Fs=100k
SYMBOL voltage -2000 -1456 R0
WINDOW 123 34 109 Left 0
WINDOW 39 0 0 Left 0
WINDOW 0 38 50 Left 0
WINDOW 3 38 78 Left 0
SYMATTR InstName V1
SYMATTR Value 380
SYMBOL res -1008 -1376 R0
WINDOW 0 -39 44 Left 0
WINDOW 3 -44 74 Left 0
SYMATTR InstName Resr
SYMATTR Value 70m
SYMBOL cap -1008 -1488 R0
WINDOW 0 -47 32 Left 0
WINDOW 3 -45 64 Left 0
SYMATTR InstName C4
SYMATTR Value 880µ
SYMBOL res -944 -1328 R0
SYMATTR InstName Rlower
SYMATTR Value 10.345k
SYMBOL ind -1248 -1472 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 5 56 VBottom 0
SYMATTR InstName L2
SYMATTR Value 57µ
SYMATTR SpiceLine Rser=50M
SYMBOL res -944 -1472 R0
SYMATTR InstName Rupper
SYMATTR Value 47.635k
SYMBOL res -1136 -1472 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 0 56 VBottom 0
SYMATTR InstName R6
SYMATTR Value 80m
SYMBOL res -768 -1456 R0
SYMATTR InstName Rload
SYMATTR Value 2.8
SYMBOL voltage -784 -896 R0
WINDOW 0 43 35 Left 0
WINDOW 3 43 66 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vref1
SYMATTR Value 2.5
SYMBOL ampsimp -896 -944 M0
WINDOW 38 0 0 Left 0
WINDOW 3 -59 55 Left 0
WINDOW 39 -245 203 Left 0
SYMATTR SpiceModel ""
SYMATTR Value AMPSIMP
SYMATTR SpiceLine POLE=30 GAIN=30000 VHIGH=1.6 VLOW=100mV
SYMATTR InstName U2
SYMBOL cap -864 -1136 R90
WINDOW 0 0 32 VBottom 0
WINDOW 3 32 32 VTop 0
SYMATTR InstName C2
SYMATTR Value {C2}
SYMBOL res -880 -1056 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R2
SYMATTR Value {R2}
SYMBOL cap -880 -1024 R270
WINDOW 0 32 32 VTop 0
WINDOW 3 0 32 VBottom 0
SYMATTR InstName C1
SYMATTR Value {C1}
SYMBOL cap -624 -1184 R0
WINDOW 0 44 23 Left 0
WINDOW 3 46 49 Left 0
SYMATTR InstName C3
SYMATTR Value {C3}
SYMBOL res -624 -1280 R0
SYMATTR InstName R3
SYMATTR Value {R3}
SYMBOL ind -1440 -816 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 5 56 VBottom 0
SYMATTR InstName L1
SYMATTR Value 1pH
SYMATTR SpiceLine Rser=100M
SYMBOL cap -1632 -768 R0
SYMATTR InstName C5
SYMATTR Value 1pF
SYMATTR SpiceLine Rser=100M
SYMBOL voltage -1616 -672 R0
WINDOW 123 34 109 Left 0
WINDOW 39 0 0 Left 0
WINDOW 0 38 50 Left 0
WINDOW 3 38 78 Left 0
SYMATTR Value2 AC 1 0
SYMATTR InstName V2
SYMATTR Value ""
SYMBOL res -1168 -848 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R1
SYMATTR Value 100m
SYMBOL voltage -448 -912 R0
WINDOW 0 43 35 Left 0
WINDOW 3 43 66 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vref2
SYMATTR Value {R3}
SYMBOL voltage -288 -912 R0
WINDOW 0 43 35 Left 0
WINDOW 3 -46 200 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vref3
SYMATTR Value {C2*1000000000}
SYMBOL voltage -144 -912 R0
WINDOW 0 43 35 Left 0
WINDOW 3 38 192 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vref4
SYMATTR Value {C1*1000000000}
SYMBOL voltage 0 -912 R0
WINDOW 0 43 35 Left 0
WINDOW 3 43 66 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vref5
SYMATTR Value {C3*1000000000}
SYMBOL voltage -592 -912 R0
WINDOW 0 43 35 Left 0
WINDOW 3 43 66 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vref6
SYMATTR Value {R2}
SYMBOL XFMR1 -1360 -1456 R0
SYMATTR InstName U1
SYMATTR SpiceLine RATIO=.118
SYMBOL gain -1616 -1072 R270
SYMATTR SpiceLine Gain = .5
SYMATTR InstName U3
TEXT -1368 -1104 Left 0 !;ac dec 20 10 1000000
TEXT -1368 -1136 Left 0 !.tran 0 20m 1u
TEXT -1368 -1072 Left 0 !.include limit.sub\n.include limit2.sub\n \n.include pwmvm.sub
TEXT -1520 -1416 Left 0 ;Fs=100k\nL=75u
TEXT -1056 -1992 Left 0 !.param Rupper = 25.5k\n+ fc = 10k\n+ pm = 70\n+ Gfc = -5.2\n+ ps = -100\n+ G = 10**(-Gfc/20)\n+ Boost = pm-(ps)-90\n+ pi = 3.14159\n+ K = (tan((boost/4+45)*pi/180))**2\n+ C2 = 1/(2*pi*fc*G* Rupper)\n+ C1 = C2*(k-1)\n+ R2 = sqrt(k)/(2*pi*fc*C1)\n+ R3 = Rupper/(K-1)\n+ C3 = 1/(2*pi*fc*sqrt(k)*R3)
TEXT 248 -1936 Left 0 !.SUBCKT GAIN 1 2 \n           * IN OUT\nE1 2 0 1 0 = {GAIN}\n \n.ENDS
TEXT 176 -2216 Left 0 !**** SINGLE WINDING TRANSFORMER ****\n.SUBCKT XFMR1 1 2 3 4 PARAMS: RATIO=1\nRP 1 2 1MEG\nE 5 4 VALUE = { V(1,2)*RATIO }\nG 1 2 VALUE = { I(VM)*RATIO }\nRS 6 3 1U\nVM 5 6 \n.ENDS XFMR1\n*
TEXT -656 -2280 Left 0 !.SUBCKT AMPSIMP 1 5 7  params: POLE=30 GAIN=30000 VHIGH=4V VLOW=100mV\n*               + - OUT\nG1 0 4 1 5 100u\nR1 4 0 {GAIN/100u}\nC1 4 0 {1/(6.28*(GAIN/100u)*POLE)}\nE1 2 0 4 0 1\nRo 2 7 10\nVlow 3 0 DC={VLOW}\nVhigh 8 0 DC={VHIGH}  \nDlow 3 4 DCLP\nDhigh 4 8 DCLP\n.MODEL DCLP D N=0.01\n.ENDS\n*
