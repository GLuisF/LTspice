Version 4
SHEET 1 1468 1304
WIRE -336 368 -336 176
WIRE -336 480 -336 448
WIRE -304 672 -336 672
WIRE -304 752 -336 752
WIRE -288 176 -336 176
WIRE -272 256 -272 224
WIRE -224 256 -224 224
WIRE -192 672 -224 672
WIRE -192 752 -224 752
WIRE -192 752 -192 672
WIRE -192 960 -192 784
WIRE -192 992 -192 960
WIRE -160 672 -192 672
WIRE -160 752 -192 752
WIRE -160 784 -192 784
WIRE -144 176 -208 176
WIRE -144 384 -144 176
WIRE -144 480 -336 480
WIRE -144 480 -144 448
WIRE -112 480 -144 480
WIRE -112 480 -112 416
WIRE -80 176 -144 176
WIRE -80 416 -112 416
WIRE -80 480 -112 480
WIRE -48 672 -80 672
WIRE -48 768 -96 768
WIRE -48 768 -48 672
WIRE -16 672 -48 672
WIRE 16 816 -16 816
WIRE 16 848 16 816
WIRE 16 960 -192 960
WIRE 16 960 16 928
WIRE 48 768 -48 768
WIRE 48 816 16 816
WIRE 96 176 0 176
WIRE 96 208 96 176
WIRE 96 368 96 272
WIRE 96 480 0 480
WIRE 96 480 96 448
WIRE 96 720 96 672
WIRE 96 752 96 720
WIRE 96 960 16 960
WIRE 96 960 96 832
WIRE 128 720 96 720
WIRE 176 176 96 176
WIRE 176 368 176 176
WIRE 176 480 96 480
WIRE 176 480 176 448
WIRE 224 176 176 176
WIRE 224 672 96 672
WIRE 224 832 224 672
WIRE 224 960 96 960
WIRE 224 960 224 912
WIRE 272 960 224 960
WIRE 272 960 272 896
WIRE 304 848 272 848
WIRE 304 848 304 768
WIRE 336 672 224 672
WIRE 336 768 304 768
WIRE 336 848 304 848
WIRE 448 848 416 848
WIRE 464 176 432 176
WIRE 464 256 464 176
WIRE 464 368 464 336
WIRE 464 480 176 480
WIRE 464 480 464 448
WIRE 496 176 464 176
WIRE 576 672 416 672
WIRE 576 768 416 768
WIRE 576 768 576 672
WIRE 576 848 576 768
WIRE 576 960 272 960
WIRE 576 960 576 928
WIRE 592 176 560 176
WIRE 592 256 464 256
WIRE 592 336 464 336
WIRE 704 176 672 176
WIRE 704 256 672 256
WIRE 704 256 704 176
WIRE 704 336 672 336
WIRE 704 336 704 256
WIRE 704 480 464 480
WIRE 704 480 704 368
WIRE 704 512 704 480
WIRE 704 720 672 720
WIRE 704 848 704 720
WIRE 704 960 576 960
WIRE 704 960 704 928
WIRE 736 176 704 176
WIRE 736 256 704 256
WIRE 736 336 704 336
WIRE 736 368 704 368
WIRE 768 672 576 672
WIRE 768 720 704 720
WIRE 768 960 704 960
WIRE 768 960 768 768
WIRE 832 176 816 176
WIRE 832 256 800 256
WIRE 848 832 848 768
WIRE 880 832 848 832
WIRE 928 176 896 176
WIRE 928 256 896 256
WIRE 928 256 928 176
WIRE 928 352 800 352
WIRE 928 352 928 256
WIRE 944 960 768 960
WIRE 944 960 944 848
WIRE 960 176 928 176
WIRE 976 672 928 672
WIRE 976 832 944 832
FLAG -272 256 MDRV
IOPIN -272 256 In
FLAG 432 176 VOUT
IOPIN 432 176 In
FLAG -16 816 VTRI
IOPIN -16 816 Out
FLAG 976 832 PWM
IOPIN 976 832 In
FLAG 960 176 VVEA
IOPIN 960 176 Out
FLAG 224 176 VOUT
IOPIN 224 176 Out
FLAG 704 512 0
FLAG -80 416 ISNS
IOPIN -80 416 Out
FLAG 448 848 ISNS
IOPIN 448 848 In
FLAG 976 672 MDRV
IOPIN 976 672 Out
FLAG 672 720 CLK
IOPIN 672 720 Out
FLAG -224 256 0
FLAG -192 992 0
FLAG -336 752 VVEA
IOPIN -336 752 In
FLAG -336 672 ISNS
IOPIN -336 672 In
FLAG -16 672 VCEA
IOPIN -16 672 Out
FLAG 128 720 PWM
IOPIN 128 720 Out
FLAG 848 624 0
SYMBOL diode -128 448 R180
WINDOW 0 53 54 Left 0
WINDOW 3 43 33 Left 0
SYMATTR InstName D1
SYMATTR Value DID
SYMBOL sw -192 176 M270
WINDOW 0 77 87 VLeft 0
WINDOW 3 52 86 VLeft 0
SYMATTR InstName SW1
SYMATTR Value MSW
SYMBOL voltage -336 352 R0
WINDOW 0 39 43 Left 0
WINDOW 3 38 64 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName VIN
SYMATTR Value 100V
SYMBOL Opamps\\opamp 768 288 R0
SYMATTR InstName VEA
SYMATTR SpiceLine2 GBW=5Meg
SYMBOL res 832 160 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R3
SYMATTR Value 240K
SYMBOL cap 896 160 R90
WINDOW 0 0 32 VBottom 0
WINDOW 3 32 32 VTop 0
SYMATTR InstName C1
SYMATTR Value 39p
SYMBOL res 688 240 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R1
SYMATTR Value 100K
SYMBOL res 688 320 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R2
SYMATTR Value 10K
SYMBOL voltage 464 464 R180
WINDOW 0 -108 63 Left 0
WINDOW 3 -85 39 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName VDEM
SYMATTR Value 5V
SYMBOL sw 96 848 M180
WINDOW 0 39 67 Left 0
WINDOW 3 38 42 Left 0
SYMATTR InstName PWM
SYMATTR Value COMP
SYMBOL voltage 16 832 R0
WINDOW 0 -84 57 Left 0
WINDOW 3 -112 64 Invisible 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName VTRI
SYMATTR Value PULSE(5 0 0 9.9u 100n 0 10u)
SYMBOL res 432 656 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R5
SYMATTR Value 1K
SYMBOL voltage 576 832 R0
WINDOW 0 -78 50 Left 0
WINDOW 3 -75 72 Left 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value 5V
SYMBOL diode 832 272 R270
WINDOW 0 32 32 VTop 0
WINDOW 3 0 32 VBottom 0
SYMATTR InstName Z1
SYMATTR Value ZID
SYMBOL ind2 -96 192 R270
WINDOW 0 60 62 VTop 0
WINDOW 3 63 58 VBottom 0
SYMATTR InstName LFILT
SYMATTR Value 100µ
SYMATTR Type ind
SYMATTR SpiceLine Rser=10m
SYMBOL cap 80 208 R0
WINDOW 0 -78 17 Left 0
WINDOW 3 -80 42 Left 0
SYMATTR InstName CFILT
SYMATTR Value 2200µ
SYMBOL res 80 352 R0
WINDOW 0 -74 43 Left 0
WINDOW 3 -75 67 Left 0
SYMATTR InstName RESR
SYMATTR Value 20mR
SYMBOL load2 176 368 R0
WINDOW 0 42 33 Left 0
WINDOW 3 42 61 Invisible 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName ILOAD
SYMATTR Value PULSE(5 15 10m 10n 10n 100u 200u)
SYMBOL cap 560 160 R90
WINDOW 0 0 32 VBottom 0
WINDOW 3 32 32 VTop 0
SYMATTR InstName C2
SYMATTR Value 1n
SYMBOL res 688 160 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R4
SYMATTR Value 10K
SYMBOL Digital\\dflop 848 624 R0
WINDOW 0 50 -19 Left 0
SYMATTR InstName A1
SYMATTR SpiceLine Vhigh=5 Vlow=0 Trise=10n Tfall=10n
SYMBOL voltage 704 832 R0
WINDOW 0 -81 58 Left 0
WINDOW 3 24 104 Invisible 0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName CLK
SYMATTR Value PULSE(0 5 0 10n 10n 100n 10u)
SYMBOL res 16 464 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName RSNS
SYMATTR Value 50m
SYMBOL sw 224 816 M0
WINDOW 0 54 45 Left 0
WINDOW 3 35 70 Left 0
SYMATTR InstName ILIM
SYMATTR Value COMP
SYMBOL res 432 752 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R6
SYMATTR Value 5K
SYMBOL res 320 864 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 0 56 VBottom 0
SYMATTR InstName R7
SYMATTR Value 2K
SYMBOL Opamps\\opamp -128 704 R0
WINDOW 0 -14 27 Left 0
SYMATTR InstName CEA
SYMATTR SpiceLine2 GBW=2Meg
SYMBOL res -320 768 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 0 56 VBottom 0
SYMATTR InstName R8
SYMATTR Value 1K
SYMBOL res -320 688 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 0 56 VBottom 0
SYMATTR InstName R9
SYMATTR Value 1K
SYMBOL res -176 688 R270
WINDOW 0 32 56 VTop 0
WINDOW 3 0 56 VBottom 0
SYMATTR InstName R10
SYMATTR Value 2K
SYMBOL Digital\\inv 944 768 M0
SYMATTR InstName A2
SYMATTR SpiceLine Vhigh=5 Vlow=0 Trise=10n Tfall=10n
SYMBOL diode 800 272 M270
WINDOW 0 32 32 VTop 0
WINDOW 3 0 32 VBottom 0
SYMATTR InstName Z2
SYMATTR Value ZID
TEXT -336 544 Left 0 !.MODEL DID D(RON=10m VFWD=0V)
TEXT -336 592 Left 0 !.MODEL MSW SW(RON=10m ROFF=1E6 VT=2.5V VH=1)
TEXT 344 592 Left 0 !.tran 0 15m 10n uic
TEXT 344 568 Left 0 !.lib opamp.sub
TEXT 344 544 Left 0 !.MODEL COMP SW(RON=10m ROFF=1E6 VT=0 VH=1m)
TEXT -336 568 Left 0 !.MODEL ZID D(RON=10m ROFF=100E6 VFWD=0V VREV=2V)
