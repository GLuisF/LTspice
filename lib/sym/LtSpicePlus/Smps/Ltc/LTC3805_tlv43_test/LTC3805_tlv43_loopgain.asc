Version 4
SHEET 1 1284 680
WIRE -10208 -5056 -10256 -5056
WIRE -10096 -5056 -10128 -5056
WIRE -10016 -5056 -10032 -5056
WIRE -12224 -4976 -12384 -4976
WIRE -12080 -4976 -12224 -4976
WIRE -11920 -4976 -12080 -4976
WIRE -11792 -4976 -11920 -4976
WIRE -11280 -4976 -11792 -4976
WIRE -10976 -4976 -11280 -4976
WIRE -10896 -4976 -10976 -4976
WIRE -10704 -4976 -10896 -4976
WIRE -10256 -4976 -10256 -5056
WIRE -10144 -4976 -10256 -4976
WIRE -10016 -4976 -10016 -5056
WIRE -10016 -4976 -10080 -4976
WIRE -9984 -4976 -9984 -5008
WIRE -9984 -4976 -10016 -4976
WIRE -9888 -4976 -9984 -4976
WIRE -9856 -4976 -9888 -4976
WIRE -9760 -4976 -9856 -4976
WIRE -9648 -4976 -9760 -4976
WIRE -9536 -4976 -9648 -4976
WIRE -9344 -4976 -9536 -4976
WIRE -12384 -4944 -12384 -4976
WIRE -10976 -4944 -10976 -4976
WIRE -10896 -4944 -10896 -4976
WIRE -10704 -4928 -10704 -4976
WIRE -12224 -4912 -12224 -4976
WIRE -11920 -4912 -11920 -4976
WIRE -11792 -4912 -11792 -4976
WIRE -11280 -4912 -11280 -4976
WIRE -10256 -4912 -10256 -4976
WIRE -9856 -4912 -9856 -4976
WIRE -9536 -4912 -9536 -4976
WIRE -9344 -4912 -9344 -4976
WIRE -9760 -4896 -9760 -4976
WIRE -9648 -4896 -9648 -4976
WIRE -11280 -4800 -11280 -4848
WIRE -10976 -4800 -10976 -4880
WIRE -10896 -4800 -10896 -4864
WIRE -10896 -4800 -10976 -4800
WIRE -10848 -4800 -10896 -4800
WIRE -10704 -4800 -10704 -4848
WIRE -10704 -4800 -10784 -4800
WIRE -10592 -4800 -10592 -4816
WIRE -10592 -4800 -10704 -4800
WIRE -10528 -4800 -10592 -4800
WIRE -12000 -4784 -12000 -4816
WIRE -11920 -4784 -11920 -4832
WIRE -11920 -4784 -12000 -4784
WIRE -11360 -4784 -11920 -4784
WIRE -10256 -4784 -10256 -4832
WIRE -9856 -4784 -9856 -4848
WIRE -9856 -4784 -10256 -4784
WIRE -9760 -4784 -9760 -4816
WIRE -9760 -4784 -9856 -4784
WIRE -9648 -4784 -9648 -4832
WIRE -9648 -4784 -9760 -4784
WIRE -9536 -4784 -9536 -4832
WIRE -9536 -4784 -9648 -4784
WIRE -9344 -4784 -9344 -4832
WIRE -9344 -4784 -9536 -4784
WIRE -12000 -4768 -12000 -4784
WIRE -10704 -4768 -10704 -4800
WIRE -10528 -4752 -10528 -4800
WIRE -9760 -4752 -9760 -4784
WIRE -11360 -4736 -11360 -4784
WIRE -12384 -4688 -12384 -4864
WIRE -12224 -4688 -12224 -4832
WIRE -12224 -4688 -12320 -4688
WIRE -12000 -4688 -12000 -4704
WIRE -11792 -4688 -11792 -4832
WIRE -11504 -4688 -11792 -4688
WIRE -11120 -4688 -11216 -4688
WIRE -10912 -4688 -10912 -4704
WIRE -10912 -4688 -11040 -4688
WIRE -10752 -4688 -10912 -4688
WIRE -11792 -4640 -11792 -4688
WIRE -10528 -4640 -10528 -4672
WIRE -11504 -4608 -11568 -4608
WIRE -11088 -4608 -11216 -4608
WIRE -11008 -4608 -11088 -4608
WIRE -10880 -4608 -10928 -4608
WIRE -12320 -4560 -12320 -4688
WIRE -12080 -4528 -12080 -4976
WIRE -11504 -4528 -11664 -4528
WIRE -11008 -4528 -11216 -4528
WIRE -10880 -4528 -10880 -4608
WIRE -10880 -4528 -10928 -4528
WIRE -10704 -4528 -10704 -4672
WIRE -10704 -4528 -10880 -4528
WIRE -10528 -4528 -10528 -4576
WIRE -12224 -4480 -12224 -4688
WIRE -12144 -4480 -12224 -4480
WIRE -10880 -4464 -10880 -4528
WIRE -9888 -4464 -9888 -4976
WIRE -11744 -4448 -11744 -4496
WIRE -11504 -4448 -11744 -4448
WIRE -11152 -4448 -11216 -4448
WIRE -11088 -4432 -11088 -4608
WIRE -12224 -4416 -12224 -4480
WIRE -11792 -4416 -11792 -4560
WIRE -12080 -4384 -12080 -4432
WIRE -12000 -4384 -12080 -4384
WIRE -11664 -4384 -11664 -4528
WIRE -11568 -4384 -11568 -4608
WIRE -12320 -4368 -12320 -4480
WIRE -12272 -4368 -12320 -4368
WIRE -11360 -4368 -11360 -4416
WIRE -12000 -4352 -12000 -4384
WIRE -11088 -4352 -11088 -4368
WIRE -10880 -4352 -10880 -4384
WIRE -10880 -4352 -11088 -4352
WIRE -10704 -4352 -10704 -4400
WIRE -10672 -4352 -10704 -4352
WIRE -10576 -4352 -10592 -4352
WIRE -10528 -4352 -10576 -4352
WIRE -10416 -4352 -10448 -4352
WIRE -10304 -4352 -10352 -4352
WIRE -12320 -4320 -12320 -4368
WIRE -9888 -4320 -9888 -4384
WIRE -10576 -4304 -10576 -4352
WIRE -10304 -4304 -10304 -4352
WIRE -11152 -4288 -11152 -4448
WIRE -10880 -4288 -10880 -4352
WIRE -9888 -4288 -9888 -4320
WIRE -11664 -4256 -11664 -4304
WIRE -11568 -4256 -11568 -4320
WIRE -12000 -4224 -12000 -4288
WIRE -11920 -4224 -11920 -4784
WIRE -11920 -4224 -12000 -4224
WIRE -10576 -4192 -10576 -4240
WIRE -12320 -4160 -12320 -4240
WIRE -12224 -4160 -12224 -4320
WIRE -10304 -4160 -10304 -4224
WIRE -9888 -4144 -9888 -4208
WIRE -12080 -4080 -12080 -4384
WIRE -11280 -4080 -12080 -4080
WIRE -11280 -4032 -11280 -4080
WIRE -10240 -4000 -10544 -4000
WIRE -9888 -4000 -9888 -4144
WIRE -9888 -4000 -10160 -4000
WIRE -9888 -3952 -9888 -4000
WIRE -11744 -3904 -11744 -4448
WIRE -11520 -3904 -11744 -3904
WIRE -11280 -3904 -11280 -3952
WIRE -11280 -3904 -11456 -3904
WIRE -10928 -3904 -11280 -3904
WIRE -10544 -3904 -10544 -4000
WIRE -10544 -3904 -10736 -3904
WIRE -10512 -3904 -10544 -3904
WIRE -10400 -3904 -10432 -3904
WIRE -11280 -3872 -11280 -3904
WIRE -10928 -3840 -10976 -3840
WIRE -10400 -3808 -10400 -3904
WIRE -10400 -3808 -10736 -3808
WIRE -10400 -3760 -10400 -3808
WIRE -10320 -3760 -10320 -3840
WIRE -10320 -3760 -10400 -3760
WIRE -10176 -3760 -10320 -3760
WIRE -10080 -3760 -10176 -3760
WIRE -9888 -3760 -9888 -3872
WIRE -9888 -3760 -10016 -3760
WIRE -11280 -3744 -11280 -3808
WIRE -10976 -3744 -10976 -3840
WIRE -10976 -3744 -11280 -3744
WIRE -10176 -3680 -10176 -3760
WIRE -10976 -3648 -10976 -3744
WIRE -10064 -3632 -10128 -3632
WIRE -9888 -3632 -9888 -3760
WIRE -9888 -3632 -10064 -3632
WIRE -9888 -3584 -9888 -3632
WIRE -10176 -3536 -10176 -3584
WIRE -9888 -3424 -9888 -3504
FLAG -10880 -4288 0
FLAG -12000 -4688 0
FLAG -10704 -4400 Vcc
FLAG -12000 -4816 Vcc
FLAG -9984 -5008 Vout
FLAG -12384 -4688 0
FLAG -10576 -4192 0
FLAG -10304 -4160 0
FLAG -9760 -4752 0
FLAG -9888 -3424 0
FLAG -10912 -4704 gate
FLAG -11280 -4800 0
FLAG -10176 -3536 0
FLAG -12224 -4160 0
FLAG -10320 -3840 opto
FLAG -10976 -3648 0
FLAG -10064 -3632 FB
FLAG -11744 -4496 Ith
FLAG -11360 -4368 0
FLAG -11152 -4288 0
FLAG -11792 -4416 0
FLAG -11568 -4256 0
FLAG -11664 -4256 0
FLAG -12320 -4160 0
FLAG -10592 -4816 drain
FLAG -10528 -4528 0
FLAG -9888 -4320 A
FLAG -9888 -4144 B
SYMBOL nmos -10752 -4768 R0
SYMATTR InstName M1
SYMATTR Value Si4488DY
SYMBOL res -10896 -4480 R0
SYMATTR InstName RSENSE
SYMATTR Value 0.033
SYMBOL res -10912 -4544 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 1k
SYMBOL ind2 -10688 -4944 M0
SYMATTR InstName L1
SYMATTR Value 46.4µ
SYMATTR Type ind
SYMATTR SpiceLine Ipk=3.3 Rser=0.3
SYMBOL ind2 -10272 -4816 M180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L2
SYMATTR Value 11.6µ
SYMATTR Type ind
SYMATTR SpiceLine Ipk=2.5 Rser=0.05
SYMBOL ind2 -10320 -4208 M180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L3
SYMATTR Value 11.6µ
SYMATTR Type ind
SYMATTR SpiceLine Ipk=.97 Rser=140m Cpar=193p
SYMBOL res -11936 -4928 R0
SYMATTR InstName R4
SYMATTR Value 56k
SYMBOL cap -10592 -4304 R0
SYMATTR InstName C4
SYMATTR Value 1µ
SYMATTR SpiceLine V=25 Irms=0 Rser=0.007 Lser=0 mfg="TDK" pn="C3216X7RIE105M" type="X7R"
SYMBOL res -10576 -4368 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 270
SYMBOL voltage -12384 -4960 R0
WINDOW 123 0 0 Left 2
WINDOW 39 24 44 Left 2
SYMATTR InstName VIN
SYMATTR Value 48
SYMBOL res -9904 -3600 R0
SYMATTR InstName R2
SYMATTR Value 10.22k
SYMBOL res -9904 -3968 R0
SYMATTR InstName R1
SYMATTR Value 39k
SYMBOL cap -12016 -4768 R0
SYMATTR InstName C3
SYMATTR Value 1µ
SYMATTR SpiceLine V=25 Irms=0 Rser=0.001 Lser=0
SYMBOL res -10912 -4960 R0
SYMATTR InstName R6
SYMATTR Value 3.3k
SYMATTR SpiceLine pwr=1w
SYMBOL cap -10992 -4944 R0
SYMATTR InstName C7
SYMATTR Value 10n
SYMBOL cap -11296 -4912 R0
WINDOW 123 24 84 Left 2
SYMATTR Value2 x5
SYMATTR Value 1µ
SYMATTR InstName C9
SYMATTR SpiceLine V=25 Irms=0 Rser=0.007 Lser=0 mfg="TDK" pn="C3216X7RIE105M" type="X7R"
SYMBOL res -11296 -4048 R0
SYMATTR InstName R9
SYMATTR Value 1.5k
SYMBOL res -10144 -4016 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value 680
SYMBOL res -12240 -4928 R0
SYMATTR InstName R13
SYMATTR Value 10k
SYMBOL res -10544 -4336 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R16
SYMATTR Value 22
SYMBOL schottky -10144 -4960 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D3
SYMATTR Value MBR20100CT
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL TL431 -10176 -3632 M0
SYMATTR InstName U2
SYMBOL cap -10016 -3776 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C8
SYMATTR Value 3.3n
SYMBOL PowerProducts\\LTC3805 -11360 -4576 R0
SYMATTR InstName U1
SYMBOL res -10912 -4624 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 470
SYMBOL cap -9872 -4912 R0
WINDOW 123 24 84 Left 2
SYMATTR Value2 x5
SYMATTR Value 22µ
SYMATTR InstName C19
SYMATTR SpiceLine V=25 Irms=0 Rser=0.003 Lser=0 mfg="TDK" pn="C575OX5RIE226M" type="X5R"
SYMBOL cap -11296 -3872 R0
SYMATTR InstName C17
SYMATTR Value 150p
SYMBOL res -11808 -4928 R0
SYMATTR InstName R8
SYMATTR Value 150k
SYMBOL res -11808 -4656 R0
SYMATTR InstName R15
SYMATTR Value 12k
SYMBOL Optos\\MOC207 -10832 -3840 M0
SYMATTR InstName U3
SYMBOL cap -11584 -4384 R0
SYMATTR InstName C12
SYMATTR Value 1µ
SYMBOL res -11680 -4400 R0
SYMATTR InstName R17
SYMATTR Value 62k
SYMBOL npn -12144 -4528 R0
SYMATTR InstName Q1
SYMATTR Value 2N3904
SYMBOL cap -11104 -4432 R0
SYMATTR InstName C10
SYMATTR Value 1n
SYMBOL diode -10784 -4816 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D7
SYMATTR Value bas21
SYMATTR Prefix X
SYMBOL diode -10352 -4368 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D1
SYMATTR Value bas21
SYMATTR Prefix X
SYMBOL diode -11984 -4352 M0
SYMATTR InstName D2
SYMATTR Value bas21
SYMATTR Prefix X
SYMBOL TL431 -12224 -4368 R0
SYMATTR InstName U4
SYMBOL res -12336 -4576 R0
SYMATTR InstName R11
SYMATTR Value 33k
SYMBOL res -12336 -4336 R0
SYMATTR InstName R14
SYMATTR Value 15k
SYMBOL diode -11520 -3920 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D4
SYMATTR Value bas21
SYMATTR Prefix X
SYMBOL res -10544 -4768 R0
SYMATTR InstName R10
SYMATTR Value 100
SYMATTR SpiceLine pwr=1w
SYMBOL cap -10544 -4640 R0
SYMATTR InstName C18
SYMATTR Value 330p
SYMATTR SpiceLine V=200v
SYMBOL res -10112 -5072 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 68
SYMBOL cap -10032 -5072 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C13
SYMATTR Value 150p
SYMBOL res -9776 -4912 R0
SYMATTR InstName R18
SYMATTR Value 100
SYMBOL res -11024 -4704 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R20
SYMATTR Value 10
SYMBOL current -9344 -4912 R0
WINDOW 123 0 0 Left 2
WINDOW 39 20 107 Left 2
SYMATTR SpiceLine load
SYMATTR InstName I1
SYMATTR Value PWL(0 0 10m 0 10.01m 1.5 12m 1.5 12.01m 0)
SYMBOL res -10416 -3920 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R21
SYMATTR Value 1k
SYMBOL cap -9664 -4896 R0
WINDOW 123 24 36 Left 2
SYMATTR Value2 x6
SYMATTR Value 22µ
SYMATTR InstName C1
SYMATTR SpiceLine V=25 Irms=0 Rser=0.003 Lser=0 mfg="TDK" pn="C575OX5RIE226M" type="X5R"
SYMBOL voltage -9888 -4304 R0
SYMATTR InstName V1
SYMATTR Value SINE(0 {Famp} {Freq})
SYMBOL voltage -9888 -4480 R0
SYMATTR InstName V2
SYMATTR Value 0
SYMBOL current -9536 -4912 R0
WINDOW 123 0 0 Left 2
WINDOW 39 24 107 Left 2
SYMATTR InstName I2
SYMATTR Value 0
SYMATTR SpiceLine load
TEXT -10864 -5024 Bottom 2 !K1 L1 L2 L3 0.99
TEXT -10960 -5072 Left 2 ;Lstray = 1.45uH
TEXT -12304 -5704 Left 2 ;.tran 15ms
TEXT -12312 -5784 Left 2 !.INCLUDE bas21.lib
TEXT -12312 -5752 Left 2 !.options gmin=1e-10 abstol=1e-10 reltol=0.003
TEXT -12304 -5592 Left 2 !.tran 0 9m 7m 50n\n.step param freq list  500 1k 2k 5k 10k 20k\n \n.param Famp=2m ; sine amplitude\n.param Freq=1K       ; iterate frequency until Gain_dB is close to zero dB.\n.save V(a) V(b) ; I(L1)   ; don't save extra waveform data\n.option plotwinsize=0  ; turn off waveform compression for better accuracy.\n.option option_angle=degrees\n \n.measure Aavg avg V(a)\n.measure Bavg avg V(b)\n.measure Are avg  (V(a)-Aavg)*cos(360*time*Freq)\n.measure Aim avg -(V(a)-Aavg)*sin(360*time*Freq)\n.measure Bre avg  (V(b)-Bavg)*cos(360*time*Freq)\n.measure Bim avg -(V(b)-Bavg)*sin(360*time*Freq)\n.measure Gain_dB param 20*log10(hypot(Are,Aim) / hypot(Bre,Bim))\n.measure Phase param mod(atan2(Aim, Are) - atan2(Bim, Bre)+180,360)-180
TEXT -10368 -5736 Left 2 ;2mV, 1A load\n \nMeasurement: gain_db\n  step          20*log10(hypot(are,aim) / hypot(bre,bim))\n     1          29.2576\n     2          19.8898\n     3          11.3531\n     4          2.30511\n     5          -4.73947\n     6          -13.7553\n \nMeasurement: phase\n  step          mod(atan2(aim, are) - atan2(bim, bre)+180,360)-180\n     1          29.1892\n     2          39.8963\n     3          51.2026\n     4          56.3886\n     5          43.7958\n     6          21.1909
TEXT -11208 -5752 Left 2 ;2mV, 0A load\n \nMeasurement: gain_db\n  step          20*log10(hypot(are,aim) / hypot(bre,bim))\n     1          33.6364\n     2          30.6361\n     3          16.7949\n     4          7.67874\n     5          -2.43193\n     6          -10.6608\n \nMeasurement: phase\n  step          mod(atan2(aim, are) - atan2(bim, bre)+180,360)-180\n     1          13.0221\n     2          47.0827\n     3          45.0219\n     4          55.2177\n     5          48.6788\n     6          25.0117
TEXT -12304 -5672 Left 2 ;.param Freq=1k Famp=0
