Version 4
SHEET 1 1368 772
WIRE -32 -1392 -96 -1392
WIRE 240 -1392 48 -1392
WIRE 336 -1392 240 -1392
WIRE 1216 -1392 640 -1392
WIRE 240 -1376 240 -1392
WIRE 336 -1328 336 -1392
WIRE 384 -1328 336 -1328
WIRE 640 -1328 640 -1392
WIRE 640 -1328 576 -1328
WIRE 1232 -1328 1152 -1328
WIRE 464 -1312 448 -1312
WIRE 512 -1312 496 -1312
WIRE -64 -1296 -80 -1296
WIRE 48 -1296 16 -1296
WIRE 384 -1296 336 -1296
WIRE 624 -1296 576 -1296
WIRE 48 -1280 48 -1296
WIRE 240 -1280 240 -1296
WIRE 1200 -1264 1184 -1264
WIRE 1152 -1248 1152 -1328
WIRE 1184 -1248 1184 -1264
WIRE 496 -1216 496 -1312
WIRE 512 -1216 496 -1216
WIRE 1088 -1216 1056 -1216
WIRE -64 -1200 -128 -1200
WIRE 336 -1200 336 -1216
WIRE 624 -1200 624 -1216
WIRE 944 -1200 896 -1200
WIRE 992 -1200 944 -1200
WIRE -64 -1184 -64 -1200
WIRE 464 -1184 464 -1312
WIRE 512 -1184 464 -1184
WIRE 816 -1184 576 -1184
WIRE 944 -1184 816 -1184
WIRE 992 -1184 944 -1184
WIRE 48 -1168 48 -1200
WIRE 992 -1168 960 -1168
WIRE 960 -1152 960 -1168
WIRE 960 -1152 784 -1152
WIRE 720 -1136 688 -1136
WIRE -64 -1088 -64 -1104
WIRE 272 -1072 208 -1072
WIRE 608 -1072 272 -1072
WIRE 1184 -1072 1184 -1168
WIRE 1184 -1072 1120 -1072
WIRE -112 -1056 -128 -1056
WIRE -32 -1056 -112 -1056
WIRE 80 -1056 -32 -1056
WIRE 208 -1056 208 -1072
WIRE 688 -1056 688 -1136
WIRE -32 -1040 -32 -1056
WIRE 80 -1040 80 -1056
WIRE -112 -1024 -112 -1056
WIRE 272 -1024 272 -1072
WIRE 400 -1024 272 -1024
WIRE 720 -1024 704 -1024
WIRE 896 -1024 896 -1200
WIRE 896 -1024 880 -1024
WIRE 400 -992 368 -992
WIRE 480 -992 464 -992
WIRE 608 -976 608 -1072
WIRE 624 -976 608 -976
WIRE 688 -976 688 -1056
WIRE 720 -976 688 -976
WIRE 208 -960 208 -976
WIRE 288 -944 160 -944
WIRE 368 -944 368 -992
WIRE 368 -944 352 -944
WIRE 480 -944 368 -944
WIRE 624 -944 592 -944
WIRE 288 -928 272 -928
WIRE -112 -912 -112 -960
WIRE -32 -912 -32 -960
WIRE 80 -912 80 -960
WIRE 1232 -912 1184 -912
WIRE 160 -896 160 -944
WIRE 704 -896 704 -1024
WIRE 896 -896 896 -976
WIRE 896 -896 704 -896
WIRE 1184 -896 1184 -912
WIRE 160 -848 160 -896
WIRE 1088 -848 1056 -848
WIRE 128 -832 -96 -832
WIRE 896 -832 896 -896
WIRE 912 -832 896 -832
WIRE 992 -832 912 -832
WIRE 944 -816 944 -1184
WIRE 992 -816 944 -816
WIRE 96 -800 -80 -800
WIRE 128 -800 96 -800
WIRE 960 -800 960 -1152
WIRE 992 -800 960 -800
WIRE 160 -736 160 -768
WIRE 1120 -736 1120 -1072
WIRE 1184 -736 1184 -816
WIRE 1184 -736 1120 -736
WIRE 1200 -736 1184 -736
WIRE 32 -720 32 -736
WIRE 0 -704 -112 -704
WIRE 96 -688 96 -800
WIRE 96 -688 64 -688
WIRE 0 -672 -112 -672
WIRE 272 -672 272 -928
WIRE 1024 -672 272 -672
WIRE 32 -624 32 -656
WIRE 1104 -624 1056 -624
WIRE -144 -592 -160 -592
WIRE -64 -592 -144 -592
WIRE 64 -592 -64 -592
WIRE 176 -592 64 -592
WIRE 816 -592 176 -592
WIRE 64 -576 64 -592
WIRE 1024 -576 1024 -592
WIRE -144 -560 -144 -592
WIRE 752 -544 656 -544
WIRE -64 -528 -64 -592
WIRE 176 -528 176 -592
WIRE 272 -528 256 -528
WIRE 1104 -528 1104 -624
WIRE 1152 -528 1104 -528
WIRE 272 -496 272 -528
WIRE 592 -496 560 -496
WIRE 864 -480 656 -480
WIRE 944 -464 944 -816
WIRE 944 -464 928 -464
WIRE 1264 -464 1216 -464
WIRE -144 -448 -144 -480
WIRE 352 -448 336 -448
WIRE 464 -448 432 -448
WIRE 864 -448 560 -448
WIRE 64 -432 64 -448
WIRE 752 -432 752 -544
WIRE 816 -432 816 -592
WIRE 1024 -432 928 -432
WIRE -64 -416 -64 -448
WIRE 1216 -416 1216 -464
WIRE 1264 -416 1264 -464
WIRE 336 -400 336 -448
WIRE 816 -400 800 -400
WIRE 1104 -384 1104 -528
WIRE 1104 -384 1056 -384
WIRE 64 -352 64 -368
WIRE 816 -352 816 -400
WIRE 816 -352 752 -352
WIRE 272 -336 272 -400
WIRE 1024 -336 1024 -352
WIRE 752 -320 752 -352
WIRE 336 -288 336 -320
FLAG 1232 -1328 VC
IOPIN 1232 -1328 In
FLAG 1200 -1264 OUTB
IOPIN 1200 -1264 Out
FLAG 1232 -912 OUTA
IOPIN 1232 -912 Out
FLAG 1152 -528 ILIM.SD
IOPIN 1152 -528 In
FLAG -80 -1296 CLOCK
IOPIN -80 -1296 Out
FLAG -96 -832 RAMP
IOPIN -96 -832 Out
FLAG -80 -800 EAOUT
IOPIN -80 -800 Out
FLAG -112 -704 -EA
IOPIN -112 -704 In
FLAG -112 -672 +EA
IOPIN -112 -672 In
FLAG -128 -1200 RT
IOPIN -128 -1200 Out
FLAG -128 -1056 CT
IOPIN -128 -1056 Out
FLAG 1216 -1392 VCC
IOPIN 1216 -1392 In
FLAG -96 -1392 VREF
IOPIN -96 -1392 Out
FLAG -64 -1088 COM
FLAG -32 -912 COM
FLAG 80 -912 COM
FLAG 48 -1168 COM
FLAG 240 -1280 COM
FLAG 336 -1200 COM
FLAG 624 -1200 COM
FLAG 160 -736 COM
FLAG 752 -320 COM
FLAG 272 -336 COM
FLAG -144 -448 COM
FLAG 1024 -576 COM
FLAG 1024 -336 COM
FLAG 208 -960 COM
FLAG 1088 -1216 drv_b
FLAG 1088 -848 drv_a
FLAG 160 -896 pwm1
FLAG 64 -352 COM
FLAG 336 -288 COM
FLAG 944 -1200 phase_b
FLAG 816 -1184 uvlo
FLAG 688 -1056 deadtime
FLAG 912 -832 phase_a
FLAG 32 -736 VREF
FLAG 1216 -416 SGND
IOPIN 1216 -416 BiDir
FLAG -64 -416 COM
FLAG -160 -592 SS
IOPIN -160 -592 Out
FLAG -112 -912 COM
FLAG 1200 -736 PGND
IOPIN 1200 -736 BiDir
FLAG 1264 -416 COM
FLAG 32 -624 COM
SYMBOL Digital\\diffschmtbuf 384 -1376 R0
WINDOW 0 18 65 Left 0
WINDOW 3 6 104 Left 0
SYMATTR InstName A1
SYMATTR Value td=50n
SYMBOL Digital\\diffschmtbuf 576 -1376 M0
WINDOW 0 22 63 Left 0
WINDOW 3 6 102 Left 0
SYMATTR InstName A2
SYMATTR Value td=50n
SYMBOL Digital\\and 544 -1264 R0
WINDOW 0 -22 64 Left 0
WINDOW 3 -24 110 Left 0
SYMATTR InstName A3
SYMATTR Value td=50n
SYMBOL Digital\\and 432 -944 M180
WINDOW 0 -21 64 Left 0
WINDOW 3 -29 22 Left 0
SYMATTR InstName A4
SYMATTR Value td=50n
SYMBOL Digital\\srflop 528 -1040 R0
WINDOW 0 -17 73 Left 0
WINDOW 3 -41 5 Left 0
SYMATTR InstName A5
SYMATTR Value td=50n
SYMBOL Digital\\or 656 -1024 R0
WINDOW 0 -16 65 Left 0
WINDOW 3 -36 112 Left 0
SYMATTR InstName A6
SYMATTR Value td=50n
SYMBOL Digital\\or 1024 -1136 M180
WINDOW 0 -15 65 Left 0
WINDOW 3 -25 23 Left 0
SYMATTR InstName A7
SYMATTR Value td=50n
SYMBOL Digital\\srflop 512 -400 R180
WINDOW 3 -34 3 Left 0
WINDOW 0 -10 70 Left 0
SYMATTR Value td=50n
SYMATTR InstName A8
SYMBOL Digital\\and 624 -448 R180
WINDOW 0 -22 64 Left 0
WINDOW 3 -44 20 Left 0
SYMATTR InstName A9
SYMATTR Value td=50n
SYMBOL Digital\\or 896 -400 R180
WINDOW 3 -34 17 Left 0
WINDOW 0 -22 64 Left 0
SYMATTR Value td=50n
SYMATTR InstName A10
SYMBOL Digital\\or 1024 -768 M180
WINDOW 0 -18 62 Left 0
WINDOW 3 -24 22 Left 0
SYMATTR InstName A11
SYMATTR Value td=50n
SYMBOL Digital\\or 320 -992 R0
WINDOW 0 -13 66 Left 0
WINDOW 3 -27 105 Left 0
SYMATTR InstName A12
SYMATTR Value td=50n
SYMBOL bv 160 -864 R0
WINDOW 0 33 49 Left 0
WINDOW 3 31 71 Left 0
SYMATTR InstName B1
SYMATTR Value V=if((v(ramp)+1.25)>v(eaout),1,0)
SYMBOL bv 1024 -448 M0
WINDOW 0 41 52 Left 0
WINDOW 3 -185 128 Left 0
SYMATTR InstName B2
SYMATTR Value V=if(v(ilim.sd)>1.4,1,0)
SYMBOL bv 1024 -688 M0
WINDOW 0 36 43 Left 0
WINDOW 3 -191 126 Left 0
SYMATTR InstName B3
SYMATTR Value V=if(v(ilim.sd)>1.0,1,0)
SYMBOL bv 48 -1296 M0
WINDOW 3 -250 85 Left 0
WINDOW 0 -101 59 Left 0
SYMATTR Value V=if(i(bdisc)>0,4.5,2.3)
SYMATTR InstName Bclock
SYMBOL voltage -64 -1200 R0
WINDOW 0 31 43 Left 0
WINDOW 3 33 69 Left 0
SYMATTR InstName Vosc
SYMATTR Value 3
SYMBOL bi -32 -960 M180
WINDOW 0 26 73 Left 0
WINDOW 3 34 35 Invisible 0
SYMATTR InstName Bchg
SYMATTR Value i=-v(rt)/(v(rt)/i(Vosc)+1600)
SYMBOL bi 80 -1040 R0
WINDOW 3 -184 37 Invisible 0
WINDOW 0 22 4 Left 0
SYMATTR Value i=if(v(ct)<1.2, 0,if(v(ct)>2.8, 10*i(Bchg), if((v(ct)>1.2)&i(bdisc)>1u, 10*i(Bchg), 0)))
SYMATTR InstName Bdisc
SYMBOL npn 336 -496 M0
SYMATTR InstName Q1
SYMATTR Value 2N2222
SYMBOL voltage 624 -1312 R0
WINDOW 0 32 45 Left 0
WINDOW 3 29 74 Left 0
SYMATTR InstName V1
SYMATTR Value 9.2
SYMBOL voltage 336 -1312 M0
WINDOW 0 36 33 Left 0
WINDOW 3 34 67 Left 0
SYMATTR InstName V2
SYMATTR Value 4.2
SYMBOL current -144 -480 M180
WINDOW 0 24 88 Left 0
WINDOW 3 24 0 Left 0
SYMATTR InstName I1
SYMATTR Value 9µ
SYMBOL bv 752 -448 R0
WINDOW 3 -212 100 Left 0
SYMATTR Value v=if(0.5>v(ss),1,0)
SYMATTR InstName B5
SYMBOL voltage 240 -1392 R0
WINDOW 0 33 38 Left 0
WINDOW 3 33 66 Left 0
SYMATTR InstName V3
SYMATTR Value 5.1
SYMBOL Digital\\dflop 800 -1072 R0
WINDOW 3 -29 153 Left 0
WINDOW 0 -23 65 Left 0
SYMATTR Value td=50n
SYMATTR InstName A13
SYMBOL bv 208 -1072 R0
WINDOW 3 -10 -35 Left 0
SYMATTR Value V=if(v(clock)>3.4,0,1)
SYMATTR InstName B6
SYMBOL bv 1184 -1264 R0
WINDOW 0 -11 56 Left 0
WINDOW 3 -100 105 Invisible 0
SYMATTR InstName B7
SYMATTR Value v=if(v(drv_b)>0.5, v(vc),0)
SYMBOL bv 1184 -912 R0
WINDOW 0 -21 56 Left 0
WINDOW 3 -99 105 Invisible 0
SYMATTR InstName B8
SYMATTR Value V=if(v(drv_a)>0.5, v(vc),0)
SYMBOL res 272 -544 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R5
SYMATTR Value 200
SYMBOL diode 48 -576 R0
WINDOW 0 43 26 Left 0
WINDOW 3 39 50 Left 0
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL diode 48 -512 R0
WINDOW 0 43 26 Left 0
WINDOW 3 39 50 Left 0
SYMATTR InstName D2
SYMATTR Value 1N4148
SYMBOL diode 48 -432 R0
WINDOW 0 43 26 Left 0
WINDOW 3 39 50 Left 0
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL res 448 -464 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R6
SYMATTR Value 10
SYMBOL res 320 -416 R0
SYMATTR InstName R9
SYMATTR Value 2meg
SYMBOL Opamps\\UniversalOpamp 32 -688 R0
WINDOW 0 -24 -2 Left 0
SYMATTR InstName U1
SYMATTR Value2 Avol=56.23k GBW=8.3Meg Slew=12Meg
SYMATTR SpiceLine ilimit=4m rail=0.3 Vos=15m phimargin=45
SYMBOL Digital\\buf 720 -1072 M180
WINDOW 0 2 64 Left 0
WINDOW 3 -2 27 Left 0
SYMATTR InstName A14
SYMATTR Value td=50n
SYMBOL res -80 -544 R0
SYMATTR InstName R4
SYMATTR Value {1/Gmin}
SYMBOL res 32 -1312 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R11
SYMATTR Value 1k
SYMBOL res 64 -1408 R90
WINDOW 0 0 56 VBottom 0
WINDOW 3 32 56 VTop 0
SYMATTR InstName R12
SYMATTR Value 1
SYMBOL cap -128 -1024 R0
SYMATTR InstName C1
SYMATTR Value 55p
TEXT 552 -832 Left 0 ;1=stop PWM\n(eith EA or current limit)
TEXT 272 -1040 Left 0 ;Pulse-by-pulse reset \nwhen stopped
TEXT 432 -1088 Left 0 ;Normal clock path
LINE Normal 720 -848 808 -776
LINE Normal 800 -848 744 -776
RECTANGLE Normal -208 -1488 -208 -1488
